(this["webpackJsonpyorkie-codepair"]=this["webpackJsonpyorkie-codepair"]||[]).push([[0],{154:function(e,t,a){},155:function(e,t,a){},157:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(8),i=a.n(o),c=a(12),s=a(91),l=a(15),u=a(200),d=a(202),m=a(92),p=a(201),f=a(191),h=a(210),v=a(193),b=a(194),g=a(195),y=Object(f.a)((function(e){return Object(h.a)({root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}})}));function j(){var e=y();return r.a.createElement("div",{className:e.root},r.a.createElement(v.a,{position:"static"},r.a.createElement(b.a,null,r.a.createElement(g.a,{variant:"h6",className:e.title},"Yorkie CodePair"))))}var E,O=a(38),k=a(203),x=a(211),C=a(196),S=a(198),T=a(208),w=a(87),M=a.n(w),N=a(205),D=a(35),R=a.n(D),P=a(54),A=a(25),I=a(65),L=a.n(I);!function(e){e.PlainText="text/plain",e.Go="go",e.Javascript="javascript",e.Clojure="clojure",e.Dart="dart",e.Python="python",e.Ruby="ruby",e.Rust="rust"}(E||(E={}));var z,K,V,F={mode:E.PlainText,loading:!1,errorMessage:""},B=Object(A.b)("doc/attach",function(){var e=Object(P.a)(R.a.mark((function e(t,a){var n,r;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=L.a.createClient("".concat("/api")),r=L.a.createDocument("codepairs",t),e.next=5,n.activate();case 5:return e.next=7,n.attach(r);case 7:return r.update((function(e){e.content||e.createText("content")})),e.abrupt("return",{document:r,client:n});case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",a.rejectWithValue(e.t0));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,a){return e.apply(this,arguments)}}()),W=Object(A.c)({name:"doc",initialState:F,reducers:{attachDocLoading:function(e,t){e.loading=t.payload},setCodeMode:function(e,t){e.mode=t.payload}},extraReducers:function(e){e.addCase(B.fulfilled,(function(e,t){var a=t.payload;e.doc=a.document,e.client=a.client})),e.addCase(B.rejected,(function(e,t){var a=t.payload;e.errorMessage=a}))}}),J=W.actions,U=J.attachDocLoading,$=J.setCodeMode,G=W.reducer,q=a(204),H=a(55),Y=a(56),Q=function(){function e(t){Object(H.a)(this,e),this.key=void 0,this.storage=void 0,this.key=t,this.storage=window.localStorage}return Object(Y.a)(e,[{key:"getValue",value:function(e){try{return JSON.parse(this.storage[this.key])}catch(t){return e}}},{key:"setValue",value:function(e){this.storage[this.key]=JSON.stringify(e)}}]),e}();!function(e){e.Material="material",e.Monokai="monokai"}(z||(z={})),function(e){e.Sublime="sublime",e.Vim="vim",e.Emacs="emacs"}(K||(K={})),function(e){e.Two="2",e.Four="4",e.Eight="8"}(V||(V={}));var X=new Q("$$codepair$$setting"),Z=X.getValue({menu:{codeTheme:z.Monokai,codeKeyMap:K.Sublime,tabSize:V.Two}}),_=Object(A.c)({name:"setting",initialState:Z,reducers:{setCodeTheme:function(e,t){e.menu.codeTheme=t.payload,X.setValue(e)},setCodeKeyMap:function(e,t){e.menu.codeKeyMap=t.payload,X.setValue(e)},setTabSize:function(e,t){e.menu.tabSize=t.payload,X.setValue(e)}}}),ee=_.actions,te=ee.setCodeTheme,ae=ee.setCodeKeyMap,ne=ee.setTabSize,re=_.reducer,oe=Object(f.a)((function(e){return Object(h.a)({root:{width:"400px",minWidth:"320px",borderRadius:"4px"},header:{borderBottom:"1px solid ".concat(e.palette.text.disabled)},title:{padding:"12px 16px"},list:{padding:"12px 24px",lineHeight:"19px"},item:{display:"flex",justifyContent:"space-between",fontSize:"15px",marginTop:"12px"},itemTitle:{whiteSpace:"nowrap",display:"flex",alignItems:"center"},itemInfo:{minWidth:140,paddingLeft:"12px",border:"1px solid #aaa",borderRadius:"4px",textAlign:"left"}})})),ie=function(){var e=Object(l.b)(),t=oe(),a=Object(l.c)((function(e){return e.settingState.menu}));function n(t){return function(a){e(t(a.target.value))}}return r.a.createElement("div",{className:t.root},r.a.createElement(q.a,null,r.a.createElement("header",{className:t.header},r.a.createElement(g.a,{className:t.title,variant:"h6"},"Settings"))),r.a.createElement("div",{className:t.list},r.a.createElement("div",{className:t.item},r.a.createElement("div",{className:t.itemTitle},"Theme"),r.a.createElement(C.a,{className:t.itemInfo},r.a.createElement(k.a,{value:a.codeTheme,onChange:n(te),disableUnderline:!0,displayEmpty:!0},Object.entries(z).map((function(e){var t=Object(O.a)(e,2),a=t[0],n=t[1];return r.a.createElement(x.a,{value:n,key:n},a)}))))),r.a.createElement("div",{className:t.item},r.a.createElement("div",{className:t.itemTitle},"Key binding"),r.a.createElement(C.a,{className:t.itemInfo},r.a.createElement(k.a,{value:a.codeKeyMap,onChange:n(ae),disableUnderline:!0,displayEmpty:!0},Object.entries(K).map((function(e){var t=Object(O.a)(e,2),a=t[0],n=t[1];return r.a.createElement(x.a,{value:n,key:n},a)}))))),r.a.createElement("div",{className:t.item},r.a.createElement("div",{className:t.itemTitle},"Tab Size"),r.a.createElement(C.a,{className:t.itemInfo},r.a.createElement(k.a,{value:a.tabSize,onChange:n(ne),disableUnderline:!0,displayEmpty:!0},Object.entries(V).map((function(e){var t=Object(O.a)(e,2),a=t[0],n=t[1];return r.a.createElement(x.a,{value:n,key:a},"".concat(n," spaces"))})))))))},ce=Object(f.a)((function(e){return Object(h.a)({root:{padding:"6px",position:"relative"},formControl:{minWidth:140,border:"1px solid ".concat(e.palette.grey[800]),borderRadius:"4px"},selectEmpty:{paddingLeft:"12px"},settingsButton:{float:"right",padding:"7px"}})}));function se(){var e=ce(),t=Object(l.b)(),a=Object(l.c)((function(e){return e.docState.doc})),o=Object(l.c)((function(e){return e.docState.mode})),i=Object(n.useState)(),c=Object(O.a)(i,2),s=c[0],u=c[1];Object(n.useEffect)((function(){if(!a)return function(){};var e=a.subscribe((function(e){"remote-change"===e.name&&t($(a.getRootObject().mode||E.PlainText))}));return function(){e()}}),[a]);var d=Object(n.useCallback)((function(e){if(a){var n=e.target.value;a.update((function(e){e.mode=n})),t($(n))}}),[a,t]),m=Object(n.useCallback)((function(e){u(e.currentTarget)}),[]),p=Object(n.useCallback)((function(){u(void 0)}),[]),f=Boolean(s);return r.a.createElement("div",{className:e.root},r.a.createElement(C.a,{className:e.formControl},r.a.createElement(T.a,{title:"Syntax"},r.a.createElement(k.a,{name:"codeMode",value:o,onChange:d,className:e.selectEmpty,disableUnderline:!0,displayEmpty:!0},Object.entries(E).map((function(e){var t=Object(O.a)(e,2),a=t[0],n=t[1];return r.a.createElement(x.a,{value:n,key:n},a)}))))),r.a.createElement(T.a,{title:"Settings"},r.a.createElement(S.a,{className:e.settingsButton,"aria-label":"settings",onClick:m},r.a.createElement(M.a,{fontSize:"small"}))),r.a.createElement(N.a,{id:f?"simple-popover":void 0,open:f,anchorEl:s,onClose:p,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},r.a.createElement(ie,null)))}var le,ue=a(88),de=a(89),me=a.n(de),pe=a(209),fe=a(206),he=a(199);!function(e){e.Connected="connected",e.Disconnected="disconnected"}(le||(le={}));var ve,be=Object(A.c)({name:"peer",initialState:{peers:{}},reducers:{connectPeer:function(e,t){var a=t.payload,n=a.id,r=a.color,o=a.status;e.peers[n]={id:n,color:r,status:o}},disconnectPeer:function(e,t){e.peers[t.payload].status=le.Disconnected}}}),ge=be.actions,ye=ge.connectPeer,je=ge.disconnectPeer,Ee=be.reducer,Oe=a(90),ke=a.n(Oe);!function(e){e.Deactivated="deactivated",e.Activated="activated"}(ve||(ve={}));var xe=function(){function e(t,a){Object(H.a)(this,e),this.id=void 0,this.color=void 0,this.height=void 0,this.marker=void 0,this.lineMarker=void 0,this.status=void 0,this.nameRemoveTimeMap=void 0,this.nameAnimationDelay=void 0,this.nameAnimationDuration=void 0,this.nameRemoveTime=void 0,this.id=t,this.color=a,this.height=0,this.status=ve.Deactivated,this.nameRemoveTimeMap=new Map,this.nameAnimationDelay=1,this.nameAnimationDuration=.2,this.nameRemoveTime=1e3*(this.nameAnimationDuration+this.nameAnimationDelay)}return Object(Y.a)(e,[{key:"updateCursor",value:function(e,t){this.removeCursor(),this.status=ve.Activated;var a=e.cursorCoords(t),n=document.createElement("span");this.height=a.bottom-a.top,n.classList.add("codePair-cursor"),n.style.borderLeftColor=this.color,n.style.height="".concat(this.height,"px"),this.marker=e.setBookmark(t,{widget:n,insertLeft:!0}),this.showCursorNameReserve(n)}},{key:"updateLine",value:function(e,t,a){this.removeLine(),this.status=ve.Activated,this.lineMarker=e.getDoc().markText(t,a,{css:"background-color : ".concat(this.color,"; opacity:0.7")})}},{key:"showCursorNameReserve",value:function(e){var t=this,a=document.createElement("span");a.classList.add("codePair-name"),e.addEventListener("mouseenter",(function(){t.nameRemoveTimeMap.has(t.id)&&clearTimeout(t.nameRemoveTimeMap.get(t.id)),a.textContent=t.id,a.style.top="-".concat(t.height,"px"),a.style.backgroundColor=t.color,a.style.color=ke()(t.color,!0),a.classList.remove("text-remove"),e.appendChild(a)})),e.addEventListener("mouseleave",(function(){a.classList.add("text-remove"),a.style.animationDuration="".concat(t.nameAnimationDuration,"s"),a.style.animationDelay="".concat(t.nameAnimationDelay,"s"),t.removeNameReserve(a)}))}},{key:"removeNameReserve",value:function(e){var t=this,a=setTimeout((function(){e.parentNode.removeChild(e),t.nameRemoveTimeMap.delete(t.id)}),this.nameRemoveTime);this.nameRemoveTimeMap.set(this.id,a)}},{key:"removeCursor",value:function(){this.marker&&(this.marker.clear(),this.marker=void 0)}},{key:"removeLine",value:function(){this.lineMarker&&(this.lineMarker.clear(),this.lineMarker=void 0)}},{key:"isActive",value:function(){return this.status===ve.Activated}}]),e}(),Ce=(a(135),a(136),a(138),a(139),a(141),a(142),a(144),a(145),a(146),a(147),a(148),a(149),a(151),a(152),a(153),a(154),Object(f.a)((function(){return{root:{display:"flex",height:"calc(100vh - 110px)",alignItems:"center",justifyContent:"center"}}})));function Se(e){var t=Object(l.b)(),a=Ce(),o=e.docKey,i=Object(l.c)((function(e){return e.docState.doc})),c=Object(l.c)((function(e){return e.docState.mode})),s=Object(l.c)((function(e){return e.docState.client})),u=Object(l.c)((function(e){return e.docState.loading})),d=Object(l.c)((function(e){return e.docState.errorMessage})),m=Object(l.c)((function(e){return e.peerState.peers})),p=Object(l.c)((function(e){return e.settingState.menu})),f=Object(n.useRef)(new Map),h=Object(n.useCallback)((function(e){var a,n=m[e];a=n&&n.status===le.Disconnected?n.color:me()(),f.current.set(e,new xe(e,a)),t(ye({id:e,color:a,status:le.Connected}))}),[m]),v=Object(n.useCallback)((function(e){f.current.has(e)&&(f.current.get(e).removeCursor(),f.current.delete(e)),t(je(e))}),[]);return Object(n.useEffect)((function(){t(U(!0)),t(B(o))}),[o,t]),Object(n.useEffect)((function(){var e=function(){};function a(){return(a=Object(P.a)(R.a.mark((function a(){return R.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(s&&i){a.next=2;break}return a.abrupt("return");case 2:return e=s.subscribe((function(e){if("peers-changed"===e.name){for(var t=e.value[i.getKey().toIDString()],a=0,n=Object.keys(m);a<n.length;a++){var r=n[a];t[r]||v(r)}for(var o=0,c=Object.keys(t);o<c.length;o++){var s=c[o];m[s]&&m[s].status!==le.Disconnected||h(s)}}})),a.next=5,s.sync();case 5:t($(i.getRootObject().mode||E.PlainText)),t(U(!1));case 7:case"end":return a.stop()}}),a)})))).apply(this,arguments)}return function(){a.apply(this,arguments)}(),function(){e()}}),[s,i,m,t]),u?r.a.createElement(q.a,{className:a.root},r.a.createElement(he.a,{color:"inherit"})):!d&&s&&i?r.a.createElement(ue.UnControlled,{options:{mode:c,theme:p.codeTheme,keyMap:p.codeKeyMap,tabSize:Number(p.tabSize),lineNumbers:!0,lineWrapping:!0,autoCloseTags:!0,autoCloseBrackets:!0},editorDidMount:function(e){e.focus();var t=function(t,a){f.current.has(t)&&f.current.get(t).updateCursor(e,a)};i.subscribe((function(a){"remote-change"===a.name&&a.value.forEach((function(a){var n=a.getID().actor;if(n!==s.getID()){if(!f.current.has(n))return;if(f.current.get(n).isActive())return;t(n,e.posFromIndex(0))}}))}));var a=i.getRootObject();a.content.onChanges((function(a){a.forEach((function(a){var n=a.actor,r=a.from,o=a.to;if("content"===a.type){var i=a.content||"";if(n!==s.getID()){var c=e.posFromIndex(r),l=e.posFromIndex(o);e.replaceRange(i,c,l,"yorkie")}}else if("selection"===a.type&&n!==s.getID()){var u=e.posFromIndex(r),d=e.posFromIndex(o);if(t(n,d),r>o){var m=[u,d];d=m[0],u=m[1]}!function(t,a,n){f.current.has(t)&&f.current.get(t).updateLine(e,a,n)}(n,u,d)}}))})),e.setSize("auto","calc(100vh - 110px)"),e.setValue(a.content.getValue())},onSelection:function(e,t){if(void 0!==t.origin){var a=e.indexFromPos(t.ranges[0].anchor),n=e.indexFromPos(t.ranges[0].head);i.update((function(e){e.content.updateSelection(a,n)}))}},onBeforeChange:function(e,t){if("yorkie"!==t.origin&&"setValue"!==t.origin){var a=e.indexFromPos(t.from),n=e.indexFromPos(t.to),r=t.text.join("\n");i.update((function(e){e.content.edit(a,n,r)}))}}}):r.a.createElement("div",{className:a.root},r.a.createElement(pe.a,{open:!0,anchorOrigin:{vertical:"top",horizontal:"center"}},r.a.createElement(fe.a,{severity:"warning"},d||"fail to attach document")))}var Te=Object(f.a)((function(){return Object(h.a)({root:{flexGrow:1}})}));function we(e){var t=Te(),a=e.match.params.docKey;return r.a.createElement("div",{className:t.root},r.a.createElement(j,null),r.a.createElement(se,null),r.a.createElement(Se,{docKey:a}))}var Me=a(18),Ne=Object(Me.c)({docState:G,peerState:Ee,settingState:re}),De=Object(A.a)({reducer:Ne,middleware:Object(A.d)({serializableCheck:{ignoredActions:["doc/attach/fulfilled"],ignoredPaths:["docState.client","docState.doc"]},immutableCheck:{ignoredPaths:["docState.client","docState.doc"]}})});a(155);var Re=function(){var e=Object(u.a)("(prefers-color-scheme: dark)"),t=Object(n.useMemo)((function(){return Object(m.a)({palette:{type:e?"dark":"light"}})}),[e]),a=Object(n.useCallback)((function(){return r.a.createElement(c.a,{to:"/".concat(Math.random().toString(36).substring(7))})}),[]);return r.a.createElement(l.a,{store:De},r.a.createElement(p.a,{theme:t},r.a.createElement(d.a,null),r.a.createElement(s.a,null,r.a.createElement(c.b,{path:"/",exact:!0,render:a}),r.a.createElement(c.b,{path:"/:docKey",exact:!0,component:we}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(Re,null),document.querySelector("#root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[157,1,2]]]);
//# sourceMappingURL=main.2c0a4656.chunk.js.map