(this["webpackJsonpyorkie-codepair"]=this["webpackJsonpyorkie-codepair"]||[]).push([[0],{114:function(e,t,n){},115:function(e,t,n){},117:function(e,t,n){"use strict";n.r(t);var a,r=n(0),o=n.n(r),c=n(6),i=n.n(c),s=n(73),u=n(9),l=n(21),m=n(155),d=n(154),h=n(27),v=n(62),f=n(10),p=n(38),O=n.n(p),E=n(63),g=n(48),b=n.n(g);!function(e){e.ATTACH_DOC="ATTACH_DOC",e.LOAD_DOC="LOAD_DOC",e.ERROR="ERROR"}(a||(a={}));var C,y,j={client:null,doc:null,loading:!1,errorMessage:""},k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case a.ATTACH_DOC:return Object(f.a)(Object(f.a)({},e),{},{client:t.client,doc:t.doc});case a.LOAD_DOC:return Object(f.a)(Object(f.a)({},e),{},{loading:t.loading});case a.ERROR:return Object(f.a)(Object(f.a)({},e),{},{errorMessage:t.errorMessage,doc:null});default:return e}},D=n(35);!function(e){e.Connected="connected",e.Disconnected="disconnected"}(C||(C={})),function(e){e.CONNECT_PEER="CONNECT_PEER",e.DISCONNECT_PEER="DISCONNECT_PEER"}(y||(y={}));var R={peers:{}},T=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R,t=arguments.length>1?arguments[1]:void 0,n=e.peers[t.id];switch(t.type){case y.CONNECT_PEER:return Object(f.a)(Object(f.a)({},e),{},{peers:Object(f.a)(Object(f.a)({},e.peers),{},Object(D.a)({},t.id,{id:t.id,color:t.color,status:C.Connected}))});case y.DISCONNECT_PEER:var a=Object(f.a)(Object(f.a)({},n),{},{status:C.Disconnected});return Object(f.a)(Object(f.a)({},e),{},{peers:Object(f.a)(Object(f.a)({},e.peers),{},Object(D.a)({},t.id,a))});default:return e}},x=Object(h.c)({docState:k,peerState:T});var N=n(147),w=n(160),M=n(75),A=n(148),S=n(150),L=n(151),_=n(152),P=n(67),I=n.n(P),F=n(159),B=n(156),K=Object(N.a)((function(e){return Object(w.a)({root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}})}));function H(){var e=K(),t=o.a.useState(null),n=Object(M.a)(t,2),a=n[0],r=n[1],c=Boolean(a),i=function(){r(null)};return o.a.createElement("div",{className:e.root},o.a.createElement(A.a,{position:"static"},o.a.createElement(S.a,null,o.a.createElement(L.a,{variant:"h6",className:e.title},"Yorkie CodePair"),o.a.createElement("div",null,o.a.createElement(_.a,{"aria-label":"settings","aria-controls":"menu-appbar","aria-haspopup":"true",onClick:function(e){r(e.currentTarget)},color:"inherit"},o.a.createElement(I.a,null)),o.a.createElement(B.a,{id:"menu-appbar",anchorEl:a,keepMounted:!0,open:c,onClose:i},o.a.createElement(F.a,{onClick:i},"Theme"),o.a.createElement(F.a,{onClick:i},"Editor Mode"),o.a.createElement(F.a,{onClick:i},"Tab Size"),o.a.createElement(F.a,{onClick:i},"Font Size"))))))}var z=n(68),G=n(157),V=n(158),J=n(153),W=n(69),q=n.n(W),U=n(70),Y=n(71),$=n(72),Q=n.n($),X=function(){function e(t,n){Object(U.a)(this,e),this.id=void 0,this.color=void 0,this.height=void 0,this.marker=void 0,this.lineMarker=void 0,this.nameRemoveTimeMap=void 0,this.nameAnimationDelay=void 0,this.nameAnimationDuration=void 0,this.nameRemoveTime=void 0,this.id=t,this.color=n,this.height=0,this.marker=null,this.lineMarker=null,this.nameRemoveTimeMap=new Map,this.nameAnimationDelay=1,this.nameAnimationDuration=.2,this.nameRemoveTime=1e3*(this.nameAnimationDuration+this.nameAnimationDelay)}return Object(Y.a)(e,[{key:"updateCursor",value:function(e,t){this.removeCursor();var n=e.cursorCoords(t),a=document.createElement("span");this.height=n.bottom-n.top,a.classList.add("codePair-cursor"),a.style.borderLeftColor=this.color,a.style.height="".concat(this.height,"px"),this.marker=e.setBookmark(t,{widget:a,insertLeft:!0}),this.showCursorNameReserve(a)}},{key:"updateLine",value:function(e,t,n){this.removeLine(),this.lineMarker=e.getDoc().markText(t,n,{css:"background-color : ".concat(this.color,"; opacity:0.7")})}},{key:"showCursorNameReserve",value:function(e){var t=this,n=document.createElement("span");n.classList.add("codePair-name"),e.addEventListener("mouseenter",(function(){t.nameRemoveTimeMap.has(t.id)&&clearTimeout(t.nameRemoveTimeMap.get(t.id)),n.textContent=t.id,n.style.top="-".concat(t.height,"px"),n.style.backgroundColor=t.color,n.style.color=Q()(t.color,!0),n.classList.remove("text-remove"),e.appendChild(n)})),e.addEventListener("mouseleave",(function(){n.classList.add("text-remove"),n.style.animationDuration="".concat(t.nameAnimationDuration,"s"),n.style.animationDelay="".concat(t.nameAnimationDelay,"s"),t.removeNameReserve(n)}))}},{key:"removeNameReserve",value:function(e){var t=this,n=setTimeout((function(){e.parentNode.removeChild(e),t.nameRemoveTimeMap.delete(t.id)}),this.nameRemoveTime);this.nameRemoveTimeMap.set(this.id,n)}},{key:"removeCursor",value:function(){this.marker&&(this.marker.clear(),this.marker=null)}},{key:"removeLine",value:function(){this.lineMarker&&(this.lineMarker.clear(),this.lineMarker=null)}}]),e}(),Z=(n(112),n(113),n(114),Object(N.a)((function(e){return{root:{width:"100%","& > * + *":{marginTop:e.spacing(2)}}}})));function ee(e){var t=Object(l.b)(),n=Z(),c=e.docKey,i=Object(l.c)((function(e){return e.docState.doc})),s=Object(l.c)((function(e){return e.docState.client})),u=Object(l.c)((function(e){return e.docState.loading})),m=Object(l.c)((function(e){return e.docState.errorMessage})),d=Object(l.c)((function(e){return e.peerState.peers})),h=Object(r.useRef)(new Map),v=function(e){var n,a=d[e];n=a&&a.status===C.Disconnected?a.color:q()();var r=new X(e,n);h.current.set(e,r),t(function(e,t){return{type:y.CONNECT_PEER,id:e,color:t}}(e,n))};return Object(r.useEffect)((function(){var e;t((e=!0,function(t){return t({type:a.LOAD_DOC,loading:e})})),t(function(e){return function(){var t=Object(E.a)(O.a.mark((function t(n){var r,o;return O.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=b.a.createClient("".concat("/api")),t.next=4,r.activate();case 4:return o=b.a.createDocument("codepairs",e),t.next=7,r.attach(o);case 7:return o.update((function(e){e.content||e.createText("content")})),t.next=10,r.sync();case 10:n({type:a.ATTACH_DOC,doc:o,client:r}),t.next=17;break;case 13:t.prev=13,t.t0=t.catch(0),console.error(t.t0),n({type:a.ERROR,errorMessage:t.t0.message});case 17:n({type:a.LOAD_DOC,loading:!1});case 18:case"end":return t.stop()}}),t,null,[[0,13]])})));return function(e){return t.apply(this,arguments)}}()}(c))}),[c,t]),Object(r.useEffect)((function(){if(!s||!i)return function(){};var e=function(e){var n;h.current.has(e)&&(h.current.get(e).removeCursor(),h.current.delete(e)),t((n=e,{type:y.DISCONNECT_PEER,id:n}))},n=s.subscribe((function(t){if("documents-watching-peer-changed"===t.name)for(var n=t.value[i.getKey().toIDString()],a=new Set(n),r=0,o=Object.keys(d);r<o.length;r++){var c=o[r];a.has(c)&&d[c].status===C.Connected||e(c)}}));return function(){n()}}),[s,i,d,t]),u?o.a.createElement(G.a,{height:"100%"},o.a.createElement(J.a,{color:"secondary"})):m||null===s||null===i?o.a.createElement("div",{className:n.root},o.a.createElement(V.a,{severity:"error"},m||"fail to attach document")):o.a.createElement(z.UnControlled,{options:{mode:"xml",theme:"monokai",lineNumbers:!0},editorDidMount:function(e){var t=function(t,n){h.current.get(t).updateCursor(e,n)};i.subscribe((function(n){"remote-change"===n.name&&n.value.forEach((function(n){var a=n.id.actor;a!==s.getID()&&(h.current.has(a)||(v(a),t(a,e.posFromIndex(0))))}))}));var n=i.getRootObject();n.content.onChanges((function(n){n.forEach((function(n){var a=n.actor,r=n.from,o=n.to;if("content"===n.type){var c=n.content||"";if(a!==s.getID()){var i=e.posFromIndex(r),u=e.posFromIndex(o);e.replaceRange(c,i,u,"yorkie")}}else if("selection"===n.type&&a!==s.getID()){h.current.has(a)||v(a);var l=e.posFromIndex(r),m=e.posFromIndex(o);if(t(a,m),r>o){var d=[l,m];m=d[0],l=d[1]}!function(t,n,a){h.current.get(t).updateLine(e,n,a)}(a,l,m)}}))})),e.setSize("auto","calc(100vh - 64px)"),e.setValue(n.content.getValue())},onSelection:function(e,t){if(void 0!==t.origin){var n=e.indexFromPos(t.ranges[0].anchor),a=e.indexFromPos(t.ranges[0].head);i.update((function(e){e.content.updateSelection(n,a)}))}},onBeforeChange:function(e,t){if("yorkie"!==t.origin&&"setValue"!==t.origin){var n=e.indexFromPos(t.from),a=e.indexFromPos(t.to),r=t.text.join("\n");i.update((function(e){e.content.edit(n,a,r)}))}}})}var te=Object(N.a)((function(){return Object(w.a)({root:{flexGrow:1}})}));function ne(e){var t=te(),n=e.match.params.docKey;return o.a.createElement("div",{className:t.root},o.a.createElement(H,null),o.a.createElement(ee,{docKey:n}))}var ae=n(74),re=Object(ae.a)({palette:{type:"dark"}}),oe=(n(115),Object(h.d)(x,void 0,Object(h.a)(v.a)));var ce=function(){return o.a.createElement(l.a,{store:oe},o.a.createElement(d.a,{theme:re},o.a.createElement(m.a,null),o.a.createElement(s.a,null,o.a.createElement(u.b,{path:"/",exact:!0,render:function(){return o.a.createElement(u.a,{to:"/".concat(Math.random().toString(36).substring(7))})}}),o.a.createElement(u.b,{path:"/:docKey",exact:!0,component:ne}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(ce,null),document.querySelector("#root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[117,1,2]]]);
//# sourceMappingURL=main.30fe2504.chunk.js.map