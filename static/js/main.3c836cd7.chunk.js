(this["webpackJsonpyorkie-codepair"]=this["webpackJsonpyorkie-codepair"]||[]).push([[0],{160:function(e,t,a){},161:function(e,t,a){},163:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(8),o=a.n(c),i=a(11),u=a(13),s=a(94),l=a(208),d=a(210),m=a(95),f=a(209),v=a(198),p=a(218),h=a(202),b=a(203),g=a(200),y=a(17),j=a(169),O=a(201),E=a(216),k=a(50),x=a.n(k),C=a(213);function S(e){var t=e.anchorEl,a=e.onClose,n=e.children,c=Boolean(t);return r.a.createElement(C.a,{id:c?"simple-popover":void 0,open:c,anchorEl:t,onClose:a,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},n)}var T=a(199),w=a(167),M=Object(v.a)((function(){return{root:function(e){return{color:e.peer.metadata.color}}}}));function D(e){var t=M(e),a=e.peer;return r.a.createElement(w.a,{className:t.root},a.metadata.username)}var N,R=a(25);!function(e){e.Connected="connected",e.Disconnected="disconnected"}(N||(N={}));var P=Object(R.c)({name:"peer",initialState:{peers:{}},reducers:{syncPeer:function(e,t){for(var a=t.payload,n=e.peers,r=0,c=Object.keys(n);r<c.length;r++){var o=c[r];a[o]||(n[o].status=N.Disconnected)}for(var i=0,u=Object.entries(a);i<u.length;i++){var s=Object(y.a)(u[i],2),l=s[0],d=s[1];if(!n[l]||n[l].status===N.Disconnected){var m={id:l,status:N.Connected,metadata:d};e.peers[l]=m}}}}}),I=P.actions.syncPeer,A=P.reducer;function L(){var e=Object(i.c)((function(e){return e.docState.client})),t=Object(i.c)((function(e){return e.peerState.peers}));return{activePeers:Object(n.useMemo)((function(){return e?Object.entries(t).filter((function(t){var a=Object(y.a)(t,2),n=a[0],r=a[1];return e.getID()!==n&&r.status===N.Connected})).map((function(e){var t=Object(y.a)(e,2);t[0];return t[1]})):[]}),[e,t])}}function z(){var e=L().activePeers;return r.a.createElement(T.a,null,r.a.createElement(w.a,null,r.a.createElement(g.a,null,"Total ",e.length)),e.map((function(e){return r.a.createElement(D,{key:e.id,peer:e})})))}var K=Object(v.a)((function(){return{group:{"& > *":{cursor:"pointer"}}}}));function V(){var e=K(),t=Object(i.c)((function(e){return e.docState.client})),a=L().activePeers,c=Object(n.useState)(),o=Object(y.a)(c,2),u=o[0],s=o[1],l=Object(n.useCallback)((function(e){e.target.getAttribute("data-id")||s(e.currentTarget)}),[s]),d=Object(n.useCallback)((function(){s(void 0)}),[s]);return t?r.a.createElement(r.a.Fragment,null,r.a.createElement(O.a,{className:e.group,max:4,onClick:l},a.map((function(e){var t=e.metadata,a=t.username,n=t.color,c=t.image;return r.a.createElement(E.a,{key:e.id,title:a,"data-id":e.id,arrow:!0},r.a.createElement(j.a,{alt:"Peer Image",style:{backgroundColor:n},src:x.a.getImage(c)}))}))),r.a.createElement(S,{anchorEl:u,onClose:d},r.a.createElement(z,null))):null}var F=Object(v.a)((function(e){return Object(p.a)({root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}})}));function B(){var e=F();return r.a.createElement("div",{className:e.root},r.a.createElement(h.a,{position:"static"},r.a.createElement(b.a,null,r.a.createElement(g.a,{variant:"h6",className:e.title},"Yorkie CodePair"),r.a.createElement(V,null))))}var W,J=Object(n.memo)(B),U=a(211),$=a(205),G=a(204),q=a(206),H=a(91),Y=a.n(H),Q=a(30),X=a.n(Q),Z=a(48),_=a(67),ee=a.n(_),te=a(90),ae=a.n(te);!function(e){e.PlainText="text/plain",e.Go="go",e.JavaScript="javascript",e.Clojure="clojure",e.Dart="dart",e.Python="python",e.Ruby="ruby",e.Rust="rust"}(W||(W={}));var ne,re,ce,oe={client:void 0,doc:void 0,mode:W.PlainText,loading:!0,errorMessage:""},ie=Object(R.b)("doc/activate",function(){var e=Object(Z.a)(X.a.mark((function e(t,a){var n,r,c,o;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=x.a.generate(),r=n.name,c=n.animal,o=ee.a.createClient("".concat("/api"),{metadata:{username:r,image:c,color:ae()()}}),e.next=5,o.activate();case 5:return e.abrupt("return",{client:o});case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",a.rejectWithValue(e.t0.message));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,a){return e.apply(this,arguments)}}()),ue=Object(R.b)("doc/attach",function(){var e=Object(Z.a)(X.a.mark((function e(t,a){var n,r;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.client,r=t.doc,e.prev=1,e.next=4,n.attach(r);case 4:return r.update((function(e){e.content||e.createText("content")})),e.next=7,n.sync();case 7:return e.abrupt("return",{doc:r,client:n});case 10:return e.prev=10,e.t0=e.catch(1),e.abrupt("return",a.rejectWithValue(e.t0.message));case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t,a){return e.apply(this,arguments)}}()),se=Object(R.c)({name:"doc",initialState:oe,reducers:{deactivateClient:function(e){var t=e.client;e.client=void 0,null===t||void 0===t||t.deactivate()},createDocument:function(e,t){e.doc=ee.a.createDocument("codepairs",t.payload)},detachDocument:function(e){var t=e.doc,a=e.client;e.doc=void 0,null===a||void 0===a||a.detach(t)},attachDocLoading:function(e,t){e.loading=t.payload},setCodeMode:function(e,t){e.mode=t.payload}},extraReducers:function(e){e.addCase(ie.fulfilled,(function(e,t){var a=t.payload;e.client=a.client})),e.addCase(ie.rejected,(function(e,t){var a=t.payload;e.errorMessage=a})),e.addCase(ue.fulfilled,(function(e,t){var a=t.payload;e.doc=a.doc,e.client=a.client})),e.addCase(ue.rejected,(function(e,t){var a=t.payload;e.errorMessage=a}))}}),le=se.actions,de=le.deactivateClient,me=le.createDocument,fe=le.detachDocument,ve=le.attachDocLoading,pe=le.setCodeMode,he=se.reducer,be=a(212),ge=a(62),ye=a(63),je=function(){function e(t){Object(ge.a)(this,e),this.key=void 0,this.storage=void 0,this.key=t,this.storage=window.localStorage}return Object(ye.a)(e,[{key:"getValue",value:function(e){try{return JSON.parse(this.storage[this.key])}catch(t){return e}}},{key:"setValue",value:function(e){this.storage[this.key]=JSON.stringify(e)}}]),e}();!function(e){e.Material="material",e.Monokai="monokai"}(ne||(ne={})),function(e){e.Sublime="sublime",e.Vim="vim",e.Emacs="emacs"}(re||(re={})),function(e){e.Two="2",e.Four="4",e.Eight="8"}(ce||(ce={}));var Oe=new je("$$codepair$$setting"),Ee=Oe.getValue({menu:{codeTheme:ne.Monokai,codeKeyMap:re.Sublime,tabSize:ce.Two}}),ke=Object(R.c)({name:"setting",initialState:Ee,reducers:{setCodeTheme:function(e,t){e.menu.codeTheme=t.payload,Oe.setValue(e)},setCodeKeyMap:function(e,t){e.menu.codeKeyMap=t.payload,Oe.setValue(e)},setTabSize:function(e,t){e.menu.tabSize=t.payload,Oe.setValue(e)}}}),xe=ke.actions,Ce=xe.setCodeTheme,Se=xe.setCodeKeyMap,Te=xe.setTabSize,we=ke.reducer,Me=Object(v.a)((function(e){return Object(p.a)({root:{width:"400px",minWidth:"320px",borderRadius:"4px"},header:{borderBottom:"1px solid ".concat(e.palette.text.disabled)},title:{padding:"12px 16px"},list:{padding:"12px 24px",lineHeight:"19px"},item:{display:"flex",justifyContent:"space-between",fontSize:"15px",marginTop:"12px"},itemTitle:{whiteSpace:"nowrap",display:"flex",alignItems:"center"},itemInfo:{minWidth:140,paddingLeft:"12px",border:"1px solid #aaa",borderRadius:"4px",textAlign:"left"}})})),De=function(){var e=Object(i.b)(),t=Me(),a=Object(i.c)((function(e){return e.settingState.menu}));function n(t){return function(a){e(t(a.target.value))}}return r.a.createElement("div",{className:t.root},r.a.createElement(be.a,null,r.a.createElement("header",{className:t.header},r.a.createElement(g.a,{className:t.title,variant:"h6"},"Settings"))),r.a.createElement("div",{className:t.list},r.a.createElement("div",{className:t.item},r.a.createElement("div",{className:t.itemTitle},"Theme"),r.a.createElement(G.a,{className:t.itemInfo},r.a.createElement(U.a,{value:a.codeTheme,onChange:n(Ce),disableUnderline:!0,displayEmpty:!0},Object.entries(ne).map((function(e){var t=Object(y.a)(e,2),a=t[0],n=t[1];return r.a.createElement($.a,{value:n,key:n},a)}))))),r.a.createElement("div",{className:t.item},r.a.createElement("div",{className:t.itemTitle},"Key binding"),r.a.createElement(G.a,{className:t.itemInfo},r.a.createElement(U.a,{value:a.codeKeyMap,onChange:n(Se),disableUnderline:!0,displayEmpty:!0},Object.entries(re).map((function(e){var t=Object(y.a)(e,2),a=t[0],n=t[1];return r.a.createElement($.a,{value:n,key:n},a)}))))),r.a.createElement("div",{className:t.item},r.a.createElement("div",{className:t.itemTitle},"Tab Size"),r.a.createElement(G.a,{className:t.itemInfo},r.a.createElement(U.a,{value:a.tabSize,onChange:n(Te),disableUnderline:!0,displayEmpty:!0},Object.entries(ce).map((function(e){var t=Object(y.a)(e,2),a=t[0],n=t[1];return r.a.createElement($.a,{value:n,key:a},"".concat(n," spaces"))})))))))},Ne=Object(v.a)((function(e){return Object(p.a)({root:{padding:"6px",position:"relative"},formControl:{minWidth:140,border:"1px solid ".concat(e.palette.grey[800]),borderRadius:"4px"},selectEmpty:{paddingLeft:"12px"},settingsButton:{float:"right",padding:"7px"}})}));function Re(){var e=Ne(),t=Object(i.b)(),a=Object(i.c)((function(e){return e.docState.doc})),c=Object(i.c)((function(e){return e.docState.mode})),o=Object(n.useState)(),u=Object(y.a)(o,2),s=u[0],l=u[1];Object(n.useEffect)((function(){if(!a)return function(){};var e=a.subscribe((function(e){"remote-change"===e.name&&t(pe(a.getRootObject().mode||W.PlainText))}));return function(){e()}}),[a]);var d=Object(n.useCallback)((function(e){if(a){var n=e.target.value;a.update((function(e){e.mode=n})),t(pe(n))}}),[a,t]),m=Object(n.useCallback)((function(e){l(e.currentTarget)}),[]),f=Object(n.useCallback)((function(){l(void 0)}),[]);return r.a.createElement("div",{className:e.root},r.a.createElement(G.a,{className:e.formControl},r.a.createElement(E.a,{title:"Syntax",arrow:!0},r.a.createElement(U.a,{name:"codeMode",value:c,onChange:d,className:e.selectEmpty,disableUnderline:!0,displayEmpty:!0},Object.entries(W).map((function(e){var t=Object(y.a)(e,2),a=t[0],n=t[1];return r.a.createElement($.a,{value:n,key:n},a)}))))),r.a.createElement(E.a,{title:"Settings",arrow:!0},r.a.createElement(q.a,{className:e.settingsButton,"aria-label":"settings",onClick:m},r.a.createElement(Y.a,{fontSize:"small"}))),r.a.createElement(S,{anchorEl:s,onClose:f},r.a.createElement(De,null)))}var Pe,Ie=a(217),Ae=a(214),Le=a(207),ze=a(92),Ke=a(93),Ve=a.n(Ke);!function(e){e.Deactivated="deactivated",e.Activated="activated"}(Pe||(Pe={}));var Fe=function(){function e(t,a){Object(ge.a)(this,e),this.id=void 0,this.username=void 0,this.color=void 0,this.height=void 0,this.marker=void 0,this.lineMarker=void 0,this.status=void 0,this.nameRemoveTimeMap=void 0,this.nameAnimationDelay=void 0,this.nameAnimationDuration=void 0,this.nameRemoveTime=void 0,this.id=t,this.username=a.username,this.color=a.color,this.height=0,this.status=Pe.Deactivated,this.nameRemoveTimeMap=new Map,this.nameAnimationDelay=1,this.nameAnimationDuration=.2,this.nameRemoveTime=1e3*(this.nameAnimationDuration+this.nameAnimationDelay)}return Object(ye.a)(e,[{key:"updateCursor",value:function(e,t){this.removeCursor(),this.status=Pe.Activated;var a=e.cursorCoords(t),n=document.createElement("span");this.height=a.bottom-a.top,n.classList.add("codePair-cursor"),n.style.borderLeftColor=this.color,n.style.height="".concat(this.height,"px"),this.marker=e.setBookmark(t,{widget:n,insertLeft:!0}),this.showCursorNameReserve(n)}},{key:"updateLine",value:function(e,t,a){this.removeLine(),this.status=Pe.Activated,this.lineMarker=e.getDoc().markText(t,a,{css:"background-color : ".concat(this.color,"; opacity:0.7")})}},{key:"showCursorNameReserve",value:function(e){var t=this,a=document.createElement("span");a.classList.add("codePair-name"),e.addEventListener("mouseenter",(function(){t.nameRemoveTimeMap.has(t.id)&&clearTimeout(t.nameRemoveTimeMap.get(t.id)),a.textContent=t.username,a.style.top="-".concat(t.height,"px"),a.style.backgroundColor=t.color,a.style.color=Ve()(t.color,!0),a.classList.remove("text-remove"),e.appendChild(a)})),e.addEventListener("mouseleave",(function(){a.classList.add("text-remove"),a.style.animationDuration="".concat(t.nameAnimationDuration,"s"),a.style.animationDelay="".concat(t.nameAnimationDelay,"s"),t.removeNameReserve(a)}))}},{key:"removeNameReserve",value:function(e){var t=this,a=setTimeout((function(){e.parentNode.removeChild(e),t.nameRemoveTimeMap.delete(t.id)}),this.nameRemoveTime);this.nameRemoveTimeMap.set(this.id,a)}},{key:"removeCursor",value:function(){this.marker&&(this.marker.clear(),this.marker=void 0)}},{key:"removeLine",value:function(){this.lineMarker&&(this.lineMarker.clear(),this.lineMarker=void 0)}},{key:"clear",value:function(){this.removeCursor(),this.removeLine()}},{key:"isActive",value:function(){return this.status===Pe.Activated}}]),e}();a(141),a(142),a(144),a(145),a(147),a(148),a(150),a(151),a(152),a(153),a(154),a(155),a(157),a(158),a(159),a(160);function Be(){var e=Object(i.c)((function(e){return e.docState.doc})),t=Object(i.c)((function(e){return e.docState.mode})),a=Object(i.c)((function(e){return e.docState.client})),c=Object(i.c)((function(e){return e.peerState.peers})),o=Object(i.c)((function(e){return e.settingState.menu})),u=Object(n.useRef)(new Map),s=Object(n.useCallback)((function(e,t){u.current.set(e,new Fe(e,t))}),[c]),l=Object(n.useCallback)((function(e){u.current.has(e)&&(u.current.get(e).clear(),u.current.delete(e))}),[]);return Object(n.useEffect)((function(){for(var e=0,t=Object.entries(c);e<t.length;e++){var a=Object(y.a)(t[e],2),n=a[0],r=a[1];u.current.has(n)&&r.status===N.Disconnected?l(n):u.current.has(n)||r.status!==N.Connected||s(n,r.metadata)}}),[c]),a&&e?r.a.createElement(ze.UnControlled,{options:{mode:t,theme:o.codeTheme,keyMap:o.codeKeyMap,tabSize:Number(o.tabSize),lineNumbers:!0,lineWrapping:!0,autoCloseTags:!0,autoCloseBrackets:!0},editorDidMount:function(t){t.focus();var n=function(e,a){var n=u.current.get(e);null===n||void 0===n||n.updateCursor(t,a)};e.subscribe((function(e){"remote-change"===e.name&&e.value.forEach((function(e){var r=e.getID().actor;if(r!==a.getID()){if(!u.current.has(r))return;if(u.current.get(r).isActive())return;n(r,t.posFromIndex(0))}}))}));var r=e.getRootObject();r.content.onChanges((function(e){e.forEach((function(e){var r=e.actor,c=e.from,o=e.to;if("content"===e.type){var i=e.content||"";if(r!==a.getID()){var s=t.posFromIndex(c),l=t.posFromIndex(o);t.replaceRange(i,s,l,"yorkie")}}else if("selection"===e.type&&r!==a.getID()){var d=t.posFromIndex(c),m=t.posFromIndex(o);if(n(r,m),c>o){var f=[d,m];m=f[0],d=f[1]}!function(e,a,n){var r=u.current.get(e);null===r||void 0===r||r.updateLine(t,a,n)}(r,d,m)}}))})),t.setSize("auto","calc(100vh - 110px)"),t.setValue(r.content.getValue())},onSelection:function(t,a){if(void 0!==a.origin){var n=t.indexFromPos(a.ranges[0].anchor),r=t.indexFromPos(a.ranges[0].head);e.update((function(e){e.content.updateSelection(n,r)}))}},onBeforeChange:function(t,a){if("yorkie"!==a.origin&&"setValue"!==a.origin){var n=t.indexFromPos(a.from),r=t.indexFromPos(a.to),c=a.text.join("\n");e.update((function(e){e.content.edit(n,r,c)}))}}}):null}var We=Object(v.a)((function(){return Object(p.a)({loading:{display:"flex",height:"calc(100vh - 110px)",alignItems:"center",justifyContent:"center"}})}));function Je(e){var t=e.docKey,a=We(),c=Object(i.b)(),o=Object(i.c)((function(e){return e.docState.client})),u=Object(i.c)((function(e){return e.docState.doc})),s=Object(i.c)((function(e){return e.docState.loading})),l=Object(i.c)((function(e){return e.docState.errorMessage}));return Object(n.useEffect)((function(){return c(ie()),function(){c(de())}}),[]),Object(n.useEffect)((function(){if(!o||!u)return function(){};var e=o.subscribe((function(e){if("peers-changed"===e.name){var t=u.getKey().toIDString(),a=e.value[t];c(I(a))}}));return function(){e()}}),[o,u]),Object(n.useEffect)((function(){return c(me(t)),function(){c(fe())}}),[t]),Object(n.useEffect)((function(){function e(){return(e=Object(Z.a)(X.a.mark((function e(){return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o&&u){e.next=2;break}return e.abrupt("return");case 2:return c(ve(!0)),e.next=5,c(ue({client:o,doc:u}));case 5:c(pe(u.getRootObject().mode||W.PlainText)),c(ve(!1));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return function(){e.apply(this,arguments)}(),function(){c(ve(!0))}}),[t,o,u]),o&&u?s?r.a.createElement(be.a,{className:a.loading},r.a.createElement(Le.a,{color:"inherit"})):l?r.a.createElement("div",null,r.a.createElement(Ie.a,{open:!0,anchorOrigin:{vertical:"top",horizontal:"center"}},r.a.createElement(Ae.a,{severity:"warning"},l||"fail to attach document"))):r.a.createElement(Be,null):null}var Ue=Object(v.a)((function(){return Object(p.a)({root:{flexGrow:1}})}));function $e(e){var t=Ue(),a=e.match.params.docKey;return r.a.createElement("div",{className:t.root},r.a.createElement(J,null),r.a.createElement(Re,null),r.a.createElement(Je,{docKey:a}))}a(161);var Ge=function(){var e=Object(l.a)("(prefers-color-scheme: dark)"),t=Object(n.useMemo)((function(){return Object(m.a)({palette:{type:e?"dark":"light"}})}),[e]),a=Object(n.useCallback)((function(){return r.a.createElement(u.a,{to:"/".concat(Math.random().toString(36).substring(7))})}),[]);return r.a.createElement(f.a,{theme:t},r.a.createElement(d.a,null),r.a.createElement(s.a,null,r.a.createElement(u.b,{path:"/",exact:!0,render:a}),r.a.createElement(u.b,{path:"/:docKey",exact:!0,component:$e})))},qe=a(19),He=Object(qe.c)({docState:he,peerState:A,settingState:we}),Ye=Object(R.a)({reducer:He,middleware:Object(R.d)({serializableCheck:{ignoredActions:["doc/attach/fulfilled","doc/activate/fulfilled"],ignoredPaths:["docState.client","docState.doc"]},immutableCheck:{ignoredPaths:["docState.client","docState.doc"]}})});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(i.a,{store:Ye},r.a.createElement(Ge,null)),document.querySelector("#root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[163,1,2]]]);
//# sourceMappingURL=main.3c836cd7.chunk.js.map