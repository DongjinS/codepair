(this["webpackJsonpyorkie-codepair"]=this["webpackJsonpyorkie-codepair"]||[]).push([[0],{116:function(e,t,n){},117:function(e,t,n){},119:function(e,t,n){"use strict";n.r(t);var r,a=n(0),o=n.n(a),c=n(6),i=n.n(c),s=n(48),l=n(9),u=n(21),d=n(157),m=n(156),h=n(27),p=n(63),f=n(11),v=n(38),O=n.n(v),b=n(64),g=n(50),E=n.n(g);!function(e){e.ATTACH_DOC="ATTACH_DOC",e.LOAD_DOC="LOAD_DOC",e.ERROR="ERROR"}(r||(r={}));var C,y,j={client:null,doc:null,loading:!1,errorMessage:""},k=n(35);!function(e){e.Connected="connected",e.Disconnected="disconnected"}(C||(C={})),function(e){e.CONNECT_PEER="CONNECT_PEER",e.DISCONNECT_PEER="DISCONNECT_PEER"}(y||(y={}));var x={peers:{}},D=Object(h.c)({docState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case r.ATTACH_DOC:return Object(f.a)(Object(f.a)({},e),{},{client:t.client,doc:t.doc});case r.LOAD_DOC:return Object(f.a)(Object(f.a)({},e),{},{loading:t.loading});case r.ERROR:return Object(f.a)(Object(f.a)({},e),{},{errorMessage:t.errorMessage,doc:null});default:return e}},peerState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,t=arguments.length>1?arguments[1]:void 0,n=e.peers[t.id];switch(t.type){case y.CONNECT_PEER:return Object(f.a)(Object(f.a)({},e),{},{peers:Object(f.a)(Object(f.a)({},e.peers),{},Object(k.a)({},t.id,{id:t.id,color:t.color,status:C.Connected}))});case y.DISCONNECT_PEER:var r=Object(f.a)(Object(f.a)({},n),{},{status:C.Disconnected});return Object(f.a)(Object(f.a)({},e),{},{peers:Object(f.a)(Object(f.a)({},e.peers),{},Object(k.a)({},t.id,r))});default:return e}}});var R=n(149),N=n(162),w=n(76),T=n(150),S=n(152),M=n(153),_=n(154),L=n(68),A=n.n(L),I=n(161),P=n(158),F=Object(R.a)((function(e){return Object(N.a)({root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}})}));function K(){var e=F(),t=o.a.useState(null),n=Object(w.a)(t,2),r=n[0],a=n[1],c=Boolean(r),i=function(){a(null)};return o.a.createElement("div",{className:e.root},o.a.createElement(T.a,{position:"static"},o.a.createElement(S.a,null,o.a.createElement(M.a,{variant:"h6",className:e.title},"Yorkie CodePair"),o.a.createElement("div",null,o.a.createElement(_.a,{"aria-label":"settings","aria-controls":"menu-appbar","aria-haspopup":"true",onClick:function(e){a(e.currentTarget)},color:"inherit"},o.a.createElement(A.a,null)),o.a.createElement(P.a,{id:"menu-appbar",anchorEl:r,keepMounted:!0,open:c,onClose:i},o.a.createElement(I.a,{onClick:i},"Theme"),o.a.createElement(I.a,{onClick:i},"Editor Mode"),o.a.createElement(I.a,{onClick:i},"Tab Size"),o.a.createElement(I.a,{onClick:i},"Font Size"))))))}var B=n(69),H=n(70),z=n(159),G=n(160),V=n(155),W=n(71),J=n.n(W),q=n(72),U=n(73),Y=n(74),$=n.n(Y),Q=new Map,X=function(){function e(t,n){Object(q.a)(this,e),this.id=void 0,this.color=void 0,this.height=void 0,this.marker=void 0,this.lineMarker=void 0,this.id=t,this.color=n,this.height=0,this.marker=null,this.lineMarker=null}return Object(U.a)(e,[{key:"updateCursor",value:function(e,t){this.removeCursor();var n=e.cursorCoords(t),r=document.createElement("span");this.height=n.bottom-n.top,r.style.position="absolute",r.style.borderLeftStyle="solid",r.style.borderLeftWidth="2.5px",r.style.borderLeftColor=this.color,r.style.height="".concat(this.height,"px"),r.style.padding="0px",this.showCursorNameReserve(r),this.marker=e.setBookmark(t,{widget:r,insertLeft:!0})}},{key:"updateLine",value:function(e,t,n){this.removeLine(),this.lineMarker=e.getDoc().markText(t,n,{css:"background-color : ".concat(this.color,"; opacity:0.7")})}},{key:"showCursorNameReserve",value:function(e){var t=this,n=document.createElement("span");e.addEventListener("mouseenter",(function(){n.textContent=t.id,n.classList.remove("text-remove"),n.style.position="absolute",n.style.top="-".concat(t.height,"px"),n.style.left="-2px",n.style.backgroundColor=t.color,n.style.padding="1px 4px",n.style.borderRadius="4px 4px 4px 0px",n.style.color=$()(t.color,!0),e.appendChild(n)})),e.addEventListener("mouseleave",(function(){n.className="text-remove",n.style.animationDuration="".concat(.2,"s"),n.style.animationDelay="".concat(1,"s"),t.removeNameReserve(n)}))}},{key:"removeNameReserve",value:function(e){var t=this;Q.has(this.id)&&clearTimeout(Q.get(this.id));var n=window.setTimeout((function(){e.parentNode&&(e.parentNode.removeChild(e),Q.delete(t.id))}),1200);Q.set(this.id,n)}},{key:"removeCursor",value:function(){this.marker&&(this.marker.clear(),this.marker=null)}},{key:"removeLine",value:function(){this.lineMarker&&(this.lineMarker.clear(),this.lineMarker=null)}}],[{key:"of",value:function(t,n){return new e(t,n)}}]),e}(),Z=(n(114),n(115),n(116),Object(R.a)((function(e){return{root:{width:"100%","& > * + *":{marginTop:e.spacing(2)}}}})));function ee(e){var t=Object(u.b)(),n=Z(),c=Object(u.c)((function(e){return e.docState.doc})),i=Object(u.c)((function(e){return e.docState.client})),s=Object(u.c)((function(e){return e.docState.loading})),l=Object(u.c)((function(e){return e.docState.errorMessage})),d=Object(u.c)((function(e){return e.peerState.peers})),m=Object(a.useRef)(new Map),h=function(e){var n,r=d[e];n=r&&r.status===C.Disconnected?r.color:J()();var a=X.of(e,n);m.current.set(e,a),t(function(e,t){return{type:y.CONNECT_PEER,id:e,color:t}}(e,n))};return Object(a.useEffect)((function(){var n,a;t((n=!0,function(e){return e({type:r.LOAD_DOC,loading:n})})),t((a=e.docKey,function(){var e=Object(b.a)(O.a.mark((function e(t){var n,o;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=E.a.createClient("".concat("/api")),e.next=4,n.activate();case 4:return o=E.a.createDocument("codepairs",a),e.next=7,n.attach(o);case 7:return o.update((function(e){e.content||e.createText("content")})),e.next=10,n.sync();case 10:t({type:r.ATTACH_DOC,doc:o,client:n}),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),console.error(e.t0),t({type:r.ERROR,errorMessage:e.t0.message});case 17:t({type:r.LOAD_DOC,loading:!1});case 18:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t){return e.apply(this,arguments)}}()))}),[e.docKey,t]),Object(a.useEffect)((function(){if(i&&c){var e=function(e){var n;m.current.has(e)&&(m.current.get(e).removeCursor(),m.current.delete(e)),t((n=e,{type:y.DISCONNECT_PEER,id:n}))},n=i.subscribe((function(t){if("documents-watching-peer-changed"===t.name)for(var n=t.value[c.getKey().toIDString()],r=new Set(n),a=0,o=Object.keys(d);a<o.length;a++){var i=o[a];r.has(i)&&d[i].status===C.Connected||e(i)}}));return function(){n()}}}),[i,c,d,t]),s?o.a.createElement(z.a,{height:"100%"},o.a.createElement(V.a,{color:"secondary"})):l||null===i||null===c?o.a.createElement("div",{className:n.root},o.a.createElement(G.a,{severity:"error"},l||"fail to attach document")):o.a.createElement(H.UnControlled,{options:{mode:"xml",theme:"monokai",lineNumbers:!0},editorDidMount:function(e){var t=function(t,n){m.current.get(t).updateCursor(e,n)},n=function(t,n,r){m.current.get(t).updateLine(e,n,r)};null===c||void 0===c||c.subscribe((function(n){"remote-change"===n.name&&n.value.forEach((function(n){var r=n.id.actor;r!==i.getID()&&(m.current.has(r)||(h(r),t(r,e.posFromIndex(0))))}))}));var r=c.getRootObject();r.content.onChanges((function(r){var a,o=Object(B.a)(r);try{for(o.s();!(a=o.n()).done;){var c=a.value,s=c.actor,l=c.from,u=c.to;if("content"===c.type){var d=c.content||"";if(s!==i.getID()){var p=e.posFromIndex(l),f=e.posFromIndex(u);e.replaceRange(d,p,f,"yorkie")}}else if("selection"===c.type&&s!==i.getID()){m.current.has(s)||h(s);var v=e.posFromIndex(l),O=e.posFromIndex(u);if(t(s,O),l>u){var b=[v,O];O=b[0],v=b[1]}n(s,v,O)}}}catch(g){o.e(g)}finally{o.f()}})),e.setSize("auto","calc(100vh - 64px)"),e.setValue(r.content.getValue())},onSelection:function(e,t){if(void 0!==t.origin){var n=e.indexFromPos(t.ranges[0].anchor),r=e.indexFromPos(t.ranges[0].head);null===c||void 0===c||c.update((function(e){e.content.updateSelection(n,r)}))}},onBeforeChange:function(e,t){if("yorkie"!==t.origin&&"setValue"!==t.origin){var n=e.indexFromPos(t.from),r=e.indexFromPos(t.to),a=t.text.join("\n");null===c||void 0===c||c.update((function(e){e.content.edit(n,r,a)}))}}})}var te=Object(R.a)((function(e){return Object(N.a)({root:{flexGrow:1}})}));function ne(e){var t=te(),n=e.match.params.docKey;return o.a.createElement("div",{className:t.root},o.a.createElement(K,null),o.a.createElement(ee,{docKey:n}))}var re=n(75),ae=Object(re.a)({palette:{type:"dark"}}),oe=(n(117),Object(h.d)(D,void 0,Object(h.a)(p.a)));var ce=function(){return o.a.createElement(u.a,{store:oe},o.a.createElement(m.a,{theme:ae},o.a.createElement(d.a,null),o.a.createElement(s.a,null,o.a.createElement(l.b,{path:"/",exact:!0,render:function(){return o.a.createElement(l.a,{to:"/".concat(Math.random().toString(36).substring(7))})}}),o.a.createElement(l.b,{path:"/:docKey",exact:!0,component:ne}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(ce,null),document.querySelector("#root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},84:function(e,t,n){e.exports=n(119)}},[[84,1,2]]]);
//# sourceMappingURL=main.65560feb.chunk.js.map