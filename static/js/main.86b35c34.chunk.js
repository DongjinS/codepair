(this["webpackJsonpyorkie-codepair"]=this["webpackJsonpyorkie-codepair"]||[]).push([[0],{166:function(e,t,n){},167:function(e,t,n){},168:function(e,t,n){},170:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(9),o=n.n(r),c=n(8),s=n(13),u=n(102),l=n(215),d=n(217),m=n(103),h=n(216),f=n(205),v=n(225),p=n(209),b=n(210),g=n(207),y=n(17),O=n(176),j=n(208),E=n(223),k=n(54),x=n.n(k),C=n(220);function S(e){var t=e.anchorEl,n=e.onClose,a=e.children,r=Boolean(t);return i.a.createElement(C.a,{id:r?"simple-popover":void 0,open:r,anchorEl:t,onClose:n,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},a)}var w=n(206),T=n(174),N=Object(f.a)((function(){return{root:function(e){return{color:e.peer.metadata.color}}}}));function M(e){var t=N(e),n=e.peer;return i.a.createElement(T.a,{className:t.root},n.metadata.username)}var D,R=n(20);!function(e){e.Connected="connected",e.Disconnected="disconnected"}(D||(D={}));var L=Object(R.c)({name:"peer",initialState:{peers:{}},reducers:{syncPeer:function(e,t){for(var n=t.payload,a=e.peers,i=0,r=Object.keys(a);i<r.length;i++){var o=r[i];n[o]||(a[o].status=D.Disconnected)}for(var c=0,s=Object.entries(n);c<s.length;c++){var u=Object(y.a)(s[c],2),l=u[0],d=u[1];if(!a[l]||a[l].status===D.Disconnected){var m={id:l,status:D.Connected,metadata:d};e.peers[l]=m}}}}}),I=L.actions.syncPeer,z=L.reducer;function A(){var e=Object(c.c)((function(e){return e.docState.client})),t=Object(c.c)((function(e){return e.peerState.peers}));return{activePeers:Object(a.useMemo)((function(){return e?Object.entries(t).filter((function(t){var n=Object(y.a)(t,2),a=n[0],i=n[1];return e.getID()!==a&&i.status===D.Connected})).map((function(e){var t=Object(y.a)(e,2);t[0];return t[1]})):[]}),[e,t])}}function P(){var e=A().activePeers;return i.a.createElement(w.a,null,i.a.createElement(T.a,null,i.a.createElement(g.a,null,"Total ",e.length)),e.map((function(e){return i.a.createElement(M,{key:e.id,peer:e})})))}var B=Object(f.a)((function(){return{group:{"& > *":{cursor:"pointer"}}}}));function W(){var e=B(),t=Object(c.c)((function(e){return e.docState.client})),n=A().activePeers,r=Object(a.useState)(),o=Object(y.a)(r,2),s=o[0],u=o[1],l=Object(a.useCallback)((function(e){e.target.getAttribute("data-id")||u(e.currentTarget)}),[u]),d=Object(a.useCallback)((function(){u(void 0)}),[u]);return t?i.a.createElement(i.a.Fragment,null,i.a.createElement(j.a,{className:e.group,max:4,onClick:l},n.map((function(e){var t=e.metadata,n=t.username,a=t.color,r=t.image;return i.a.createElement(E.a,{key:e.id,title:n,"data-id":e.id,arrow:!0},i.a.createElement(O.a,{alt:"Peer Image",style:{backgroundColor:a},src:x.a.getImage(r)}))}))),i.a.createElement(S,{anchorEl:s,onClose:d},i.a.createElement(P,null))):null}var K=Object(f.a)((function(e){return Object(v.a)({root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}})}));function V(){var e=K();return i.a.createElement("div",{className:e.root},i.a.createElement(p.a,{position:"static"},i.a.createElement(b.a,null,i.a.createElement(g.a,{variant:"h6",className:e.title},"Yorkie CodePair"),i.a.createElement(W,null))))}var Y,F,X,H=Object(a.memo)(V),G=n(218),J=n(212),U=n(211),$=n(213),q=n(97),Q=n.n(q),Z=n(96),_=n.n(Z),ee=n(219),te=n(36),ne=n(37),ae=function(){function e(t){Object(te.a)(this,e),this.key=void 0,this.storage=void 0,this.key=t,this.storage=window.localStorage}return Object(ne.a)(e,[{key:"getValue",value:function(e){try{return JSON.parse(this.storage[this.key])}catch(t){return e}}},{key:"setValue",value:function(e){this.storage[this.key]=JSON.stringify(e)}}]),e}();!function(e){e.Material="material",e.Monokai="monokai"}(Y||(Y={})),function(e){e.Sublime="sublime",e.Vim="vim",e.Emacs="emacs"}(F||(F={})),function(e){e.Two="2",e.Four="4",e.Eight="8"}(X||(X={}));var ie,re=new ae("$$codepair$$setting"),oe=re.getValue({menu:{codeTheme:Y.Monokai,codeKeyMap:F.Sublime,tabSize:X.Two}}),ce=Object(R.c)({name:"setting",initialState:oe,reducers:{setCodeTheme:function(e,t){e.menu.codeTheme=t.payload,re.setValue(e)},setCodeKeyMap:function(e,t){e.menu.codeKeyMap=t.payload,re.setValue(e)},setTabSize:function(e,t){e.menu.tabSize=t.payload,re.setValue(e)}}}),se=ce.actions,ue=se.setCodeTheme,le=se.setCodeKeyMap,de=se.setTabSize,me=ce.reducer,he=Object(f.a)((function(e){return Object(v.a)({root:{width:"400px",minWidth:"320px",borderRadius:"4px"},header:{borderBottom:"1px solid ".concat(e.palette.text.disabled)},title:{padding:"12px 16px"},list:{padding:"12px 24px",lineHeight:"19px"},item:{display:"flex",justifyContent:"space-between",fontSize:"15px",marginTop:"12px"},itemTitle:{whiteSpace:"nowrap",display:"flex",alignItems:"center"},itemInfo:{minWidth:140,paddingLeft:"12px",border:"1px solid #aaa",borderRadius:"4px",textAlign:"left"}})})),fe=function(){var e=Object(c.b)(),t=he(),n=Object(c.c)((function(e){return e.settingState.menu}));function a(t){return function(n){e(t(n.target.value))}}return i.a.createElement("div",{className:t.root},i.a.createElement(ee.a,null,i.a.createElement("header",{className:t.header},i.a.createElement(g.a,{className:t.title,variant:"h6"},"Settings"))),i.a.createElement("div",{className:t.list},i.a.createElement("div",{className:t.item},i.a.createElement("div",{className:t.itemTitle},"Theme"),i.a.createElement(U.a,{className:t.itemInfo},i.a.createElement(G.a,{value:n.codeTheme,onChange:a(ue),disableUnderline:!0,displayEmpty:!0},Object.entries(Y).map((function(e){var t=Object(y.a)(e,2),n=t[0],a=t[1];return i.a.createElement(J.a,{value:a,key:a},n)}))))),i.a.createElement("div",{className:t.item},i.a.createElement("div",{className:t.itemTitle},"Key binding"),i.a.createElement(U.a,{className:t.itemInfo},i.a.createElement(G.a,{value:n.codeKeyMap,onChange:a(le),disableUnderline:!0,displayEmpty:!0},Object.entries(F).map((function(e){var t=Object(y.a)(e,2),n=t[0],a=t[1];return i.a.createElement(J.a,{value:a,key:a},n)}))))),i.a.createElement("div",{className:t.item},i.a.createElement("div",{className:t.itemTitle},"Tab Size"),i.a.createElement(U.a,{className:t.itemInfo},i.a.createElement(G.a,{value:n.tabSize,onChange:a(de),disableUnderline:!0,displayEmpty:!0},Object.entries(X).map((function(e){var t=Object(y.a)(e,2),n=t[0],a=t[1];return i.a.createElement(J.a,{value:a,key:n},"".concat(a," spaces"))})))))))},ve=n(30),pe=n.n(ve),be=n(50),ge=n(72),ye=n.n(ge),Oe=n(95),je=n.n(Oe);!function(e){e.PlainText="text/plain",e.Go="go",e.JavaScript="javascript",e.Clojure="clojure",e.Dart="dart",e.Python="python",e.Ruby="ruby",e.Rust="rust"}(ie||(ie={}));var Ee,ke={client:void 0,doc:void 0,mode:ie.PlainText,loading:!0,errorMessage:""},xe=Object(R.b)("doc/activate",function(){var e=Object(be.a)(pe.a.mark((function e(t,n){var a,i,r,o;return pe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=x.a.generate(),i=a.name,r=a.animal,o=ye.a.createClient("".concat("/api"),{metadata:{username:i,image:r,color:je()()}}),e.next=5,o.activate();case 5:return e.abrupt("return",{client:o});case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.rejectWithValue(e.t0.message));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}()),Ce=Object(R.b)("doc/attach",function(){var e=Object(be.a)(pe.a.mark((function e(t,n){var a,i;return pe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.client,i=t.doc,e.prev=1,e.next=4,a.attach(i);case 4:return i.update((function(e){e.content||e.createText("content"),e.shapes||(e.shapes=[])})),e.next=7,a.sync();case 7:return e.abrupt("return",{doc:i,client:a});case 10:return e.prev=10,e.t0=e.catch(1),e.abrupt("return",n.rejectWithValue(e.t0.message));case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t,n){return e.apply(this,arguments)}}()),Se=Object(R.c)({name:"doc",initialState:ke,reducers:{deactivateClient:function(e){var t=e.client;e.client=void 0,null===t||void 0===t||t.deactivate()},createDocument:function(e,t){e.doc=ye.a.createDocument("codepairs",t.payload)},detachDocument:function(e){var t=e.doc,n=e.client;e.doc=void 0,null===n||void 0===n||n.detach(t)},attachDocLoading:function(e,t){e.loading=t.payload},setCodeMode:function(e,t){e.mode=t.payload}},extraReducers:function(e){e.addCase(xe.fulfilled,(function(e,t){var n=t.payload;e.client=n.client})),e.addCase(xe.rejected,(function(e,t){var n=t.payload;e.errorMessage=n})),e.addCase(Ce.fulfilled,(function(e,t){var n=t.payload;e.doc=n.doc,e.client=n.client})),e.addCase(Ce.rejected,(function(e,t){var n=t.payload;e.errorMessage=n}))}}),we=Se.actions,Te=we.deactivateClient,Ne=we.createDocument,Me=we.detachDocument,De=we.attachDocLoading,Re=we.setCodeMode,Le=Se.reducer;!function(e){e[e.Line=0]="Line"}(Ee||(Ee={}));var Ie={isOpen:!1,tool:Ee.Line},ze=Object(R.c)({name:"board",initialState:Ie,reducers:{toggleBoard:function(e){e.isOpen=!e.isOpen},setTool:function(e,t){e.tool=t.payload}}}),Ae=ze.actions,Pe=Ae.toggleBoard,Be=Ae.setTool,We=ze.reducer,Ke=Object(f.a)((function(e){return Object(v.a)({root:{padding:"6px",position:"relative"},formControl:{minWidth:140,border:"1px solid ".concat(e.palette.grey[800]),borderRadius:"4px"},selectEmpty:{paddingLeft:"12px"},rightButtonControl:{float:"right"},rightButton:{padding:"7px"}})}));function Ve(){var e=Ke(),t=Object(c.b)(),n=Object(c.c)((function(e){return e.docState.doc})),r=Object(c.c)((function(e){return e.docState.mode})),o=Object(a.useState)(),s=Object(y.a)(o,2),u=s[0],l=s[1];Object(a.useEffect)((function(){if(!n)return function(){};var e=n.subscribe((function(e){"remote-change"===e.name&&t(Re(n.getRootObject().mode||ie.PlainText))}));return function(){e()}}),[n]);var d=Object(a.useCallback)((function(e){if(n){var a=e.target.value;n.update((function(e){e.mode=a})),t(Re(a))}}),[n,t]),m=Object(a.useCallback)((function(e){l(e.currentTarget)}),[]),h=Object(a.useCallback)((function(){l(void 0)}),[]),f=Object(a.useCallback)((function(){t(Pe())}),[]);return i.a.createElement("div",{className:e.root},i.a.createElement(U.a,{className:e.formControl},i.a.createElement(E.a,{title:"Syntax",arrow:!0},i.a.createElement(G.a,{name:"codeMode",value:r,onChange:d,className:e.selectEmpty,disableUnderline:!0,displayEmpty:!0},Object.entries(ie).map((function(e){var t=Object(y.a)(e,2),n=t[0],a=t[1];return i.a.createElement(J.a,{value:a,key:a},n)}))))),i.a.createElement("div",{className:e.rightButtonControl},i.a.createElement(E.a,{className:e.rightButton,title:"Board",arrow:!0},i.a.createElement($.a,{"aria-label":"board",onClick:f},i.a.createElement(_.a,{fontSize:"small"}))),i.a.createElement(E.a,{className:e.rightButton,title:"Settings",arrow:!0},i.a.createElement($.a,{"aria-label":"settings",onClick:m},i.a.createElement(Q.a,{fontSize:"small"})))),i.a.createElement(S,{anchorEl:u,onClose:h},i.a.createElement(fe,null)))}var Ye,Fe=n(224),Xe=n(221),He=n(214),Ge=n(98),Je=n(99),Ue=n.n(Je);!function(e){e.Deactivated="deactivated",e.Activated="activated"}(Ye||(Ye={}));var $e=function(){function e(t,n){Object(te.a)(this,e),this.id=void 0,this.username=void 0,this.color=void 0,this.height=void 0,this.marker=void 0,this.lineMarker=void 0,this.status=void 0,this.nameRemoveTimeMap=void 0,this.nameAnimationDelay=void 0,this.nameAnimationDuration=void 0,this.nameRemoveTime=void 0,this.id=t,this.username=n.username,this.color=n.color,this.height=0,this.status=Ye.Deactivated,this.nameRemoveTimeMap=new Map,this.nameAnimationDelay=1,this.nameAnimationDuration=.2,this.nameRemoveTime=1e3*(this.nameAnimationDuration+this.nameAnimationDelay)}return Object(ne.a)(e,[{key:"updateCursor",value:function(e,t){this.removeCursor(),this.status=Ye.Activated;var n=e.cursorCoords(t),a=document.createElement("span");this.height=n.bottom-n.top,a.classList.add("codePair-cursor"),a.style.borderLeftColor=this.color,a.style.height="".concat(this.height,"px"),this.marker=e.setBookmark(t,{widget:a,insertLeft:!0}),this.showCursorNameReserve(a)}},{key:"updateLine",value:function(e,t,n){this.removeLine(),this.status=Ye.Activated,this.lineMarker=e.getDoc().markText(t,n,{css:"background-color : ".concat(this.color,"; opacity:0.7")})}},{key:"showCursorNameReserve",value:function(e){var t=this,n=document.createElement("span");n.classList.add("codePair-name"),e.addEventListener("mouseenter",(function(){t.nameRemoveTimeMap.has(t.id)&&clearTimeout(t.nameRemoveTimeMap.get(t.id)),n.textContent=t.username,n.style.top="-".concat(t.height,"px"),n.style.backgroundColor=t.color,n.style.color=Ue()(t.color,!0),n.classList.remove("text-remove"),e.appendChild(n)})),e.addEventListener("mouseleave",(function(){n.classList.add("text-remove"),n.style.animationDuration="".concat(t.nameAnimationDuration,"s"),n.style.animationDelay="".concat(t.nameAnimationDelay,"s"),t.removeNameReserve(n)}))}},{key:"removeNameReserve",value:function(e){var t=this,n=setTimeout((function(){e.parentNode.removeChild(e),t.nameRemoveTimeMap.delete(t.id)}),this.nameRemoveTime);this.nameRemoveTimeMap.set(this.id,n)}},{key:"removeCursor",value:function(){this.marker&&(this.marker.clear(),this.marker=void 0)}},{key:"removeLine",value:function(){this.lineMarker&&(this.lineMarker.clear(),this.lineMarker=void 0)}},{key:"clear",value:function(){this.removeCursor(),this.removeLine()}},{key:"isActive",value:function(){return this.status===Ye.Activated}}]),e}();n(147),n(148),n(150),n(151),n(153),n(154),n(156),n(157),n(158),n(159),n(160),n(161),n(163),n(164),n(165),n(166);function qe(){var e=Object(c.c)((function(e){return e.docState.doc})),t=Object(c.c)((function(e){return e.docState.mode})),n=Object(c.c)((function(e){return e.docState.client})),r=Object(c.c)((function(e){return e.peerState.peers})),o=Object(c.c)((function(e){return e.settingState.menu})),s=Object(a.useRef)(new Map),u=Object(a.useCallback)((function(e,t){s.current.set(e,new $e(e,t))}),[r]),l=Object(a.useCallback)((function(e){s.current.has(e)&&(s.current.get(e).clear(),s.current.delete(e))}),[]);return Object(a.useEffect)((function(){for(var e=0,t=Object.entries(r);e<t.length;e++){var n=Object(y.a)(t[e],2),a=n[0],i=n[1];s.current.has(a)&&i.status===D.Disconnected?l(a):s.current.has(a)||i.status!==D.Connected||u(a,i.metadata)}}),[r]),n&&e?i.a.createElement(Ge.UnControlled,{className:"CodeMirror",options:{mode:t,theme:o.codeTheme,keyMap:o.codeKeyMap,tabSize:Number(o.tabSize),lineNumbers:!0,lineWrapping:!0,autoCloseTags:!0,autoCloseBrackets:!0},editorDidMount:function(t){t.focus();var a=function(e,n){var a=s.current.get(e);null===a||void 0===a||a.updateCursor(t,n)};e.subscribe((function(e){"remote-change"===e.name&&e.value.forEach((function(e){var i=e.getID().actor;if(i!==n.getID()){if(!s.current.has(i))return;if(s.current.get(i).isActive())return;a(i,t.posFromIndex(0))}}))}));var i=e.getRootObject();i.content.onChanges((function(e){e.forEach((function(e){var i=e.actor,r=e.from,o=e.to;if("content"===e.type){var c=e.content||"";if(i!==n.getID()){var u=t.posFromIndex(r),l=t.posFromIndex(o);t.replaceRange(c,u,l,"yorkie")}}else if("selection"===e.type&&i!==n.getID()){var d=t.posFromIndex(r),m=t.posFromIndex(o);if(a(i,m),r>o){var h=[d,m];m=h[0],d=h[1]}!function(e,n,a){var i=s.current.get(e);null===i||void 0===i||i.updateLine(t,n,a)}(i,d,m)}}))})),t.setValue(i.content.getValue())},onSelection:function(t,n){if(void 0!==n.origin){var a=t.indexFromPos(n.ranges[0].anchor),i=t.indexFromPos(n.ranges[0].head);e.update((function(e){e.content.updateSelection(a,i)}))}},onBeforeChange:function(t,n){if("yorkie"!==n.origin&&"setValue"!==n.origin){var a=t.indexFromPos(n.from),i=t.indexFromPos(n.to),r=n.text.join("\n");e.update((function(e){e.content.edit(a,i,r)}))}}}):null}var Qe=n(51),Ze=n.n(Qe),_e=n(101),et=n.n(_e),tt=n(100),nt=n.n(tt),at=Object(f.a)((function(){return Object(v.a)({root:{display:"flex",flexDirection:"column"},select:{color:nt.a[300]}})}));function it(){var e,t=at(),n=Object(c.b)(),a=Object(c.c)((function(e){return e.boardState.tool}));return i.a.createElement("div",{className:t.root},i.a.createElement($.a,{"aria-label":"edit",className:a===Ee.Line?t.select:"",onClick:(e=Ee.Line,function(){n(Be(e))})},i.a.createElement(et.a,{fontSize:"small"})))}var rt,ot=n(66),ct=function(){function e(t){Object(te.a)(this,e),this.canvas=void 0,this.context=void 0,this.width=0,this.height=0,this.canvas=t,this.context=t.getContext("2d"),this.resize()}return Object(ne.a)(e,[{key:"getCanvas",value:function(){return this.canvas}},{key:"getContext",value:function(){return this.context}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"setWidth",value:function(e){this.canvas.width=e,this.width=e,this.canvas.style.width="".concat(e,"px")}},{key:"setHeight",value:function(e){this.canvas.height=e,this.height=e,this.canvas.style.height="".concat(e,"px")}},{key:"setSize",value:function(e,t){this.setWidth(e),this.setHeight(t)}},{key:"clear",value:function(){this.getContext().clearRect(0,0,this.getWidth(),this.getHeight())}},{key:"resize",value:function(){this.setSize(this.canvas.width,this.canvas.height)}}]),e}();function st(e,t){e.beginPath();var n,a=!1,i=Object(ot.a)(t.points);try{for(i.s();!(n=i.n()).done;){var r=n.value;!1===a?(a=!0,e.moveTo(r.x,r.y)):e.lineTo(r.x,r.y)}}catch(o){i.e(o)}finally{i.f()}e.stroke()}!function(e){e[e.Drag=0]="Drag",e[e.Stop=1]="Stop"}(rt||(rt={}));var ut=rt.Stop,lt=function(){function e(t,n,a){Object(te.a)(this,e),this.pointY=void 0,this.pointX=void 0,this.offsetY=void 0,this.offsetX=void 0,this.scene=void 0,this.tool=void 0,this.createId=void 0,this.update=void 0,this.options=void 0,this.pointY=0,this.pointX=0,this.tool=Ee.Line,this.update=n,this.options=a,this.scene=new ct(t);var i=this.scene.getCanvas().getBoundingClientRect(),r=i.y,o=i.x;this.offsetY=r,this.offsetX=o,this.init()}return Object(ne.a)(e,[{key:"init",value:function(){this.scene.getContext().strokeStyle=this.options.color,this.scene.getCanvas().onmouseup=this.onmouseup.bind(this),this.scene.getCanvas().onmousedown=this.onmousedown.bind(this),this.scene.getCanvas().onmousemove=this.onmousemove.bind(this)}},{key:"setTool",value:function(e){this.setMouseClass(this.tool),this.tool=e}},{key:"setMouseClass",value:function(e){this.scene.getCanvas().className="",e===Ee.Line&&this.scene.getCanvas().classList.add("crosshair")}},{key:"getMouse",value:function(e){this.pointY=e.pageY-this.offsetY,this.pointX=e.pageX-this.offsetX}},{key:"onmousedown",value:function(e){var t=this;this.getMouse(e),this.isOutSide()||(ut=rt.Drag,this.update((function(e){if(t.tool===Ee.Line){var n=(i=t.pointY,{type:"line",points:[{x:t.pointX,y:i}]});e.shapes.push(n);var a=e.shapes.getLast();t.createId=a.getID()}var i})))}},{key:"onmousemove",value:function(e){var t=this;this.getMouse(e),this.isOutSide()||ut!==rt.Stop&&this.update((function(e){t.tool===Ee.Line&&(e.shapes.getElementByID(t.createId).points.push({x:t.pointX,y:t.pointY}),t.drawAll(e.shapes))}))}},{key:"onmouseup",value:function(){ut=rt.Stop,this.createId=void 0}},{key:"isOutSide",value:function(){return(this.pointY<0||this.pointX<0||this.pointY>this.scene.getHeight()||this.pointX>this.scene.getWidth())&&(this.onmouseup(),!0)}},{key:"drawAll",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scene;t.clear();var n,a=Object(ot.a)(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;this.draw(i,t)}}catch(r){a.e(r)}finally{a.f()}}},{key:"draw",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scene;"line"===e.type&&st(t.getContext(),e)}},{key:"clear",value:function(){this.scene.clear()}}]),e}(),dt=Object(f.a)((function(){return Object(v.a)({root:{width:"100%",height:"100%"}})}));function mt(){var e=dt(),t=Object(a.useRef)(null),n=Object(a.useRef)(null),r=Object(a.useRef)(null),o=Object(c.c)((function(e){return e.docState.doc})),s=Object(c.c)((function(e){return e.boardState.tool}));return Object(a.useEffect)((function(){var e=function(){var e;if(t.current&&n.current&&o){var a=null===(e=t.current)||void 0===e?void 0:e.getBoundingClientRect(),i=a.width,c=a.height;n.current.width=i,n.current.height=c;var s={color:Ze.a[50]};r.current=new lt(n.current,o.update.bind(o),s),r.current.drawAll(o.getRootObject().shapes)}};return e(),window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[o]),Object(a.useEffect)((function(){if(!o)return function(){};var e=o.subscribe((function(e){var t;"remote-change"===e.name&&(null===(t=r.current)||void 0===t||t.drawAll(o.getRootObject().shapes))}));return function(){e()}}),[o]),Object(a.useEffect)((function(){var e;null===(e=r.current)||void 0===e||e.setTool(s)}),[o,s]),i.a.createElement("div",{className:e.root,ref:t},i.a.createElement("canvas",{ref:n}))}n(167);var ht="40px",ft=Object(f.a)((function(){return Object(v.a)({root:{display:"flex",height:"100%"},sidebar:{width:ht,border:"1px solid ".concat(Ze.a[700])},content:{borderTop:"1px solid ".concat(Ze.a[700]),width:"calc( 100% - ".concat(ht," )")}})}));function vt(){var e=ft();return i.a.createElement("div",{className:e.root},i.a.createElement("div",{className:e.sidebar},i.a.createElement(it,null)),i.a.createElement("div",{className:e.content},i.a.createElement(mt,null)))}var pt=Object(f.a)((function(){return Object(v.a)({root:{flexGrow:1,display:"flex",height:"calc(100vh - ".concat(110,"px)")},loading:{display:"flex",height:"calc(100vh - ".concat(110,"px)"),alignItems:"center",justifyContent:"center"}})}));function bt(e){var t=e.docKey,n=pt(),r=Object(c.b)(),o=Object(c.c)((function(e){return e.docState.client})),s=Object(c.c)((function(e){return e.docState.doc})),u=Object(c.c)((function(e){return e.docState.loading})),l=Object(c.c)((function(e){return e.docState.errorMessage})),d=Object(c.c)((function(e){return e.boardState.isOpen})),m=d?"650px":"0px",h="calc( 100% - ".concat(m," )");return Object(a.useEffect)((function(){return r(xe()),function(){r(Te())}}),[]),Object(a.useEffect)((function(){if(!o||!s)return function(){};var e=o.subscribe((function(e){if("peers-changed"===e.name){var t=s.getKey().toIDString(),n=e.value[t];r(I(n))}}));return function(){e()}}),[o,s]),Object(a.useEffect)((function(){return r(Ne(t)),function(){r(Me())}}),[t]),Object(a.useEffect)((function(){function e(){return(e=Object(be.a)(pe.a.mark((function e(){return pe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o&&s){e.next=2;break}return e.abrupt("return");case 2:return r(De(!0)),e.next=5,r(Ce({client:o,doc:s}));case 5:r(Re(s.getRootObject().mode||ie.PlainText)),r(De(!1));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return function(){e.apply(this,arguments)}(),function(){r(De(!0))}}),[t,o,s]),l?i.a.createElement("div",null,i.a.createElement(Fe.a,{open:!0,anchorOrigin:{vertical:"top",horizontal:"center"}},i.a.createElement(Xe.a,{severity:"warning"},l||"fail to attach document"))):u?i.a.createElement(ee.a,{className:n.loading},i.a.createElement(He.a,{color:"inherit"})):i.a.createElement("div",{className:n.root},i.a.createElement("div",{style:{width:h}},i.a.createElement(qe,null)),d&&i.a.createElement("div",{style:{width:m}},i.a.createElement(vt,null)))}var gt=Object(f.a)((function(){return Object(v.a)({root:{flexGrow:1}})}));function yt(e){var t=gt(),n=e.match.params.docKey;return i.a.createElement("div",{className:t.root},i.a.createElement(H,null),i.a.createElement(Ve,null),i.a.createElement(bt,{docKey:n}))}n(168);var Ot=function(){var e=Object(l.a)("(prefers-color-scheme: dark)"),t=Object(a.useMemo)((function(){return Object(m.a)({palette:{type:e?"dark":"light"}})}),[e]),n=Object(a.useCallback)((function(){return i.a.createElement(s.a,{to:"/".concat(Math.random().toString(36).substring(7))})}),[]);return i.a.createElement(h.a,{theme:t},i.a.createElement(d.a,null),i.a.createElement(u.a,null,i.a.createElement(s.b,{path:"/",exact:!0,render:n}),i.a.createElement(s.b,{path:"/:docKey",exact:!0,component:yt})))},jt=n(19),Et=Object(jt.c)({docState:Le,peerState:z,settingState:me,boardState:We}),kt=Object(R.a)({reducer:Et,middleware:Object(R.d)({serializableCheck:{ignoredActions:["doc/attach/fulfilled","doc/activate/fulfilled"],ignoredPaths:["docState.client","docState.doc"]},immutableCheck:{ignoredPaths:["docState.client","docState.doc"]}})});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(c.a,{store:kt},i.a.createElement(Ot,null)),document.querySelector("#root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[170,1,2]]]);
//# sourceMappingURL=main.86b35c34.chunk.js.map