{"version":3,"sources":["components/Popover/index.tsx","components/NavBar/PeerListItem.tsx","features/peerSlices.ts","hooks/usePeer.ts","components/NavBar/PeerList.tsx","components/NavBar/PeerGroup.tsx","components/NavBar/index.tsx","features/settingSlices.ts","utils/storage.ts","features/docSlices.ts","components/Toolbar/Settings.tsx","features/boardSlices.ts","components/Toolbar/index.tsx","components/Editor/CodeEditor/Cursor.ts","components/Editor/CodeEditor/index.tsx","assets/icons/Eraser.tsx","components/Editor/Board/Sidebar.tsx","components/Editor/Board/Canvas/Canvas.ts","components/Editor/Board/Canvas/line.ts","components/Editor/Board/Canvas/utils.ts","components/Editor/Board/Canvas/schedule.ts","components/Editor/Board/Canvas/Container.ts","components/Editor/Board/Canvas/worker.ts","components/Editor/Board/Content.tsx","components/Editor/Board/index.tsx","components/Editor/index.tsx","pages/DocPage.tsx","app/App.tsx","app/rootReducer.ts","app/store.ts","serviceWorker.ts","index.tsx"],"names":["Popover","anchorEl","onClose","children","isOpen","Boolean","id","undefined","open","anchorOrigin","vertical","horizontal","transformOrigin","useStyles","makeStyles","root","props","color","peer","metadata","PeerListItem","classes","ListItem","className","username","ConnectionStatus","peerSlice","createSlice","name","initialState","peers","reducers","syncPeer","state","action","changedPeers","payload","Object","keys","clientID","status","Disconnected","entries","Connected","actions","usePeer","client","useSelector","docState","peerState","activePeers","useMemo","filter","peerID","getID","map","PeerList","List","Typography","length","key","group","cursor","PeerGroup","useState","setAnchorEl","handleViewList","useCallback","event","target","getAttribute","currentTarget","handleViewListClose","AvatarGroup","max","onClick","image","Tooltip","title","data-id","arrow","Avatar","alt","style","backgroundColor","src","anonymous","getImage","theme","createStyles","flexGrow","appBar","menuButton","marginRight","spacing","fontWeight","palette","primary","main","MenuAppBar","AppBar","position","Toolbar","variant","memo","CodeTheme","CodeKeyMap","TabSize","BrowserStorage","storage","this","window","localStorage","initial","JSON","parse","value","stringify","CodeMode","SettingModel","getValue","menu","codeTheme","Monokai","codeKeyMap","Sublime","tabSize","Two","settingSlice","setCodeTheme","setValue","setCodeKeyMap","setTabSize","width","minWidth","borderRadius","header","borderBottom","text","disabled","padding","list","lineHeight","item","display","justifyContent","fontSize","marginTop","itemTitle","whiteSpace","alignItems","itemInfo","paddingLeft","border","textAlign","Settings","dispatch","useDispatch","settingState","handleChange","Box","FormControl","Select","onChange","disableUnderline","displayEmpty","MenuItem","Tool","doc","mode","Markdown","loading","errorMessage","activateClient","createAsyncThunk","_","thunkApi","a","generate","animal","yorkie","createClient","process","randomColor","activate","rejectWithValue","message","attachDoc","attach","update","content","createText","shapes","sync","docSlice","deactivateClient","deactivate","createDocument","detachDocument","detach","attachDocLoading","setCodeMode","extraReducers","builder","addCase","fulfilled","rejected","initialBoardState","tool","Line","boardSlice","toggleBoard","setTool","formControl","grey","selectEmpty","rightButtonControl","float","rightButton","codeMode","useEffect","unsubscribe","subscribe","getRootObject","handleCodeModeChange","handleSettingsClick","handleSettingsClose","handleBoardClick","IconButton","aria-label","CursorStatus","Cursor","height","marker","lineMarker","nameRemoveTimeMap","nameAnimationDelay","nameAnimationDuration","nameRemoveTime","Deactivated","Map","cm","cursorPos","removeCursor","Activated","cursorCoords","cursorHolder","document","createElement","bottom","top","classList","add","borderLeftColor","setBookmark","widget","insertLeft","showCursorNameReserve","fromPos","toPos","removeLine","getDoc","markText","css","nameHolder","addEventListener","has","clearTimeout","get","textContent","invert","remove","appendChild","animationDuration","animationDelay","removeNameReserve","timeoutId","setTimeout","parentNode","removeChild","delete","set","clear","CodeEditor","cursorMapRef","useRef","connectCursor","current","disconnectCursor","options","keyMap","Number","lineNumbers","lineWrapping","autoCloseTags","autoCloseBrackets","editorDidMount","editor","focus","updateCursor","pos","forEach","change","actor","isActive","posFromIndex","onChanges","changes","from","to","type","replaceRange","updateLine","onSelection","data","origin","indexFromPos","ranges","anchor","head","updateSelection","onBeforeChange","join","edit","Eraser","SvgIcon","version","x","y","viewBox","d","flexDirection","select","Sidebar","boardState","handleSelectTool","nextTool","Canvas","canvas","context","getContext","resize","setWidth","setHeight","clearRect","getWidth","getHeight","setSize","drawLine","line","beginPath","isMoved","points","p","moveTo","lineTo","lineWidth","stroke","drawEraserLine","originColor","strokeStyle","startPoint","endPoint","fixEraserPoint","point","getSqDist","p1","p2","dx","dy","getSqSegDist","t","douglasPeuckerStep","first","last","tolerance","simplified","maxDist","index","i","dist","push","douglasPeucker","simplifyRadialDist","prevPoint","len","compressPoints","checkLineIntersection","point1Start","point1End","point2Start","point2End","b","result","onLine1","onLine2","denominator","numerator1","numerator2","intervalId","work","tasks","DragStatus","Worker","createId","shape","createLine","createEraserLine","lastShape","getLast","callback","setInterval","schedule","task","getElementByID","pointStart","pointEnd","findAndRemoveShape","point1","point2","deleteByID","clearInterval","Container","el","pointY","pointX","offsetY","offsetX","scene","dragStatus","worker","Stop","getCanvas","getBoundingClientRect","init","drawAll","bind","onmouseup","onmouseout","onmousedown","onmousemove","setMouseClass","evt","pageY","pageX","getMouse","isOutSide","Drag","isRecordWork","createShape","executeTask","reserveTask","flushTask","draw","eraserColor","Content","divRef","canvasRef","containerRef","onResize","deepOrange","removeEventListener","ref","SIDEBAR_WIDTH","sidebar","borderTop","Board","Editor","docKey","boardWidth","editorWidth","documentKey","getKey","toIDString","attachDocAsync","Snackbar","Alert","severity","CircularProgress","DocPage","match","params","NavBar","App","prefersDarkMode","useMediaQuery","createMuiTheme","secondary","handleRender","Math","random","toString","substring","ThemeProvider","CssBaseline","path","exact","render","component","rootReducer","combineReducers","docReducer","peerReducer","settingReducer","boardReducer","store","configureStore","reducer","middleware","getDefaultMiddleware","serializableCheck","ignoredActions","ignoredPaths","immutableCheck","location","hostname","ReactDOM","querySelector","navigator","serviceWorker","ready","then","registration","unregister","catch","error","console"],"mappings":"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","file":"static/js/main.93bab374.chunk.js","sourcesContent":["import React, { ReactNode } from 'react';\nimport { Popover as MaterialPopover } from '@material-ui/core';\n\ninterface PopoverProps {\n  anchorEl: Element | undefined;\n  onClose: (event: {}, reason: 'backdropClick' | 'escapeKeyDown') => void;\n  children: ReactNode;\n}\n\n/**\n * @see https://material-ui.com/components/popover/#popover\n */\nexport default function Popover({ anchorEl, onClose, children }: PopoverProps) {\n  const isOpen = Boolean(anchorEl);\n\n  return (\n    <MaterialPopover\n      id={isOpen ? 'simple-popover' : undefined}\n      open={isOpen}\n      anchorEl={anchorEl}\n      onClose={onClose}\n      anchorOrigin={{\n        vertical: 'bottom',\n        horizontal: 'center',\n      }}\n      transformOrigin={{\n        vertical: 'top',\n        horizontal: 'center',\n      }}\n    >\n      {children}\n    </MaterialPopover>\n  );\n}\n","import React from 'react';\nimport ListItem from '@material-ui/core/ListItem';\nimport { makeStyles } from '@material-ui/core/styles';\n\nimport { Peer } from 'features/peerSlices';\n\ninterface PeerListItemProps {\n  peer: Peer;\n}\n\nconst useStyles = makeStyles(() => ({\n  root: (props: PeerListItemProps) => ({\n    color: props.peer.metadata.color,\n  }),\n}));\n\nexport default function PeerListItem(props: PeerListItemProps) {\n  const classes = useStyles(props);\n  const { peer } = props;\n\n  return <ListItem className={classes.root}>{peer.metadata.username}</ListItem>;\n}\n","import { ActorID } from 'yorkie-js-sdk';\nimport { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\nexport interface Metadata {\n  username: string;\n  color: string;\n  image: string; // Currently all anonymous images\n}\n\nexport enum ConnectionStatus {\n  Connected = 'connected',\n  Disconnected = 'disconnected',\n}\n\nexport interface Peer {\n  id: ActorID;\n  status: ConnectionStatus;\n  metadata: Metadata;\n}\n\nexport interface PeerState {\n  peers: {\n    /** @type {Object.<ActorID, Peer>} */\n    [id: string]: Peer;\n  };\n}\n\nconst initialPeerState: PeerState = {\n  peers: {},\n};\n\nconst peerSlice = createSlice({\n  name: 'peer',\n  initialState: initialPeerState,\n  reducers: {\n    syncPeer(state, action: PayloadAction<any>) {\n      const changedPeers = action.payload;\n      const { peers } = state;\n\n      for (const clientID of Object.keys(peers)) {\n        if (!changedPeers[clientID]) {\n          peers[clientID].status = ConnectionStatus.Disconnected;\n        }\n      }\n\n      for (const [clientID, metadata] of Object.entries(changedPeers)) {\n        if (!peers[clientID] || peers[clientID].status === ConnectionStatus.Disconnected) {\n          const peer = {\n            id: clientID,\n            status: ConnectionStatus.Connected,\n            metadata: metadata as Metadata,\n          };\n          state.peers[clientID] = peer;\n        }\n      }\n    },\n  },\n});\n\nexport const { syncPeer } = peerSlice.actions;\nexport default peerSlice.reducer;\n","/* eslint-disable @typescript-eslint/indent */\n/* eslint-disable @typescript-eslint/no-unused-vars */\nimport { useMemo } from 'react';\nimport { useSelector } from 'react-redux';\n\nimport { AppState } from 'app/rootReducer';\nimport { ConnectionStatus } from 'features/peerSlices';\n\nexport default function usePeer() {\n  const client = useSelector((state: AppState) => state.docState.client);\n  const peers = useSelector((state: AppState) => state.peerState.peers);\n\n  const activePeers = useMemo(() => {\n    return client\n      ? Object.entries(peers)\n          .filter(([peerID, peer]) => {\n            if (client.getID() === peerID) {\n              return false;\n            }\n            return peer.status === ConnectionStatus.Connected;\n          })\n          .map(([_, clientInfo]) => clientInfo)\n      : [];\n  }, [client, peers]);\n\n  return { activePeers };\n}\n","import React from 'react';\nimport Typography from '@material-ui/core/Typography';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\n\nimport PeerListItem from 'components/NavBar/PeerListItem';\nimport usePeer from 'hooks/usePeer';\n\nexport default function PeerList() {\n  const { activePeers } = usePeer();\n\n  return (\n    <List>\n      <ListItem>\n        <Typography>Total {activePeers.length}</Typography>\n      </ListItem>\n      {activePeers.map((peer) => {\n        return <PeerListItem key={peer.id} peer={peer} />;\n      })}\n    </List>\n  );\n}\n","import React, { useState, useCallback, MouseEvent } from 'react';\nimport { useSelector } from 'react-redux';\nimport Avatar from '@material-ui/core/Avatar';\nimport AvatarGroup from '@material-ui/lab/AvatarGroup';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport { makeStyles } from '@material-ui/core/styles';\nimport anonymous from 'anonymous-animals-gen';\n\nimport Popover from 'components/Popover';\nimport PeerList from 'components/NavBar/PeerList';\nimport { AppState } from 'app/rootReducer';\nimport usePeer from 'hooks/usePeer';\n\nconst useStyles = makeStyles(() => ({\n  group: {\n    '& > *': {\n      cursor: 'pointer',\n    },\n  },\n}));\n\nconst MAX_PEER_VIEW = 4;\n\nexport default function PeerGroup() {\n  const classes = useStyles();\n  const client = useSelector((state: AppState) => state.docState.client);\n  const { activePeers } = usePeer();\n  const [anchorEl, setAnchorEl] = useState<Element | undefined>();\n\n  const handleViewList = useCallback(\n    (event: MouseEvent<Element>) => {\n      const target = event.target as HTMLTextAreaElement;\n      if (!target.getAttribute('data-id')) {\n        setAnchorEl(event.currentTarget);\n      }\n    },\n    [setAnchorEl],\n  );\n\n  const handleViewListClose = useCallback(() => {\n    setAnchorEl(undefined);\n  }, [setAnchorEl]);\n\n  if (!client) {\n    // NOTE: We use null as an exception to prevent component from rendering.\n    return null;\n  }\n\n  return (\n    <>\n      <AvatarGroup className={classes.group} max={MAX_PEER_VIEW} onClick={handleViewList}>\n        {activePeers.map((peer) => {\n          const { username, color, image } = peer.metadata;\n          return (\n            <Tooltip key={peer.id} title={username} data-id={peer.id} arrow>\n              <Avatar alt=\"Peer Image\" style={{ backgroundColor: color }} src={anonymous.getImage(image)} />\n            </Tooltip>\n          );\n        })}\n      </AvatarGroup>\n      <Popover anchorEl={anchorEl} onClose={handleViewListClose}>\n        <PeerList />\n      </Popover>\n    </>\n  );\n}\n","import React, { memo } from 'react';\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\nimport AppBar from '@material-ui/core/AppBar';\nimport Toolbar from '@material-ui/core/Toolbar';\nimport Typography from '@material-ui/core/Typography';\n\nimport PeerGroup from 'components/NavBar/PeerGroup';\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      flexGrow: 1,\n    },\n    appBar: {\n      backgroundColor: 'black',\n    },\n    menuButton: {\n      marginRight: theme.spacing(2),\n    },\n    title: {\n      flexGrow: 1,\n      fontWeight: 'bold',\n      color: theme.palette.primary.main,\n    },\n  }),\n);\n\nfunction MenuAppBar() {\n  const classes = useStyles();\n\n  return (\n    <div className={classes.root}>\n      <AppBar position=\"static\" className={classes.appBar}>\n        <Toolbar>\n          <Typography variant=\"h6\" className={classes.title}>\n            Yorkie CodePair\n          </Typography>\n          <PeerGroup />\n        </Toolbar>\n      </AppBar>\n    </div>\n  );\n}\n\nexport default memo(MenuAppBar);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport BrowserStorage from 'utils/storage';\n\nexport enum CodeTheme {\n  Material = 'material',\n  Monokai = 'monokai',\n}\n\nexport enum CodeKeyMap {\n  Sublime = 'sublime',\n  Vim = 'vim',\n  Emacs = 'emacs',\n}\n\nexport enum TabSize {\n  Two = '2',\n  Four = '4',\n  Eight = '8',\n}\n\nexport type MenuKey = 'codeTheme' | 'codeKeyMap' | 'tabSize';\n\nexport type Menu = {\n  [key in MenuKey]: string;\n};\n\nexport interface SettingState {\n  menu: Menu;\n}\n\nconst SettingModel = new BrowserStorage<SettingState>('$$codepair$$setting');\n\nconst initialState: SettingState = SettingModel.getValue({\n  menu: {\n    codeTheme: CodeTheme.Monokai,\n    codeKeyMap: CodeKeyMap.Sublime,\n    tabSize: TabSize.Two,\n  },\n});\n\nconst settingSlice = createSlice({\n  name: 'setting',\n  initialState,\n  reducers: {\n\n    setCodeTheme(state, action: PayloadAction<CodeTheme>) {\n      state.menu.codeTheme = action.payload;\n      SettingModel.setValue(state);\n    },\n\n    setCodeKeyMap(state, action: PayloadAction<CodeKeyMap>) {\n      state.menu.codeKeyMap = action.payload;\n      SettingModel.setValue(state);\n    },\n\n    setTabSize(state, action: PayloadAction<TabSize>) {\n      state.menu.tabSize = action.payload;\n      SettingModel.setValue(state);\n    },\n  },\n});\n\nexport const { setCodeTheme, setCodeKeyMap, setTabSize } = settingSlice.actions;\nexport default settingSlice.reducer;\n","export default class BrowserStorage<T> {\n  key: string;\n\n  storage: Storage;\n\n  constructor(key: string) {\n    this.key = key;\n    this.storage = window.localStorage;\n  }\n\n  getValue(initial: T): T {\n    try {\n      return JSON.parse(this.storage[this.key]) as T;\n    } catch {\n      return initial;\n    }\n  }\n\n  setValue(value: T) {\n    this.storage[this.key] = JSON.stringify(value);\n  }\n}\n","import { createSlice, PayloadAction, createAsyncThunk } from '@reduxjs/toolkit';\nimport yorkie, { Client, Document } from 'yorkie-js-sdk';\nimport anonymous from 'anonymous-animals-gen';\nimport randomColor from 'randomcolor';\n\nexport enum CodeMode {\n  Markdown = 'gfm',\n  Go = 'go',\n  JavaScript = 'javascript',\n  Clojure = 'clojure',\n  Dart = 'dart',\n  Python = 'python',\n  Ruby = 'ruby',\n  Rust = 'rust',\n}\n\nexport interface DocState {\n  client?: Client;\n  doc?: Document;\n  mode: CodeMode;\n  loading: boolean;\n  errorMessage: string;\n}\n\nconst initialState: DocState = {\n  client: undefined,\n  doc: undefined,\n  mode: CodeMode.Markdown,\n  loading: true,\n  errorMessage: '',\n};\n\nexport const activateClient = createAsyncThunk<ActivateClientResult, undefined, { rejectValue: string }>(\n  'doc/activate',\n  async (_: undefined, thunkApi) => {\n    try {\n      const { name, animal } = anonymous.generate();\n      const client = yorkie.createClient(`${process.env.REACT_APP_YORKIE_RPC_ADDR}`, {\n        metadata: {\n          username: name,\n          image: animal,\n          color: randomColor(),\n        },\n      });\n\n      await client.activate();\n      return { client };\n    } catch (err) {\n      return thunkApi.rejectWithValue(err.message);\n    }\n  },\n);\n\nexport const attachDoc = createAsyncThunk<AttachDocResult, AttachDocArgs, { rejectValue: string }>(\n  'doc/attach',\n  async ({ client, doc }, thunkApi) => {\n    try {\n      await client.attach(doc);\n\n      doc.update((root) => {\n        // codeEditor\n        if (!root.content) {\n          root.createText('content');\n        }\n        // board\n        if (!root.shapes) {\n          root.shapes = [];\n        }\n      });\n      await client.sync();\n      return { doc, client };\n    } catch (err) {\n      return thunkApi.rejectWithValue(err.message);\n    }\n  },\n);\n\nconst docSlice = createSlice({\n  name: 'doc',\n  initialState,\n  reducers: {\n    deactivateClient(state) {\n      const { client } = state;\n      state.client = undefined;\n      client?.deactivate();\n    },\n    createDocument(state, action: PayloadAction<string>) {\n      state.doc = yorkie.createDocument('codepairs', action.payload);\n    },\n    detachDocument(state) {\n      const { doc, client } = state;\n      state.doc = undefined;\n      client?.detach(doc as Document);\n    },\n    attachDocLoading(state, action: PayloadAction<boolean>) {\n      state.loading = action.payload;\n    },\n    setCodeMode(state, action: PayloadAction<CodeMode>) {\n      state.mode = action.payload;\n    },\n  },\n  extraReducers: (builder) => {\n    builder.addCase(activateClient.fulfilled, (state, { payload }) => {\n      state.client = payload.client;\n    });\n    builder.addCase(activateClient.rejected, (state, { payload }) => {\n      state.errorMessage = payload!;\n    });\n    builder.addCase(attachDoc.fulfilled, (state, { payload }) => {\n      state.doc = payload.doc;\n      state.client = payload.client;\n    });\n    builder.addCase(attachDoc.rejected, (state, { payload }) => {\n      state.errorMessage = payload!;\n    });\n  },\n});\n\nexport const { deactivateClient, createDocument, detachDocument, attachDocLoading, setCodeMode } = docSlice.actions;\nexport default docSlice.reducer;\n\ntype ActivateClientResult = { client: Client };\ntype AttachDocArgs = { doc: Document; client: Client };\ntype AttachDocResult = { doc: Document; client: Client };\n","import React from 'react';\nimport { ActionCreatorWithPayload } from '@reduxjs/toolkit';\nimport { useSelector, useDispatch } from 'react-redux';\nimport Box from '@material-ui/core/Box';\nimport Select from '@material-ui/core/Select';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport Typography from '@material-ui/core/Typography';\nimport FormControl from '@material-ui/core/FormControl';\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\n\nimport { CodeTheme, CodeKeyMap, TabSize, setCodeTheme, setCodeKeyMap, setTabSize } from 'features/settingSlices';\nimport { AppState } from 'app/rootReducer';\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      width: '400px',\n      minWidth: '320px',\n      borderRadius: '4px',\n    },\n    header: {\n      borderBottom: `1px solid ${theme.palette.text.disabled}`,\n    },\n    title: {\n      padding: '12px 16px',\n    },\n    list: {\n      padding: '12px 24px',\n      lineHeight: '19px',\n    },\n    item: {\n      display: 'flex',\n      justifyContent: 'space-between',\n      fontSize: '15px',\n      marginTop: '12px',\n    },\n    itemTitle: {\n      whiteSpace: 'nowrap',\n      display: 'flex',\n      alignItems: 'center',\n    },\n    itemInfo: {\n      minWidth: 140,\n      paddingLeft: '12px',\n      border: '1px solid #aaa',\n      borderRadius: '4px',\n      textAlign: 'left',\n    },\n  }),\n);\n\nconst Settings = () => {\n  const dispatch = useDispatch();\n  const classes = useStyles();\n  const menu = useSelector((state: AppState) => state.settingState.menu);\n\n  function handleChange<T>(action: ActionCreatorWithPayload<T>) {\n    return (event: React.ChangeEvent<{ name?: string; value: unknown }>) => {\n      dispatch(action(event.target.value as T));\n    };\n  }\n\n  return (\n    <div className={classes.root}>\n      <Box>\n        <header className={classes.header}>\n          <Typography className={classes.title} variant=\"h6\">Settings</Typography>\n        </header>\n      </Box>\n      <div className={classes.list}>\n        <div className={classes.item}>\n          <div className={classes.itemTitle}>Theme</div>\n          <FormControl className={classes.itemInfo}>\n            <Select value={menu.codeTheme} onChange={handleChange(setCodeTheme)} disableUnderline displayEmpty>\n              {Object.entries(CodeTheme).map(([display, theme]: [string, string]) => {\n                return (\n                  <MenuItem value={theme} key={theme}>\n                    {display}\n                  </MenuItem>\n                );\n              })}\n            </Select>\n          </FormControl>\n        </div>\n        <div className={classes.item}>\n          <div className={classes.itemTitle}>Key binding</div>\n          <FormControl className={classes.itemInfo}>\n            <Select value={menu.codeKeyMap} onChange={handleChange(setCodeKeyMap)} disableUnderline displayEmpty>\n              {Object.entries(CodeKeyMap).map(([display, codeKeyMap]: [string, string]) => {\n                return (\n                  <MenuItem value={codeKeyMap} key={codeKeyMap}>\n                    {display}\n                  </MenuItem>\n                );\n              })}\n            </Select>\n          </FormControl>\n        </div>\n        <div className={classes.item}>\n          <div className={classes.itemTitle}>Tab Size</div>\n          <FormControl className={classes.itemInfo}>\n            <Select value={menu.tabSize} onChange={handleChange(setTabSize)} disableUnderline displayEmpty>\n              {Object.entries(TabSize).map(([key, tabSize]: [string, string]) => {\n                return (\n                  <MenuItem value={tabSize} key={key}>\n                    {`${tabSize} spaces`}\n                  </MenuItem>\n                );\n              })}\n            </Select>\n          </FormControl>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Settings;\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\nexport enum Tool {\n  Line,\n  Eraser,\n}\n\nexport interface BoardState {\n  isOpen: boolean;\n\n  tool: Tool;\n}\n\nconst initialBoardState: BoardState = {\n  isOpen: false,\n\n  tool: Tool.Line,\n};\n\nconst boardSlice = createSlice({\n  name: 'board',\n  initialState: initialBoardState,\n\n  reducers: {\n    toggleBoard(state) {\n      state.isOpen = !state.isOpen;\n    },\n\n    setTool(state, action: PayloadAction<Tool>) {\n      state.tool = action.payload;\n    },\n  },\n});\n\nexport const { toggleBoard, setTool } = boardSlice.actions;\nexport default boardSlice.reducer;\n","import React, { useState, useEffect, useCallback, MouseEvent, ChangeEvent } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\n\nimport Select from '@material-ui/core/Select';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport FormControl from '@material-ui/core/FormControl';\nimport IconButton from '@material-ui/core/IconButton';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport SettingsIcon from '@material-ui/icons/Settings';\nimport ChromeReaderModeIcon from '@material-ui/icons/ChromeReaderMode';\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\n\nimport Popover from 'components/Popover';\nimport Settings from 'components/Toolbar/Settings';\n\nimport { AppState } from 'app/rootReducer';\nimport { CodeMode, setCodeMode } from 'features/docSlices';\nimport { toggleBoard } from 'features/boardSlices';\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      padding: '6px',\n      position: 'relative',\n    },\n    formControl: {\n      minWidth: 140,\n      border: `1px solid ${theme.palette.grey['800']}`,\n      borderRadius: '4px',\n    },\n    selectEmpty: {\n      paddingLeft: '12px',\n    },\n\n    rightButtonControl: {\n      float: 'right',\n    },\n    rightButton: {\n      padding: '7px',\n    },\n  }),\n);\n\nexport default function Toolbar() {\n  const classes = useStyles();\n  const dispatch = useDispatch();\n\n  const doc = useSelector((state: AppState) => state.docState.doc);\n  const codeMode = useSelector((state: AppState) => state.docState.mode);\n  const [anchorEl, setAnchorEl] = useState<HTMLButtonElement | undefined>();\n\n  useEffect(() => {\n    if (!doc) {\n      return () => {};\n    }\n\n    const unsubscribe = doc.subscribe((event) => {\n      if (event.name === 'remote-change') {\n        dispatch(setCodeMode(doc.getRootObject().mode || CodeMode.Markdown));\n      }\n    });\n\n    return () => {\n      unsubscribe();\n    };\n  }, [doc]);\n\n  const handleCodeModeChange = useCallback(\n    (event: ChangeEvent<{ name?: string; value: unknown }>) => {\n      if (!doc) {\n        return;\n      }\n      const mode = event.target.value as CodeMode;\n      doc.update((root) => {\n        // eslint-disable-next-line no-param-reassign\n        root.mode = mode;\n      });\n\n      dispatch(setCodeMode(mode));\n    },\n    [doc, dispatch],\n  );\n\n  const handleSettingsClick = useCallback((event: MouseEvent<HTMLButtonElement>) => {\n    setAnchorEl(event.currentTarget);\n  }, []);\n  const handleSettingsClose = useCallback(() => {\n    setAnchorEl(undefined);\n  }, []);\n\n  const handleBoardClick = useCallback(() => {\n    dispatch(toggleBoard());\n  }, []);\n\n  return (\n    <div className={classes.root}>\n      <FormControl className={classes.formControl}>\n        <Tooltip title=\"Syntax\" arrow>\n          <Select\n            name=\"codeMode\"\n            value={codeMode}\n            onChange={handleCodeModeChange}\n            className={classes.selectEmpty}\n            disableUnderline\n            displayEmpty\n          >\n            {Object.entries(CodeMode).map(([display, mode]: [string, string]) => {\n              return (\n                <MenuItem value={mode} key={mode}>\n                  {display}\n                </MenuItem>\n              );\n            })}\n          </Select>\n        </Tooltip>\n      </FormControl>\n\n      <div className={classes.rightButtonControl}>\n        <Tooltip className={classes.rightButton} title=\"Board\" arrow>\n          <IconButton aria-label=\"board\" onClick={handleBoardClick}>\n            <ChromeReaderModeIcon fontSize=\"small\" />\n          </IconButton>\n        </Tooltip>\n        <Tooltip className={classes.rightButton} title=\"Settings\" arrow>\n          <IconButton aria-label=\"settings\" onClick={handleSettingsClick}>\n            <SettingsIcon fontSize=\"small\" />\n          </IconButton>\n        </Tooltip>\n      </div>\n\n      <Popover anchorEl={anchorEl} onClose={handleSettingsClose}>\n        <Settings />\n      </Popover>\n    </div>\n  );\n}\n","import { ActorID } from 'yorkie-js-sdk';\nimport invert from 'invert-color';\nimport { Metadata } from 'features/peerSlices';\n\nenum CursorStatus {\n  Deactivated = 'deactivated',\n  Activated = 'activated',\n}\n\n// REF https://github.com/FujitsuLaboratories/cattaz/blob/master/src/AppEnabledWikiEditorCodeMirror.jsx#L24\nexport default class Cursor {\n  private id: ActorID;\n\n  private username: string;\n\n  private color: string;\n\n  private height: number;\n\n  private marker?: CodeMirror.TextMarker;\n\n  private lineMarker?: CodeMirror.TextMarker;\n\n  private status: CursorStatus;\n\n  private nameRemoveTimeMap: Map<ActorID, ReturnType<typeof setTimeout>>;\n\n  private nameAnimationDelay: number;\n\n  private nameAnimationDuration: number;\n\n  private nameRemoveTime: number;\n\n  constructor(id: ActorID, metadata: Metadata) {\n    this.id = id;\n    this.username = metadata.username;\n    this.color = metadata.color;\n    this.height = 0;\n    this.status = CursorStatus.Deactivated;\n\n    this.nameRemoveTimeMap = new Map();\n    this.nameAnimationDelay = 1;\n    this.nameAnimationDuration = 0.2;\n    this.nameRemoveTime = (this.nameAnimationDuration + this.nameAnimationDelay) * 1000;\n  }\n\n  updateCursor(cm: CodeMirror.Editor, cursorPos: CodeMirror.Position) {\n    this.removeCursor();\n    this.status = CursorStatus.Activated;\n    const cursorCoords = cm.cursorCoords(cursorPos);\n    const cursorHolder = document.createElement('span');\n    this.height = cursorCoords.bottom - cursorCoords.top;\n\n    cursorHolder.classList.add('codePair-cursor');\n    cursorHolder.style.borderLeftColor = this.color;\n    cursorHolder.style.height = `${this.height}px`;\n\n    this.marker = cm.setBookmark(cursorPos, {\n      widget: cursorHolder,\n      insertLeft: true,\n    });\n\n    this.showCursorNameReserve(cursorHolder);\n  }\n\n  updateLine(cm: CodeMirror.Editor, fromPos: CodeMirror.Position, toPos: CodeMirror.Position) {\n    this.removeLine();\n    this.status = CursorStatus.Activated;\n\n    this.lineMarker = cm.getDoc().markText(fromPos, toPos, {\n      css: `background-color : ${this.color}; opacity:0.7`,\n    });\n  }\n\n  // when user's cursor hover, show name\n  private showCursorNameReserve(cursorHolder: Element) {\n    const nameHolder = document.createElement('span');\n    nameHolder.classList.add('codePair-name');\n\n    cursorHolder.addEventListener('mouseenter', () => {\n      if (this.nameRemoveTimeMap.has(this.id)) {\n        clearTimeout(this.nameRemoveTimeMap.get(this.id)!);\n      }\n\n      nameHolder.textContent = this.username;\n      nameHolder.style.top = `-${this.height}px`;\n      nameHolder.style.backgroundColor = this.color;\n      nameHolder.style.color = invert(this.color, true);\n\n      /**\n       * nameEl is being reused.\n       * In order to keep the name visible while the mouse is hovering,\n       * It need to delete the css class containing animation when it is mouseenter and add it when it is mouseleave.\n       */\n      nameHolder.classList.remove('text-remove');\n      cursorHolder.appendChild(nameHolder);\n    });\n\n    cursorHolder.addEventListener('mouseleave', () => {\n      nameHolder.classList.add('text-remove');\n      nameHolder.style.animationDuration = `${this.nameAnimationDuration}s`;\n      nameHolder.style.animationDelay = `${this.nameAnimationDelay}s`;\n\n      this.removeNameReserve(nameHolder);\n    });\n  }\n\n  // After animate, It should actually be deleted it.\n  private removeNameReserve(nameHolder: HTMLSpanElement) {\n    const timeoutId = setTimeout(() => {\n      nameHolder.parentNode!.removeChild(nameHolder);\n      this.nameRemoveTimeMap.delete(this.id);\n    }, this.nameRemoveTime);\n\n    this.nameRemoveTimeMap.set(this.id, timeoutId);\n  }\n\n  removeCursor() {\n    if (this.marker) {\n      this.marker.clear();\n      this.marker = undefined;\n    }\n  }\n\n  removeLine() {\n    if (this.lineMarker) {\n      this.lineMarker.clear();\n      this.lineMarker = undefined;\n    }\n  }\n\n  clear() {\n    this.removeCursor();\n    this.removeLine();\n  }\n\n  isActive() {\n    return this.status === CursorStatus.Activated;\n  }\n}\n","import React, { useEffect, useRef, useCallback } from 'react';\nimport { useSelector } from 'react-redux';\nimport { ActorID } from 'yorkie-js-sdk';\nimport { UnControlled as CodeMirror } from 'react-codemirror2';\n\nimport { AppState } from 'app/rootReducer';\nimport { ConnectionStatus, Metadata } from 'features/peerSlices';\n\nimport Cursor from './Cursor';\n\nimport 'codemirror/addon/edit/closebrackets';\nimport 'codemirror/addon/edit/closetag';\n\nimport 'codemirror/mode/gfm/gfm';\nimport 'codemirror/mode/go/go';\nimport 'codemirror/mode/dart/dart';\nimport 'codemirror/mode/ruby/ruby';\nimport 'codemirror/mode/rust/rust';\nimport 'codemirror/mode/python/python';\nimport 'codemirror/mode/clojure/clojure';\nimport 'codemirror/mode/javascript/javascript';\n\nimport 'codemirror/keymap/sublime';\nimport 'codemirror/keymap/emacs';\nimport 'codemirror/keymap/vim';\n\nimport 'codemirror/lib/codemirror.css';\nimport 'codemirror/theme/monokai.css';\nimport 'codemirror/theme/material.css';\nimport './index.css';\n\nexport default function CodeEditor() {\n  const doc = useSelector((state: AppState) => state.docState.doc);\n  const codeMode = useSelector((state: AppState) => state.docState.mode);\n  const client = useSelector((state: AppState) => state.docState.client);\n  const peers = useSelector((state: AppState) => state.peerState.peers);\n  const menu = useSelector((state: AppState) => state.settingState.menu);\n  const cursorMapRef = useRef<Map<ActorID, Cursor>>(new Map());\n\n  const connectCursor = useCallback(\n    (clientID: ActorID, metadata: Metadata) => {\n      cursorMapRef.current.set(clientID, new Cursor(clientID, metadata));\n    },\n    [peers],\n  );\n\n  const disconnectCursor = useCallback((clientID: ActorID) => {\n    if (cursorMapRef.current.has(clientID)) {\n      cursorMapRef.current.get(clientID)!.clear();\n      cursorMapRef.current.delete(clientID);\n    }\n  }, []);\n\n  useEffect(() => {\n    for (const [id, peer] of Object.entries(peers)) {\n      if (cursorMapRef.current.has(id) && peer.status === ConnectionStatus.Disconnected) {\n        disconnectCursor(id);\n      } else if (!cursorMapRef.current.has(id) && peer.status === ConnectionStatus.Connected) {\n        connectCursor(id, peer.metadata);\n      }\n    }\n  }, [peers]);\n\n  if (!client || !doc) {\n    return null;\n  }\n\n  return (\n    <CodeMirror\n      className=\"CodeMirror\"\n      options={{\n        mode: codeMode,\n        theme: menu.codeTheme,\n        keyMap: menu.codeKeyMap,\n        tabSize: Number(menu.tabSize),\n        lineNumbers: true,\n        lineWrapping: true,\n        autoCloseTags: true,\n        autoCloseBrackets: true,\n      }}\n      editorDidMount={(editor: CodeMirror.Editor) => {\n        editor.focus();\n        const updateCursor = (clientID: ActorID, pos: CodeMirror.Position) => {\n          const cursor = cursorMapRef.current.get(clientID);\n          cursor?.updateCursor(editor, pos);\n        };\n\n        const updateLine = (clientID: ActorID, fromPos: CodeMirror.Position, toPos: CodeMirror.Position) => {\n          const cursor = cursorMapRef.current.get(clientID);\n          cursor?.updateLine(editor, fromPos, toPos);\n        };\n\n        // TODO(ppeeou) Load user's cursor position\n        doc.subscribe((event: any) => {\n          if (event.name === 'remote-change') {\n            event.value.forEach((change: any) => {\n              const { actor } = change.getID();\n              if (actor !== client.getID()) {\n                if (!cursorMapRef.current.has(actor)) {\n                  return;\n                }\n\n                const cursor = cursorMapRef.current.get(actor);\n                if (cursor!.isActive()) {\n                  return;\n                }\n\n                updateCursor(actor, editor.posFromIndex(0));\n              }\n            });\n          }\n        });\n\n        // When there is a document modification connected to the yorkie\n        const root = doc.getRootObject();\n        root.content.onChanges((changes: any) => {\n          changes.forEach((change: any) => {\n            const { actor, from, to } = change;\n            if (change.type === 'content') {\n              const content = change.content || '';\n\n              if (actor !== client.getID()) {\n                const fromPos = editor.posFromIndex(from);\n                const toPos = editor.posFromIndex(to);\n                editor.replaceRange(content, fromPos, toPos, 'yorkie');\n              }\n            } else if (change.type === 'selection') {\n              if (actor !== client.getID()) {\n                let fromPos = editor.posFromIndex(from);\n                let toPos = editor.posFromIndex(to);\n                updateCursor(actor, toPos);\n\n                if (from > to) {\n                  [toPos, fromPos] = [fromPos, toPos];\n                }\n                updateLine(actor, fromPos, toPos);\n              }\n            }\n          });\n        });\n\n        editor.setValue(root.content.getValue());\n      }}\n      // Notifying other clients to move the cursor\n      onSelection={(editor: CodeMirror.Editor, data: CodeMirror.EditorSelectionChange) => {\n        if (data.origin === undefined) {\n          return;\n        }\n\n        const from = editor.indexFromPos(data.ranges[0].anchor);\n        const to = editor.indexFromPos(data.ranges[0].head);\n\n        doc.update((root) => {\n          root.content.updateSelection(from, to);\n        });\n      }}\n      // Edit the yorkie document\n      onBeforeChange={(editor: CodeMirror.Editor, change: CodeMirror.EditorChange) => {\n        if (change.origin === 'yorkie' || change.origin === 'setValue') {\n          return;\n        }\n\n        const from = editor.indexFromPos(change.from);\n        const to = editor.indexFromPos(change.to);\n        const content = change.text.join('\\n');\n\n        doc.update((root) => {\n          root.content.edit(from, to, content);\n        });\n      }}\n    />\n  );\n}\n","import React from 'react';\nimport SvgIcon from '@material-ui/core/SvgIcon';\n\nexport default function Eraser() {\n  return (\n    <SvgIcon>\n      <svg version=\"1.1\" id=\"Layer_1\" x=\"0px\" y=\"0px\" viewBox=\"0 0 480.001 480.001\">\n        <g>\n          <g>\n            <path\n              d=\"M333.142,350.846c0.115-0.115,0.215-0.239,0.323-0.357l129.681-129.706c10.878-10.878,16.864-25.368,16.855-40.8\n          c-0.01-15.409-5.999-29.865-16.854-40.694l-97.844-97.874c-10.853-10.845-25.326-16.817-40.75-16.817\n          c-15.426,0-29.895,5.974-40.741,16.82L16.855,308.329C5.974,319.21-0.012,333.713,0,349.168\n          c0.013,15.425,6.002,29.884,16.854,40.7l62.592,62.606c0.061,0.061,0.127,0.112,0.188,0.171c0.174,0.165,0.349,0.331,0.534,0.483\n          c0.082,0.067,0.171,0.126,0.255,0.19c0.175,0.135,0.349,0.271,0.532,0.395c0.07,0.047,0.145,0.085,0.215,0.13\n          c0.205,0.131,0.412,0.26,0.627,0.376c0.051,0.026,0.103,0.048,0.154,0.074c0.239,0.123,0.482,0.241,0.732,0.346\n          c0.033,0.014,0.067,0.024,0.101,0.037c0.269,0.108,0.54,0.208,0.819,0.293c0.034,0.011,0.07,0.017,0.104,0.027\n          c0.276,0.081,0.556,0.154,0.841,0.211c0.082,0.017,0.165,0.023,0.247,0.038c0.239,0.041,0.479,0.084,0.724,0.107\n          c0.33,0.033,0.663,0.051,0.998,0.051h137.91h159.308c5.522,0,10-4.478,10-10c0-5.522-4.478-10-10-10H248.566l84.22-84.236\n          C332.904,351.06,333.027,350.96,333.142,350.846z M220.285,435.404H90.66l-59.675-59.689\n          c-7.076-7.054-10.977-16.487-10.985-26.563c-0.008-10.106,3.897-19.582,10.996-26.681l129.825-129.803l151.091,151.091\n          L220.285,435.404z M174.965,178.527L297.953,55.56c7.069-7.069,16.516-10.963,26.6-10.963c10.085,0,19.536,3.895,26.609,10.962\n          l97.85,97.88c7.08,7.063,10.982,16.493,10.989,26.557c0.006,10.085-3.899,19.547-10.998,26.645l-122.95,122.974L174.965,178.527z\"\n            />\n          </g>\n        </g>\n      </svg>\n    </SvgIcon>\n  );\n}\n","import React from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport IconButton from '@material-ui/core/IconButton';\nimport EditIcon from '@material-ui/icons/Edit';\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\nimport EraserIcon from 'assets/icons/Eraser';\nimport { AppState } from 'app/rootReducer';\nimport { Tool, setTool } from 'features/boardSlices';\n\nconst useStyles = makeStyles((theme) =>\n  createStyles({\n    root: {\n      display: 'flex',\n      flexDirection: 'column',\n    },\n    select: {\n      color: theme.palette.primary.main,\n    },\n  }),\n);\n\nexport default function Sidebar() {\n  const classes = useStyles();\n  const dispatch = useDispatch();\n  const tool = useSelector((state: AppState) => state.boardState.tool);\n\n  const handleSelectTool = (nextTool: Tool) => () => {\n    dispatch(setTool(nextTool));\n  };\n\n  return (\n    <div className={classes.root}>\n      <IconButton\n        aria-label=\"edit\"\n        className={tool === Tool.Line ? classes.select : ''}\n        onClick={handleSelectTool(Tool.Line)}\n      >\n        <EditIcon fontSize=\"small\" />\n      </IconButton>\n\n      <IconButton\n        aria-label=\"eraser\"\n        className={tool === Tool.Eraser ? classes.select : ''}\n        onClick={handleSelectTool(Tool.Eraser)}\n      >\n        <EraserIcon />\n      </IconButton>\n    </div>\n  );\n}\n","export default class Canvas {\n  private canvas: HTMLCanvasElement;\n\n  // eslint-disable-next-line react/static-property-placement\n  private context: CanvasRenderingContext2D;\n\n  width = 0;\n\n  height = 0;\n\n  constructor(canvas: HTMLCanvasElement) {\n    this.canvas = canvas;\n    this.context = canvas.getContext('2d')!;\n    this.resize();\n  }\n\n  getCanvas() {\n    return this.canvas;\n  }\n\n  getContext() {\n    return this.context;\n  }\n\n  getWidth() {\n    return this.width;\n  }\n\n  getHeight() {\n    return this.height;\n  }\n\n  setWidth(width: number) {\n    this.canvas.width = width;\n    this.width = width;\n    this.canvas.style.width = `${width}px`;\n  }\n\n  setHeight(height: number) {\n    this.canvas.height = height;\n    this.height = height;\n    this.canvas.style.height = `${height}px`;\n  }\n\n  setSize(width: number, height: number) {\n    this.setWidth(width);\n    this.setHeight(height);\n  }\n\n  clear() {\n    this.getContext().clearRect(0, 0, this.getWidth(), this.getHeight());\n  }\n\n  resize() {\n    this.setSize(this.canvas.width, this.canvas.height);\n  }\n}\n","import { Line, Point, EraserLine } from './Shape';\n\n/**\n * Create the basic object of the line with point.\n */\nexport function createLine(point: Point): Line {\n  return {\n    type: 'line',\n    points: [point],\n  } as Line;\n}\n\n/**\n * Create the basic object of the line with point.\n */\nexport function createEraserLine(point: Point): EraserLine {\n  return {\n    type: 'eraser',\n    points: [point],\n  } as EraserLine;\n}\n\n/**\n * Draw a line on the canvas.\n */\nexport function drawLine(context: CanvasRenderingContext2D, line: Line) {\n  context.beginPath();\n  let isMoved = false;\n  for (const p of line.points) {\n    if (isMoved === false) {\n      isMoved = true;\n      context.moveTo(p.x, p.y);\n    } else {\n      context.lineTo(p.x, p.y);\n    }\n  }\n  context.lineWidth = 3;\n  context.stroke();\n}\n\n/**\n * Draw a eraser line on the canvas.\n */\nexport function drawEraserLine(context: CanvasRenderingContext2D, color: string, line: EraserLine) {\n  context.beginPath();\n  const originColor = context.strokeStyle;\n  const [startPoint, endPoint] = line.points;\n  context.moveTo(startPoint.x, startPoint.y);\n  context.lineTo(endPoint.x, endPoint.y);\n  context.lineWidth = 5;\n  context.strokeStyle = color;\n  context.stroke();\n  context.strokeStyle = originColor;\n}\n\nconst eraserOffsetXSize = 8;\nconst eraserOffsetYSize = 6;\n/**\n * Match the mouse point position for eraser\n */\nexport function fixEraserPoint(point: Point) {\n  return {\n    y: point.y + eraserOffsetXSize,\n    x: point.x + eraserOffsetYSize,\n  };\n}\n","import { Point } from './Shape';\n\n/**\n * square distance between 2 points\n */\nfunction getSqDist(p1: Point, p2: Point) {\n  const dx = p1.x - p2.x;\n  const dy = p1.y - p2.y;\n\n  return dx * dx + dy * dy;\n}\n\n/**\n * square distance from a point to a segment\n */\nfunction getSqSegDist(p: Point, p1: Point, p2: Point) {\n  let { x, y } = p1;\n  let dx = p2.x - x;\n  let dy = p2.y - y;\n\n  if (dx !== 0 || dy !== 0) {\n    const t = ((p.x - x) * dx + (p.y - y) * dy) / (dx * dx + dy * dy);\n    if (t > 1) {\n      x = p2.x;\n      y = p2.y;\n    } else if (t > 0) {\n      x += dx * t;\n      y += dy * t;\n    }\n  }\n\n  dx = p.x - x;\n  dy = p.y - y;\n  return dx * dx + dy * dy;\n}\n\nfunction douglasPeuckerStep(\n  points: Array<Point>,\n  first: number,\n  last: number,\n  tolerance: number,\n  simplified: Array<Point>,\n) {\n  let maxDist = tolerance;\n  let index = 0;\n\n  for (let i = first + 1; i < last; i += 1) {\n    const dist = getSqSegDist(points[i], points[first], points[last]);\n\n    if (dist > maxDist) {\n      index = i;\n      maxDist = dist;\n    }\n  }\n\n  if (maxDist > tolerance) {\n    if (first + 1 < index) {\n      douglasPeuckerStep(points, first, index, tolerance, simplified);\n    }\n    simplified.push(points[index]);\n    if (index + 1 < last) {\n      douglasPeuckerStep(points, index, last, tolerance, simplified);\n    }\n  }\n}\n\nfunction douglasPeucker(points: Array<Point>, tolerance: number): Array<Point> {\n  const first = 0;\n  const last = points.length - 1;\n  const simplified = [];\n\n  simplified.push(points[first]);\n  douglasPeuckerStep(points, first, last, tolerance, simplified);\n  simplified.push(points[last]);\n\n  return simplified;\n}\n\nfunction simplifyRadialDist(points: Array<Point>, tolerance: number) {\n  let point = points[0];\n  let prevPoint = point;\n  const simplified = [prevPoint];\n\n  for (let i = 1, len = points.length; i < len; i += 1) {\n    point = points[i];\n\n    if (getSqDist(point, prevPoint) > tolerance) {\n      simplified.push(point);\n      prevPoint = point;\n    }\n  }\n\n  if (prevPoint !== point) {\n    simplified.push(point);\n  }\n  return simplified;\n}\n\n/**\n * @see {@link https://cartography-playground.gitlab.io/playgrounds/douglas-peucker-algorithm/}\n * @see {@link https://github.com/mourner/simplify-js}\n */\nexport function compressPoints(points: Array<Point>, tolerance: number = 10): Array<Point> {\n  return douglasPeucker(simplifyRadialDist(points, tolerance), tolerance);\n}\n\n/**\n * Check if the two lines overlap\n * @see {@link http://jsfiddle.net/justin_c_rounds/Gd2S2/}\n * @see {@link https://en.wikipedia.org/wiki/Line%E2%80%93line_intersection}\n */\nexport function checkLineIntersection(point1Start: Point, point1End: Point, point2Start: Point, point2End: Point) {\n  // if the lines intersect, the result contains the x and y of the intersection (treating the lines as infinite) and booleans for whether line segment 1 or line segment 2 contain the point\n  let a;\n  let b;\n  const result = {\n    x: 0,\n    y: 0,\n    onLine1: false,\n    onLine2: false,\n  };\n\n  const denominator =\n    (point2End.y - point2Start.y) * (point1End.x - point1Start.x) -\n    (point2End.x - point2Start.x) * (point1End.y - point1Start.y);\n  if (denominator === 0) {\n    return result;\n  }\n  a = point1Start.y - point2Start.y;\n  b = point1Start.x - point2Start.x;\n  const numerator1 = (point2End.x - point2Start.x) * a - (point2End.y - point2Start.y) * b;\n  const numerator2 = (point1End.x - point1Start.x) * a - (point1End.y - point1Start.y) * b;\n  a = numerator1 / denominator;\n  b = numerator2 / denominator;\n\n  // if we cast these lines infinitely in both directions, they intersect here:\n  result.x = point1Start.x + a * (point1End.x - point1Start.x);\n  result.y = point1Start.y + a * (point1End.y - point1Start.y);\n  /*\n  // it is worth noting that this should be the same as:\n  x = point2Start.x + (b * (point2End.x - point2Start.x));\n  y = point2Start.x + (b * (point2End.y - point2Start.y));\n  */\n  // if line1 is a segment and line2 is infinite, they intersect if:\n  if (a > 0 && a < 1) {\n    result.onLine1 = true;\n  }\n  // if line2 is a segment and line1 is infinite, they intersect if:\n  if (b > 0 && b < 1) {\n    result.onLine2 = true;\n  }\n  // if line1 and line2 are segments, they intersect if both of the above are true\n  return result;\n}\n","import { Point } from './Shape';\n\nexport type Task = {\n  point: Point;\n};\n\nconst INTERVAL_TIME = 50;\nlet tasks: Array<Task> = [];\nlet intervalId: number;\nlet work: Function | undefined;\n\nexport function requestHostCallback(callback: (tasks: Array<Task>) => void) {\n  work = () => {\n    if (tasks.length > 0) {\n      callback(tasks);\n      tasks = [];\n    }\n  };\n\n  intervalId = setInterval(work, INTERVAL_TIME);\n}\n\nexport function reserveTask(task: Task) {\n  tasks.push(task);\n}\n\nexport function requestHostWorkFlush() {\n  clearInterval(intervalId);\n\n  if (typeof work === 'function') {\n    work();\n  }\n  work = undefined;\n}\n","import { Tool } from 'features/boardSlices';\nimport Canvas from './Canvas';\n\nimport { Point, Line, Shapes, Shape, TimeTicket, EraserLine } from './Shape';\nimport { drawLine, drawEraserLine } from './line';\nimport Worker from './worker';\n\ninterface Options {\n  color: string;\n  eraserColor: string;\n}\n\nenum DragStatus {\n  Drag,\n  Stop,\n}\n\nexport default class Container {\n  pointY: number;\n\n  pointX: number;\n\n  offsetY: number;\n\n  offsetX: number;\n\n  scene: Canvas;\n\n  tool: Tool;\n\n  createId?: TimeTicket;\n\n  dragStatus: DragStatus;\n\n  update: Function;\n\n  options: Options;\n\n  worker: Worker;\n\n  constructor(el: HTMLCanvasElement, update: Function, options: Options) {\n    this.pointY = 0;\n    this.pointX = 0;\n    this.tool = Tool.Line;\n    this.dragStatus = DragStatus.Stop;\n    this.update = update;\n    this.options = options;\n    this.scene = new Canvas(el);\n\n    const { y, x } = this.scene.getCanvas().getBoundingClientRect();\n    this.offsetY = y;\n    this.offsetX = x;\n\n    this.init();\n\n    this.worker = new Worker(this.update);\n  }\n\n  init() {\n    this.scene.getContext().strokeStyle = this.options.color;\n\n    this.drawAll = this.drawAll.bind(this);\n    this.scene.getCanvas().onmouseup = this.onmouseup.bind(this);\n    this.scene.getCanvas().onmouseout = this.onmouseup.bind(this);\n    this.scene.getCanvas().onmousedown = this.onmousedown.bind(this);\n    this.scene.getCanvas().onmousemove = this.onmousemove.bind(this);\n  }\n\n  setTool(tool: Tool) {\n    this.setMouseClass(tool);\n\n    this.tool = tool;\n  }\n\n  setMouseClass(tool: Tool) {\n    this.scene.getCanvas().className = '';\n\n    if (tool === Tool.Line) {\n      this.scene.getCanvas().classList.add('crosshair');\n    } else if (tool === Tool.Eraser) {\n      this.scene.getCanvas().classList.add('eraser');\n    }\n  }\n\n  getMouse(evt: MouseEvent): Point {\n    return {\n      y: evt.pageY - this.offsetY,\n      x: evt.pageX - this.offsetX,\n    };\n  }\n\n  onmousedown(evt: MouseEvent) {\n    const point = this.getMouse(evt);\n    if (this.isOutSide(point)) {\n      return;\n    }\n\n    this.dragStatus = DragStatus.Drag;\n\n    if (this.worker.isRecordWork(this.tool)) {\n      this.createId = this.worker.createShape(this.tool, point);\n      this.worker.executeTask(this.createId, this.tool, this.drawAll);\n    }\n  }\n\n  onmousemove(evt: MouseEvent) {\n    const point = this.getMouse(evt);\n    if (this.isOutSide(point)) {\n      return;\n    }\n\n    if (this.dragStatus === DragStatus.Stop) {\n      return;\n    }\n\n    if (this.worker.isRecordWork(this.tool)) {\n      this.worker.reserveTask({\n        point,\n      });\n    }\n  }\n\n  onmouseup() {\n    this.dragStatus = DragStatus.Stop;\n\n    if (this.worker.isRecordWork(this.tool)) {\n      this.worker.flushTask(this.createId, this.tool, this.drawAll);\n      this.createId = undefined;\n    }\n  }\n\n  isOutSide(point: Point) {\n    if (point.y < 0 || point.x < 0 || point.y > this.scene.getHeight() || point.x > this.scene.getWidth()) {\n      this.onmouseup();\n      return true;\n    }\n    return false;\n  }\n\n  drawAll(shapes: Shapes, canvas: Canvas = this.scene) {\n    canvas.clear();\n    for (const shape of shapes) {\n      this.draw(shape, canvas);\n    }\n  }\n\n  draw(shape: Shape, canvas: Canvas = this.scene) {\n    if (shape.type === 'line') {\n      drawLine(canvas.getContext(), shape as Line);\n    } else if (shape.type === 'eraser') {\n      drawEraserLine(canvas.getContext(), this.options.eraserColor, shape as EraserLine);\n    }\n  }\n\n  clear() {\n    this.scene.clear();\n  }\n}\n","import { Tool } from 'features/boardSlices';\n\nimport { Root, Point, Line, TimeTicket } from './Shape';\nimport { compressPoints, checkLineIntersection } from './utils';\nimport { createLine, createEraserLine, fixEraserPoint } from './line';\nimport * as schedule from './schedule';\n\nexport default class Worker {\n  update: Function;\n\n  constructor(update: Function) {\n    this.update = update;\n  }\n\n  /**\n   * Check if the work is to be recorded\n   */\n  isRecordWork(tool: Tool) {\n    if (tool === Tool.Line || tool === Tool.Eraser) {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Create shape according to tool\n   */\n  createShape(tool: Tool, point: Point): TimeTicket {\n    let createId;\n\n    this.update((root: Root) => {\n      if (tool === Tool.Line) {\n        const shape = createLine(point);\n        root.shapes.push(shape);\n      } else if (tool === Tool.Eraser) {\n        const shape = createEraserLine(point);\n        root.shapes.push(shape);\n      }\n\n      const lastShape = root.shapes.getLast();\n      createId = lastShape.getID();\n    });\n\n    return createId;\n  }\n\n  /**\n   * Task execution by scheduler\n   */\n  executeTask(createId: TimeTicket, tool: Tool, callback: Function) {\n    schedule.requestHostCallback((tasks) => {\n      this.update((root: Root) => {\n        if (tool === Tool.Line) {\n          const points = compressPoints(tasks.map((task) => task.point));\n          const lastShape = root.shapes.getElementByID(createId) as Line;\n\n          lastShape.points.push(...points);\n          callback(root.shapes);\n        } else if (tool === Tool.Eraser) {\n          if (tasks.length < 2) {\n            return;\n          }\n\n          const points = compressPoints(tasks.map((task) => task.point));\n          const pointStart = fixEraserPoint(points[0]);\n          const pointEnd = fixEraserPoint(points[points.length - 1]);\n          const lastShape = root.shapes.getElementByID(createId) as Line;\n\n          const findAndRemoveShape = (point1: Point, point2: Point) => {\n            for (const shape of root.shapes) {\n              for (let i = 1; i < shape.points.length; i += 1) {\n                const result = checkLineIntersection(point1, point2, shape.points[i - 1], shape.points[i]);\n                if (result.onLine1 && result.onLine2) {\n                  root.shapes.deleteByID(shape.getID());\n                  break;\n                }\n              }\n            }\n          };\n\n          if (lastShape.points.length > 0) {\n            const lastPoint = lastShape.points[lastShape.points.length - 1];\n            findAndRemoveShape(lastPoint, pointStart);\n          }\n\n          findAndRemoveShape(pointStart, pointEnd);\n          lastShape.points = [pointStart, pointEnd];\n          callback(root.shapes);\n        }\n      });\n    });\n  }\n\n  /**\n   * Schedule the task to be executed in the scheduler\n   */\n  reserveTask(task: schedule.Task) {\n    schedule.reserveTask(task);\n  }\n\n  /**\n   * Flush existing tasks in the scheduler\n   */\n  flushTask(createId: TimeTicket, tool: Tool, callback: Function) {\n    schedule.requestHostWorkFlush();\n\n    if (!createId) {\n      return;\n    }\n\n    this.update((root: Root) => {\n      if (tool === Tool.Line) {\n        const shape = root.shapes.getElementByID(createId);\n        // When erasing a line, it checks that the lines overlap, so do not save if there are two points below\n        if (shape.points.length < 2) {\n          root.shapes.deleteByID(createId);\n          callback(root.shapes);\n        }\n      } else if (tool === Tool.Eraser) {\n        root.shapes.deleteByID(createId);\n        callback(root.shapes);\n      }\n    });\n  }\n}\n","import React, { useEffect, useRef } from 'react';\nimport { useSelector } from 'react-redux';\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\nimport grey from '@material-ui/core/colors/grey';\nimport deepOrange from '@material-ui/core/colors/deepOrange';\n\nimport { AppState } from 'app/rootReducer';\n\nimport Container from './Canvas/Container';\n\nconst useStyles = makeStyles(() =>\n  createStyles({\n    root: {\n      width: '100%',\n      height: '100%',\n    },\n  }),\n);\n\nexport default function Content() {\n  const classes = useStyles();\n  const divRef = useRef<HTMLDivElement>(null);\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const containerRef = useRef<Container | null>(null);\n  const doc = useSelector((state: AppState) => state.docState.doc);\n  const tool = useSelector((state: AppState) => state.boardState.tool);\n\n  useEffect(() => {\n    const onResize = () => {\n      if (!divRef.current || !canvasRef.current || !doc) {\n        return;\n      }\n\n      const { width, height } = divRef.current?.getBoundingClientRect();\n      canvasRef.current.width = width;\n      canvasRef.current.height = height;\n\n      const options = {\n        color: grey[500],\n        eraserColor: deepOrange[400],\n      };\n\n      containerRef.current = new Container(canvasRef.current, doc.update.bind(doc), options);\n      containerRef.current.setTool(tool);\n      containerRef.current.drawAll(doc.getRootObject().shapes);\n    };\n\n    onResize();\n    window.addEventListener('resize', onResize);\n    return () => {\n      window.removeEventListener('resize', onResize);\n    };\n  }, [doc, tool]);\n\n  useEffect(() => {\n    if (!doc) {\n      return () => {};\n    }\n\n    const unsubscribe = doc.subscribe((event) => {\n      if (event.name === 'remote-change') {\n        containerRef.current?.drawAll(doc.getRootObject().shapes);\n      }\n    });\n\n    return () => {\n      unsubscribe();\n    };\n  }, [doc]);\n\n  useEffect(() => {\n    containerRef.current?.setTool(tool);\n  }, [doc, tool]);\n\n  return (\n    <div className={classes.root} ref={divRef}>\n      <canvas ref={canvasRef} />\n    </div>\n  );\n}\n","import React from 'react';\n\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\nimport grey from '@material-ui/core/colors/grey';\n\nimport Sidebar from './Sidebar';\nimport Content from './Content';\nimport './index.css';\n\nconst SIDEBAR_WIDTH = '40px';\n\nconst useStyles = makeStyles(() =>\n  createStyles({\n    root: {\n      display: 'flex',\n      height: '100%',\n    },\n    sidebar: {\n      width: SIDEBAR_WIDTH,\n      border: `1px solid ${grey[700]}`,\n    },\n    content: {\n      borderTop: `1px solid ${grey[700]}`,\n      width: `calc( 100% - ${SIDEBAR_WIDTH} )`,\n    },\n  }),\n);\n\nexport default function Board() {\n  const classes = useStyles();\n\n  return (\n    <div className={classes.root}>\n      <div className={classes.sidebar}>\n        <Sidebar />\n      </div>\n      <div className={classes.content}>\n        <Content />\n      </div>\n    </div>\n  );\n}\n","import React, { useEffect } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\n\nimport { Box } from '@material-ui/core';\nimport Snackbar from '@material-ui/core/Snackbar';\nimport Alert from '@material-ui/lab/Alert';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\n\nimport { AppState } from 'app/rootReducer';\nimport CodeEditor from 'components/Editor/CodeEditor';\nimport Board from 'components/Editor/Board';\n\nimport {\n  activateClient,\n  deactivateClient,\n  createDocument,\n  detachDocument,\n  attachDoc,\n  attachDocLoading,\n  CodeMode,\n  setCodeMode,\n} from 'features/docSlices';\nimport { syncPeer } from 'features/peerSlices';\n\nconst NAVBAR_HEIGHT = 110;\n\nconst useStyles = makeStyles(() =>\n  createStyles({\n    root: {\n      flexGrow: 1,\n      display: 'flex',\n      height: `calc(100vh - ${NAVBAR_HEIGHT}px)`,\n    },\n    loading: {\n      display: 'flex',\n      height: `calc(100vh - ${NAVBAR_HEIGHT}px)`,\n      alignItems: 'center',\n      justifyContent: 'center',\n    },\n  }),\n);\n\nexport default function Editor(props: { docKey: string }) {\n  const { docKey } = props;\n  const classes = useStyles();\n  const dispatch = useDispatch();\n  const client = useSelector((state: AppState) => state.docState.client);\n  const doc = useSelector((state: AppState) => state.docState.doc);\n  const loading = useSelector((state: AppState) => state.docState.loading);\n  const errorMessage = useSelector((state: AppState) => state.docState.errorMessage);\n  const isOpen = useSelector((state: AppState) => state.boardState.isOpen);\n\n  const boardWidth = isOpen ? '650px' : '0px';\n  const editorWidth = `calc( 100% - ${boardWidth} )`;\n\n  useEffect(() => {\n    dispatch(activateClient());\n    return () => {\n      dispatch(deactivateClient());\n    };\n  }, []);\n\n  useEffect(() => {\n    if (!client || !doc) {\n      return () => {};\n    }\n\n    const unsubscribe = client.subscribe((event) => {\n      if (event.name === 'peers-changed') {\n        const documentKey = doc.getKey().toIDString();\n        const changedPeers = event.value[documentKey];\n        dispatch(syncPeer(changedPeers));\n      }\n    });\n\n    return () => {\n      unsubscribe();\n    };\n  }, [client, doc]);\n\n  useEffect(() => {\n    dispatch(createDocument(docKey));\n    return () => {\n      dispatch(detachDocument());\n    };\n  }, [docKey]);\n\n  useEffect(() => {\n    async function attachDocAsync() {\n      if (!client || !doc) {\n        return;\n      }\n\n      dispatch(attachDocLoading(true));\n      await dispatch(attachDoc({ client, doc }));\n      dispatch(setCodeMode(doc.getRootObject().mode || CodeMode.Markdown));\n      dispatch(attachDocLoading(false));\n    }\n\n    attachDocAsync();\n    return () => {\n      dispatch(attachDocLoading(true));\n    };\n  }, [docKey, client, doc]);\n\n  if (errorMessage) {\n    return (\n      <div>\n        <Snackbar open anchorOrigin={{ vertical: 'top', horizontal: 'center' }}>\n          <Alert severity=\"warning\">{errorMessage || 'fail to attach document'}</Alert>\n        </Snackbar>\n      </div>\n    );\n  }\n\n  if (loading) {\n    return (\n      <Box className={classes.loading}>\n        <CircularProgress color=\"inherit\" />\n      </Box>\n    );\n  }\n\n  return (\n    <div className={classes.root}>\n      <div style={{ width: editorWidth }}>\n        <CodeEditor />\n      </div>\n      {isOpen && (\n        <div style={{ width: boardWidth }}>\n          <Board />\n        </div>\n      )}\n    </div>\n  );\n}\n","import React from 'react';\nimport { RouteComponentProps } from 'react-router';\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\n\nimport NavBar from 'components/NavBar';\nimport Toolbar from 'components/Toolbar';\nimport Editor from 'components/Editor';\n\ntype DocPageProps = {\n  docKey: string;\n};\n\nconst useStyles = makeStyles(() =>\n  createStyles({\n    root: {\n      flexGrow: 1,\n    },\n  }),\n);\n\nexport default function DocPage(props: RouteComponentProps<DocPageProps>) {\n  const classes = useStyles();\n  const {\n    match: { params },\n  } = props;\n  const { docKey } = params;\n\n  return (\n    <div className={classes.root}>\n      <NavBar />\n      <Toolbar />\n      <Editor docKey={docKey} />\n    </div>\n  );\n}\n","import React, { useMemo, useCallback } from 'react';\nimport { HashRouter as Router, Route, Redirect } from 'react-router-dom';\nimport useMediaQuery from '@material-ui/core/useMediaQuery';\nimport CssBaseline from '@material-ui/core/CssBaseline';\nimport { createMuiTheme, ThemeProvider } from '@material-ui/core/styles';\n\nimport DocPage from 'pages/DocPage';\nimport './App.css';\n\nfunction App() {\n  const prefersDarkMode = useMediaQuery('(prefers-color-scheme: dark)');\n  const theme = useMemo(\n    () =>\n      createMuiTheme({\n        palette: {\n          type: !prefersDarkMode ? 'dark' : 'light',\n          primary: {\n            main: '#d8b01a',\n          },\n          secondary: {\n            main: '#e6b602',\n          },\n        },\n      }),\n    [prefersDarkMode],\n  );\n\n  const handleRender = useCallback(() => {\n    return <Redirect to={`/${Math.random().toString(36).substring(7)}`} />;\n  }, []);\n\n  return (\n    <ThemeProvider theme={theme}>\n      {/* CssBaseline kickstart an elegant, consistent, and simple baseline to build upon. */}\n      <CssBaseline />\n      <Router>\n        <Route path=\"/\" exact render={handleRender} />\n        <Route path=\"/:docKey\" exact component={DocPage} />\n      </Router>\n    </ThemeProvider>\n  );\n}\n\nexport default App;\n","import { combineReducers } from 'redux';\n\nimport docReducer from 'features/docSlices';\nimport peerReducer from 'features/peerSlices';\nimport settingReducer from 'features/settingSlices';\nimport boardReducer from 'features/boardSlices';\n\nconst rootReducer = combineReducers({\n  docState: docReducer,\n  peerState: peerReducer,\n  settingState: settingReducer,\n  boardState: boardReducer,\n});\n\nexport type AppState = ReturnType<typeof rootReducer>;\n\nexport default rootReducer;\n","import { configureStore, Action, getDefaultMiddleware } from '@reduxjs/toolkit';\nimport { ThunkAction } from 'redux-thunk';\n\nimport rootReducer, { AppState } from './rootReducer';\n\nconst store = configureStore({\n  reducer: rootReducer,\n  middleware: getDefaultMiddleware({\n    serializableCheck: {\n      ignoredActions: ['doc/attach/fulfilled', 'doc/activate/fulfilled'],\n      ignoredPaths: ['docState.client', 'docState.doc'],\n    },\n    immutableCheck: {\n      ignoredPaths: ['docState.client', 'docState.doc'],\n    },\n  }),\n});\n\nexport type AppDispatch = typeof store.dispatch;\n\nexport type AppThunk = ThunkAction<void, AppState, unknown, Action<string>>;\n\nexport default store;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,\n    ),\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA',\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.',\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.',\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then((registration) => {\n        registration.unregister();\n      })\n      .catch((error) => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Provider } from 'react-redux';\nimport App from 'app/App';\nimport store from 'app/store';\n\nimport * as serviceWorker from 'serviceWorker';\n\nReactDOM.render(\n  <Provider store={store}>\n    <App />\n  </Provider>,\n  document.querySelector('#root'),\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}