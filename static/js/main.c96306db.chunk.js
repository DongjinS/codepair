(this["webpackJsonpyorkie-codepair"]=this["webpackJsonpyorkie-codepair"]||[]).push([[0],{130:function(e,t,n){},131:function(e,t,n){},133:function(e,t,n){"use strict";n.r(t);var a,o=n(0),r=n.n(o),c=n(7),i=n.n(c),s=n(77),u=n(12),l=n(19),d=n(181),m=n(183),h=n(78),f=n(182),p=n(22),v=n(17),b=n(33),g=n.n(b),y=n(47),j=n(57),k=n.n(j),E=Object(p.b)("docs/attach",function(){var e=Object(y.a)(g.a.mark((function e(t,n){var a,o;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=k.a.createClient("".concat("/api")),o=k.a.createDocument("codepairs",t),e.next=5,a.activate();case 5:return e.next=7,a.attach(o);case 7:return o.update((function(e){e.content||e.createText("content")})),e.next=10,a.sync();case 10:return e.abrupt("return",{document:o,client:a});case 13:return e.prev=13,e.t0=e.catch(0),e.abrupt("return",n.rejectWithValue(e.t0));case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,n){return e.apply(this,arguments)}}()),x=Object(p.c)({name:"doc",initialState:{client:null,doc:null,loading:!1,errorMessage:""},reducers:{attachDocLoading:function(e,t){e.loading=t.payload}},extraReducers:function(e){e.addCase(E.fulfilled,(function(e,t){var n=t.payload;e.doc=n.document,e.client=n.client})),e.addCase(E.rejected,(function(e,t){var n=t.payload;e.errorMessage=n}))}}),C=x.actions.attachDocLoading,O=x.reducer;!function(e){e.Connected="connected",e.Disconnected="disconnected"}(a||(a={}));var M,S,w,D,T=Object(p.c)({name:"peer",initialState:{peers:{}},reducers:{connectPeer:function(e,t){var n=t.payload,a=n.id,o=n.color,r=n.status;e.peers[a]={id:a,color:o,status:r}},disconnectPeer:function(e,t){e.peers[t.payload].status=a.Disconnected}}}),R=T.actions,L=R.connectPeer,N=R.disconnectPeer,P=T.reducer;!function(e){e.Javascript="javascript",e.Clojure="clojure",e.Dart="dart",e.Go="go",e.Python="python",e.Ruby="ruby",e.Rust="rust"}(M||(M={})),function(e){e.Material="material",e.Monokai="monokai"}(S||(S={})),function(e){e.Sublime="sublime",e.Vim="vim",e.Emacs="emacs"}(w||(w={})),function(e){e.Two="2",e.Four="4",e.Eight="8"}(D||(D={}));var I={menu:{codeMode:M.Go,codeTheme:S.Monokai,codeKeyMap:w.Sublime,tabSize:D.Two}},F=Object(p.c)({name:"setting",initialState:I,reducers:{setCodeMode:function(e,t){e.menu.codeMode=t.payload},setCodeTheme:function(e,t){e.menu.codeTheme=t.payload},setCodeKeyMap:function(e,t){e.menu.codeKeyMap=t.payload},setTabSize:function(e,t){e.menu.tabSize=t.payload}}}),A=F.actions,K=A.setCodeMode,z=(A.setCodeTheme,A.setCodeKeyMap,A.setTabSize,F.reducer),B=Object(v.c)({docState:O,peerState:P,settingState:z}),G=Object(p.a)({reducer:B,middleware:Object(p.d)({serializableCheck:{ignoredActions:["docs/attach/fulfilled"],ignoredPaths:["docState.client","docState.doc"]},immutableCheck:{ignoredPaths:["docState.client","docState.doc"]}})}),V=n(173),W=n(190),J=n(175),U=n(176),q=n(177),Y=Object(V.a)((function(e){return Object(W.a)({root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}})}));function $(){var e=Y();return r.a.createElement("div",{className:e.root},r.a.createElement(J.a,{position:"static"},r.a.createElement(U.a,null,r.a.createElement(q.a,{variant:"h6",className:e.title},"Yorkie CodePair"))))}var H=n(79),Q=n(178),X=n(184),Z=n(191),_=n(179),ee=Object(V.a)((function(e){return Object(W.a)({root:{padding:"6px",position:"relative"},formControl:{minWidth:140,border:"1px solid ".concat(e.palette.grey[800]),borderRadius:"4px"},selectEmpty:{paddingLeft:"12px"},box:{display:"flex",justifyContent:"space-between"}})}));function te(){var e=Object(l.b)(),t=ee(),n=Object(l.c)((function(e){return e.settingState.menu}));return r.a.createElement("div",{className:t.root},r.a.createElement(Q.a,{container:!0,direction:"row",justify:"space-between",alignItems:"flex-end"},r.a.createElement(Q.a,{item:!0},r.a.createElement(_.a,{className:t.formControl},r.a.createElement(X.a,{name:"codeMode",value:n.codeMode,onChange:function(t){e(K(t.target.value))},className:t.selectEmpty,disableUnderline:!0,displayEmpty:!0},Object.entries(M).map((function(e){var t=Object(H.a)(e,2),n=t[0],a=t[1];return r.a.createElement(Z.a,{value:a,key:a},n)})))))))}var ne=n(72),ae=n(185),oe=n(189),re=n(186),ce=n(180),ie=n(73),se=n.n(ie),ue=n(74),le=n(75),de=n(76),me=n.n(de),he=function(){function e(t,n){Object(ue.a)(this,e),this.id=void 0,this.color=void 0,this.height=void 0,this.marker=void 0,this.lineMarker=void 0,this.nameRemoveTimeMap=void 0,this.nameAnimationDelay=void 0,this.nameAnimationDuration=void 0,this.nameRemoveTime=void 0,this.id=t,this.color=n,this.height=0,this.marker=null,this.lineMarker=null,this.nameRemoveTimeMap=new Map,this.nameAnimationDelay=1,this.nameAnimationDuration=.2,this.nameRemoveTime=1e3*(this.nameAnimationDuration+this.nameAnimationDelay)}return Object(le.a)(e,[{key:"updateCursor",value:function(e,t){this.removeCursor();var n=e.cursorCoords(t),a=document.createElement("span");this.height=n.bottom-n.top,a.classList.add("codePair-cursor"),a.style.borderLeftColor=this.color,a.style.height="".concat(this.height,"px"),this.marker=e.setBookmark(t,{widget:a,insertLeft:!0}),this.showCursorNameReserve(a)}},{key:"updateLine",value:function(e,t,n){this.removeLine(),this.lineMarker=e.getDoc().markText(t,n,{css:"background-color : ".concat(this.color,"; opacity:0.7")})}},{key:"showCursorNameReserve",value:function(e){var t=this,n=document.createElement("span");n.classList.add("codePair-name"),e.addEventListener("mouseenter",(function(){t.nameRemoveTimeMap.has(t.id)&&clearTimeout(t.nameRemoveTimeMap.get(t.id)),n.textContent=t.id,n.style.top="-".concat(t.height,"px"),n.style.backgroundColor=t.color,n.style.color=me()(t.color,!0),n.classList.remove("text-remove"),e.appendChild(n)})),e.addEventListener("mouseleave",(function(){n.classList.add("text-remove"),n.style.animationDuration="".concat(t.nameAnimationDuration,"s"),n.style.animationDelay="".concat(t.nameAnimationDelay,"s"),t.removeNameReserve(n)}))}},{key:"removeNameReserve",value:function(e){var t=this,n=setTimeout((function(){e.parentNode.removeChild(e),t.nameRemoveTimeMap.delete(t.id)}),this.nameRemoveTime);this.nameRemoveTimeMap.set(this.id,n)}},{key:"removeCursor",value:function(){this.marker&&(this.marker.clear(),this.marker=null)}},{key:"removeLine",value:function(){this.lineMarker&&(this.lineMarker.clear(),this.lineMarker=null)}}]),e}(),fe=(n(115),n(116),n(118),n(119),n(121),n(122),n(124),n(125),n(126),n(127),n(128),n(129),n(130),Object(V.a)((function(){return{root:{display:"flex",height:"calc(100vh - 110px)",alignItems:"center",justifyContent:"center"}}})));function pe(e){var t=Object(l.b)(),n=fe(),c=e.docKey,i=Object(l.c)((function(e){return e.docState.doc})),s=Object(l.c)((function(e){return e.docState.client})),u=Object(l.c)((function(e){return e.docState.loading})),d=Object(l.c)((function(e){return e.docState.errorMessage})),m=Object(l.c)((function(e){return e.peerState.peers})),h=Object(l.c)((function(e){return e.settingState.menu})),f=Object(o.useRef)(new Map),p=function(e){var n,o=m[e];n=o&&o.status===a.Disconnected?o.color:se()();var r=new he(e,n);f.current.set(e,r),t(L({id:e,color:n,status:a.Connected}))};return Object(o.useEffect)((function(){function e(){return(e=Object(y.a)(g.a.mark((function e(){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t(C(!0)),e.next=3,t(E(c));case 3:t(C(!1));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[c,t]),Object(o.useEffect)((function(){if(!s||!i)return function(){};var e=function(e){f.current.has(e)&&(f.current.get(e).removeCursor(),f.current.delete(e)),t(N(e))},n=s.subscribe((function(t){if("peers-changed"===t.name)for(var n=t.value[i.getKey().toIDString()],o=0,r=Object.keys(m);o<r.length;o++){var c=r[o];n[c]&&m[c].status===a.Connected||e(c)}}));return function(){n()}}),[s,i,m,t]),u?r.a.createElement(ae.a,{className:n.root},r.a.createElement(ce.a,{color:"inherit"})):d||null===s||null===i?r.a.createElement("div",{className:n.root},r.a.createElement(oe.a,{open:!0,anchorOrigin:{vertical:"top",horizontal:"center"}},r.a.createElement(re.a,{severity:"warning"},d||"fail to attach document"))):r.a.createElement(ne.UnControlled,{options:{mode:h.codeMode,theme:h.codeTheme,lineNumbers:!0,lineWrapping:!0,autoCloseTags:!0,autoCloseBrackets:!0},editorDidMount:function(e){e.focus();var t=function(t,n){f.current.get(t).updateCursor(e,n)};i.subscribe((function(n){"remote-change"===n.name&&n.value.forEach((function(n){var a=n.getID().actor;a!==s.getID()&&(f.current.has(a)||(p(a),t(a,e.posFromIndex(0))))}))}));var n=i.getRootObject();n.content.onChanges((function(n){n.forEach((function(n){var a=n.actor,o=n.from,r=n.to;if("content"===n.type){var c=n.content||"";if(a!==s.getID()){var i=e.posFromIndex(o),u=e.posFromIndex(r);e.replaceRange(c,i,u,"yorkie")}}else if("selection"===n.type&&a!==s.getID()){f.current.has(a)||p(a);var l=e.posFromIndex(o),d=e.posFromIndex(r);if(t(a,d),o>r){var m=[l,d];d=m[0],l=m[1]}!function(t,n,a){f.current.get(t).updateLine(e,n,a)}(a,l,d)}}))})),e.setSize("auto","calc(100vh - 110px)"),e.setValue(n.content.getValue())},onSelection:function(e,t){if(void 0!==t.origin){var n=e.indexFromPos(t.ranges[0].anchor),a=e.indexFromPos(t.ranges[0].head);i.update((function(e){e.content.updateSelection(n,a)}))}},onBeforeChange:function(e,t){if("yorkie"!==t.origin&&"setValue"!==t.origin){var n=e.indexFromPos(t.from),a=e.indexFromPos(t.to),o=t.text.join("\n");i.update((function(e){e.content.edit(n,a,o)}))}}})}var ve=Object(V.a)((function(){return Object(W.a)({root:{flexGrow:1}})}));function be(e){var t=ve(),n=e.match.params.docKey;return r.a.createElement("div",{className:t.root},r.a.createElement($,null),r.a.createElement(te,null),r.a.createElement(pe,{docKey:n}))}n(131);var ge=function(){var e=Object(d.a)("(prefers-color-scheme: dark)"),t=Object(o.useMemo)((function(){return Object(h.a)({palette:{type:e?"dark":"light"}})}),[e]);return r.a.createElement(l.a,{store:G},r.a.createElement(f.a,{theme:t},r.a.createElement(m.a,null),r.a.createElement(s.a,null,r.a.createElement(u.b,{path:"/",exact:!0,render:function(){return r.a.createElement(u.a,{to:"/".concat(Math.random().toString(36).substring(7))})}}),r.a.createElement(u.b,{path:"/:docKey",exact:!0,component:be}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(ge,null),document.querySelector("#root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[133,1,2]]]);
//# sourceMappingURL=main.c96306db.chunk.js.map