(this["webpackJsonpyorkie-codepair"]=this["webpackJsonpyorkie-codepair"]||[]).push([[0],{150:function(e,t,a){},151:function(e,t,a){},153:function(e,t,a){"use strict";a.r(t);var n,r=a(0),o=a.n(r),c=a(8),i=a.n(c),s=a(89),l=a(12),u=a(16),m=a(200),d=a(202),p=a(90),f=a(201),h=a(22),v=a(18),b=a(38),g=a.n(b),y=a(49),E=a(62),j=a.n(E),x=Object(h.b)("docs/attach",function(){var e=Object(y.a)(g.a.mark((function e(t,a){var n,r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=j.a.createClient("".concat("/api")),r=j.a.createDocument("codepairs",t),e.next=5,n.activate();case 5:return e.next=7,n.attach(r);case 7:return r.update((function(e){e.content||e.createText("content")})),e.next=10,n.sync();case 10:return e.abrupt("return",{document:r,client:n});case 13:return e.prev=13,e.t0=e.catch(0),e.abrupt("return",a.rejectWithValue(e.t0));case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,a){return e.apply(this,arguments)}}()),k=Object(h.c)({name:"doc",initialState:{client:null,doc:null,loading:!1,errorMessage:""},reducers:{attachDocLoading:function(e,t){e.loading=t.payload}},extraReducers:function(e){e.addCase(x.fulfilled,(function(e,t){var a=t.payload;e.doc=a.document,e.client=a.client})),e.addCase(x.rejected,(function(e,t){var a=t.payload;e.errorMessage=a}))}}),O=k.actions.attachDocLoading,C=k.reducer;!function(e){e.Connected="connected",e.Disconnected="disconnected"}(n||(n={}));var S,M,w,T,N=Object(h.c)({name:"peer",initialState:{peers:{}},reducers:{connectPeer:function(e,t){var a=t.payload,n=a.id,r=a.color,o=a.status;e.peers[n]={id:n,color:r,status:o}},disconnectPeer:function(e,t){e.peers[t.payload].status=n.Disconnected}}}),D=N.actions,R=D.connectPeer,I=D.disconnectPeer,L=N.reducer;!function(e){e.Javascript="javascript",e.Clojure="clojure",e.Dart="dart",e.Go="go",e.Python="python",e.Ruby="ruby",e.Rust="rust"}(S||(S={})),function(e){e.Material="material",e.Monokai="monokai"}(M||(M={})),function(e){e.Sublime="sublime",e.Vim="vim",e.Emacs="emacs"}(w||(w={})),function(e){e.Two="2",e.Four="4",e.Eight="8"}(T||(T={}));var P={menu:{codeMode:S.Go,codeTheme:M.Monokai,codeKeyMap:w.Sublime,tabSize:T.Two}},z=Object(h.c)({name:"setting",initialState:P,reducers:{setCodeMode:function(e,t){e.menu.codeMode=t.payload},setCodeTheme:function(e,t){e.menu.codeTheme=t.payload},setCodeKeyMap:function(e,t){e.menu.codeKeyMap=t.payload},setTabSize:function(e,t){e.menu.tabSize=t.payload}}}),K=z.actions,A=K.setCodeMode,F=K.setCodeTheme,B=K.setCodeKeyMap,W=K.setTabSize,G=z.reducer,U=Object(v.c)({docState:C,peerState:L,settingState:G}),V=Object(h.a)({reducer:U,middleware:Object(h.d)({serializableCheck:{ignoredActions:["docs/attach/fulfilled"],ignoredPaths:["docState.client","docState.doc"]},immutableCheck:{ignoredPaths:["docState.client","docState.doc"]}})}),J=a(191),q=a(209),H=a(193),Y=a(194),$=a(195),Q=Object(J.a)((function(e){return Object(q.a)({root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}})}));function X(){var e=Q();return o.a.createElement("div",{className:e.root},o.a.createElement(H.a,{position:"static"},o.a.createElement(Y.a,null,o.a.createElement($.a,{variant:"h6",className:e.title},"Yorkie CodePair"))))}var Z=a(41),_=a(198),ee=a(203),te=a(210),ae=a(196),ne=a(83),re=a.n(ne),oe=a(206),ce=a(212),ie=Object(J.a)((function(){return Object(q.a)({modal:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}})})),se=function(e){var t=e.open,a=e.onClose,n=e.children,r=ie();return o.a.createElement(oe.a,{open:t,onClose:a,closeAfterTransition:!0,BackdropComponent:ce.a,BackdropProps:{timeout:500}},o.a.createElement("div",{className:r.modal},n))},le=a(204),ue=Object(J.a)((function(e){return Object(q.a)({root:{color:e.palette.text.primary,backgroundColor:e.palette.primary.light,width:"400px",minWidth:"320px",borderRadius:"4px"},header:{backgroundColor:e.palette.primary.main,borderBottom:"1px solid ".concat(e.palette.text.disabled)},title:{padding:"12px 16px"},list:{padding:"12px 24px",lineHeight:"19px"},item:{display:"flex",justifyContent:"space-between",fontSize:"15px",marginTop:"12px"},itemTitle:{whiteSpace:"nowrap",display:"flex",alignItems:"center"},itemInfo:{minWidth:140,paddingLeft:"12px",backgroundColor:"transparent",border:"1px solid #aaa",borderRadius:"4px",textAlign:"left"}})})),me=function(){var e=Object(u.b)(),t=ue(),a=Object(u.c)((function(e){return e.settingState.menu}));function n(t){return function(a){e(t(a.target.value))}}return o.a.createElement("div",{className:t.root},o.a.createElement(le.a,null,o.a.createElement("header",{className:t.header},o.a.createElement($.a,{className:t.title,variant:"h6"},"Editor Settings"))),o.a.createElement("div",{className:t.list},o.a.createElement("div",{className:t.item},o.a.createElement("div",{className:t.itemTitle},"Theme"),o.a.createElement(ae.a,{className:t.itemInfo},o.a.createElement(ee.a,{value:a.codeTheme,onChange:n(F),disableUnderline:!0,displayEmpty:!0},Object.entries(M).map((function(e){var t=Object(Z.a)(e,2),a=t[0],n=t[1];return o.a.createElement(te.a,{value:n,key:n},a)}))))),o.a.createElement("div",{className:t.item},o.a.createElement("div",{className:t.itemTitle},"Key binding"),o.a.createElement(ae.a,{className:t.itemInfo},o.a.createElement(ee.a,{value:a.codeKeyMap,onChange:n(B),disableUnderline:!0,displayEmpty:!0},Object.entries(w).map((function(e){var t=Object(Z.a)(e,2),a=t[0],n=t[1];return o.a.createElement(te.a,{value:n,key:n},a)}))))),o.a.createElement("div",{className:t.item},o.a.createElement("div",{className:t.itemTitle},"Tab Size"),o.a.createElement(ae.a,{className:t.itemInfo},o.a.createElement(ee.a,{value:a.tabSize,onChange:n(W),disableUnderline:!0,displayEmpty:!0},Object.entries(T).map((function(e){var t=Object(Z.a)(e,2),a=t[0],n=t[1];return o.a.createElement(te.a,{value:n,key:a},"".concat(n," spaces"))})))))))},de=Object(J.a)((function(e){return Object(q.a)({root:{padding:"6px",position:"relative"},formControl:{minWidth:140,border:"1px solid ".concat(e.palette.grey[800]),borderRadius:"4px"},selectEmpty:{paddingLeft:"12px"},box:{display:"flex",justifyContent:"space-between"}})}));function pe(){var e=Object(u.b)(),t=de(),a=Object(u.c)((function(e){return e.settingState.menu})),n=Object(r.useState)(!1),c=Object(Z.a)(n,2),i=c[0],s=c[1];return o.a.createElement("div",{className:t.root},o.a.createElement(_.a,{container:!0,direction:"row",justify:"space-between",alignItems:"flex-end"},o.a.createElement(_.a,{item:!0},o.a.createElement(ae.a,{className:t.formControl},o.a.createElement(ee.a,{name:"codeMode",value:a.codeMode,onChange:function(t){e(A(t.target.value))},className:t.selectEmpty,disableUnderline:!0,displayEmpty:!0},Object.entries(S).map((function(e){var t=Object(Z.a)(e,2),a=t[0],n=t[1];return o.a.createElement(te.a,{value:n,key:n},a)}))))),o.a.createElement(_.a,{item:!0},o.a.createElement(re.a,{onClick:function(){return s(!0)}}))),o.a.createElement(se,{open:i,onClose:function(){return s(!1)}},o.a.createElement(me,null)))}var fe=a(84),he=a(208),ve=a(205),be=a(199),ge=a(85),ye=a.n(ge),Ee=a(86),je=a(87),xe=a(88),ke=a.n(xe),Oe=function(){function e(t,a){Object(Ee.a)(this,e),this.id=void 0,this.color=void 0,this.height=void 0,this.marker=void 0,this.lineMarker=void 0,this.nameRemoveTimeMap=void 0,this.nameAnimationDelay=void 0,this.nameAnimationDuration=void 0,this.nameRemoveTime=void 0,this.id=t,this.color=a,this.height=0,this.marker=null,this.lineMarker=null,this.nameRemoveTimeMap=new Map,this.nameAnimationDelay=1,this.nameAnimationDuration=.2,this.nameRemoveTime=1e3*(this.nameAnimationDuration+this.nameAnimationDelay)}return Object(je.a)(e,[{key:"updateCursor",value:function(e,t){this.removeCursor();var a=e.cursorCoords(t),n=document.createElement("span");this.height=a.bottom-a.top,n.classList.add("codePair-cursor"),n.style.borderLeftColor=this.color,n.style.height="".concat(this.height,"px"),this.marker=e.setBookmark(t,{widget:n,insertLeft:!0}),this.showCursorNameReserve(n)}},{key:"updateLine",value:function(e,t,a){this.removeLine(),this.lineMarker=e.getDoc().markText(t,a,{css:"background-color : ".concat(this.color,"; opacity:0.7")})}},{key:"showCursorNameReserve",value:function(e){var t=this,a=document.createElement("span");a.classList.add("codePair-name"),e.addEventListener("mouseenter",(function(){t.nameRemoveTimeMap.has(t.id)&&clearTimeout(t.nameRemoveTimeMap.get(t.id)),a.textContent=t.id,a.style.top="-".concat(t.height,"px"),a.style.backgroundColor=t.color,a.style.color=ke()(t.color,!0),a.classList.remove("text-remove"),e.appendChild(a)})),e.addEventListener("mouseleave",(function(){a.classList.add("text-remove"),a.style.animationDuration="".concat(t.nameAnimationDuration,"s"),a.style.animationDelay="".concat(t.nameAnimationDelay,"s"),t.removeNameReserve(a)}))}},{key:"removeNameReserve",value:function(e){var t=this,a=setTimeout((function(){e.parentNode.removeChild(e),t.nameRemoveTimeMap.delete(t.id)}),this.nameRemoveTime);this.nameRemoveTimeMap.set(this.id,a)}},{key:"removeCursor",value:function(){this.marker&&(this.marker.clear(),this.marker=null)}},{key:"removeLine",value:function(){this.lineMarker&&(this.lineMarker.clear(),this.lineMarker=null)}}]),e}(),Ce=(a(131),a(132),a(134),a(135),a(137),a(138),a(140),a(141),a(142),a(143),a(144),a(145),a(147),a(148),a(149),a(150),Object(J.a)((function(){return{root:{display:"flex",height:"calc(100vh - 110px)",alignItems:"center",justifyContent:"center"}}})));function Se(e){var t=Object(u.b)(),a=Ce(),c=e.docKey,i=Object(u.c)((function(e){return e.docState.doc})),s=Object(u.c)((function(e){return e.docState.client})),l=Object(u.c)((function(e){return e.docState.loading})),m=Object(u.c)((function(e){return e.docState.errorMessage})),d=Object(u.c)((function(e){return e.peerState.peers})),p=Object(u.c)((function(e){return e.settingState.menu})),f=Object(r.useRef)(new Map),h=function(e){var a,r=d[e];a=r&&r.status===n.Disconnected?r.color:ye()();var o=new Oe(e,a);f.current.set(e,o),t(R({id:e,color:a,status:n.Connected}))};return Object(r.useEffect)((function(){function e(){return(e=Object(y.a)(g.a.mark((function e(){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t(O(!0)),e.next=3,t(x(c));case 3:t(O(!1));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[c,t]),Object(r.useEffect)((function(){if(!s||!i)return function(){};var e=function(e){f.current.has(e)&&(f.current.get(e).removeCursor(),f.current.delete(e)),t(I(e))},a=s.subscribe((function(t){if("peers-changed"===t.name)for(var a=t.value[i.getKey().toIDString()],r=0,o=Object.keys(d);r<o.length;r++){var c=o[r];a[c]&&d[c].status===n.Connected||e(c)}}));return function(){a()}}),[s,i,d,t]),l?o.a.createElement(le.a,{className:a.root},o.a.createElement(be.a,{color:"inherit"})):m||null===s||null===i?o.a.createElement("div",{className:a.root},o.a.createElement(he.a,{open:!0,anchorOrigin:{vertical:"top",horizontal:"center"}},o.a.createElement(ve.a,{severity:"warning"},m||"fail to attach document"))):o.a.createElement(fe.UnControlled,{options:{mode:p.codeMode,theme:p.codeTheme,keyMap:p.codeKeyMap,tabSize:Number(p.tabSize),lineNumbers:!0,lineWrapping:!0,autoCloseTags:!0,autoCloseBrackets:!0},editorDidMount:function(e){e.focus();var t=function(t,a){f.current.get(t).updateCursor(e,a)};i.subscribe((function(a){"remote-change"===a.name&&a.value.forEach((function(a){var n=a.getID().actor;n!==s.getID()&&(f.current.has(n)||(h(n),t(n,e.posFromIndex(0))))}))}));var a=i.getRootObject();a.content.onChanges((function(a){a.forEach((function(a){var n=a.actor,r=a.from,o=a.to;if("content"===a.type){var c=a.content||"";if(n!==s.getID()){var i=e.posFromIndex(r),l=e.posFromIndex(o);e.replaceRange(c,i,l,"yorkie")}}else if("selection"===a.type&&n!==s.getID()){f.current.has(n)||h(n);var u=e.posFromIndex(r),m=e.posFromIndex(o);if(t(n,m),r>o){var d=[u,m];m=d[0],u=d[1]}!function(t,a,n){f.current.get(t).updateLine(e,a,n)}(n,u,m)}}))})),e.setSize("auto","calc(100vh - 110px)"),e.setValue(a.content.getValue())},onSelection:function(e,t){if(void 0!==t.origin){var a=e.indexFromPos(t.ranges[0].anchor),n=e.indexFromPos(t.ranges[0].head);i.update((function(e){e.content.updateSelection(a,n)}))}},onBeforeChange:function(e,t){if("yorkie"!==t.origin&&"setValue"!==t.origin){var a=e.indexFromPos(t.from),n=e.indexFromPos(t.to),r=t.text.join("\n");i.update((function(e){e.content.edit(a,n,r)}))}}})}var Me=Object(J.a)((function(){return Object(q.a)({root:{flexGrow:1}})}));function we(e){var t=Me(),a=e.match.params.docKey;return o.a.createElement("div",{className:t.root},o.a.createElement(X,null),o.a.createElement(pe,null),o.a.createElement(Se,{docKey:a}))}a(151);var Te=function(){var e=Object(m.a)("(prefers-color-scheme: dark)"),t=Object(r.useMemo)((function(){return Object(p.a)({palette:{type:e?"dark":"light"}})}),[e]);return o.a.createElement(u.a,{store:V},o.a.createElement(f.a,{theme:t},o.a.createElement(d.a,null),o.a.createElement(s.a,null,o.a.createElement(l.b,{path:"/",exact:!0,render:function(){return o.a.createElement(l.a,{to:"/".concat(Math.random().toString(36).substring(7))})}}),o.a.createElement(l.b,{path:"/:docKey",exact:!0,component:we}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(Te,null),document.querySelector("#root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[153,1,2]]]);
//# sourceMappingURL=main.db47b4d7.chunk.js.map