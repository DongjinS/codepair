{"version":3,"sources":["features/settingSlices.ts","utils/storage.ts","components/commons/Popover.tsx","features/peerSlices.ts","components/NavBar/PeerListItem.tsx","hooks/usePeer.ts","components/NavBar/PeerList.tsx","components/NavBar/PeerGroup.tsx","components/commons/Dialog.tsx","components/commons/Fade.tsx","features/docSlices.ts","components/NavBar/ShareButton.tsx","components/NavBar/NetworkButton.tsx","components/NavBar/index.tsx","components/Toolbar/Settings.tsx","components/Toolbar/index.tsx","components/Editor/CodeEditor/Cursor.ts","features/boardSlices.ts","components/Editor/CodeEditor/index.tsx","utils/eventDispatcher.ts","components/Editor/DrawingBoard/Canvas/CanvasWrapper.ts","components/Editor/DrawingBoard/Canvas/line.ts","components/Editor/DrawingBoard/Canvas/utils.ts","components/Editor/DrawingBoard/Canvas/rect.ts","components/Editor/DrawingBoard/Canvas/scheduler.ts","components/Editor/DrawingBoard/Canvas/Container.ts","components/Editor/DrawingBoard/Canvas/Worker/LineWorker.ts","components/Editor/DrawingBoard/Canvas/Worker/RectWorker.ts","components/Editor/DrawingBoard/Canvas/Worker/EraserWorker.ts","components/Editor/DrawingBoard/Canvas/Worker/SelectorWorker.ts","components/Editor/DrawingBoard/index.tsx","assets/icons/Eraser.tsx","assets/icons/Mouse.tsx","assets/icons/Rect.tsx","components/Editor/Sidebar/LineButton.tsx","components/Editor/Sidebar/index.tsx","components/Editor/Editor.tsx","components/Editor/index.tsx","pages/DocPage.tsx","app/App.tsx","app/rootReducer.ts","app/store.ts","serviceWorker.ts","index.tsx","components/Editor/DrawingBoard/Canvas/dom.ts"],"names":["Theme","CodeKeyMap","TabSize","BrowserStorage","key","storage","this","window","localStorage","initial","JSON","parse","value","stringify","SettingModel","initialState","getValue","menu","theme","Dark","codeKeyMap","Sublime","tabSize","Two","settingSlice","createSlice","name","reducers","setDarkMode","state","action","payload","Light","setValue","setCodeKeyMap","setTabSize","actions","Popover","anchorEl","onClose","children","anchorOrigin","transformOrigin","isOpen","Boolean","id","undefined","open","defaultProps","vertical","horizontal","ConnectionStatus","useStyles","makeStyles","root","props","color","peer","metadata","PeerListItem","classes","ListItem","className","username","peerSlice","peers","syncPeer","myClientID","changedPeers","Object","keys","clientID","status","Disconnected","entries","Connected","isMine","usePeer","client","useSelector","docState","peerState","activePeers","useMemo","values","filter","PeerList","List","Typography","length","map","group","cursor","myAvatar","borderColor","palette","secondary","main","PeerGroup","useState","setAnchorEl","handleViewList","useCallback","event","target","getAttribute","currentTarget","handleViewListClose","AvatarGroup","max","onClick","image","Tooltip","title","data-id","arrow","Avatar","alt","style","backgroundColor","src","anonymous","getImage","DialogTitle","withStyles","createStyles","margin","padding","spacing","closeButton","position","right","top","grey","other","disableTypography","variant","IconButton","aria-label","DialogContent","MuiDialogContent","DialogActions","MuiDialogActions","Dialog","maxWidth","Fade","timeout","show","onFadeout","timeoutId","useRef","useEffect","current","setTimeout","clearTimeout","in","CodeMode","DocStatus","mode","Markdown","loading","errorMessage","Connect","activateClient","createAsyncThunk","_","thunkApi","a","generate","animal","yorkie","createClient","process","randomColor","activate","rejectWithValue","message","attachDoc","doc","attach","update","content","createText","shapes","sync","docSlice","deactivateClient","deactivate","createDocument","detachDocument","detach","attachDocLoading","setCodeMode","setStatus","extraReducers","builder","addCase","fulfilled","rejected","dialog","borderRadius","input","width","fontSize","outline","ShareButton","setOpen","showCopyText","setShowCopyText","inputRef","copyUrl","location","href","split","onFocus","select","onCopy","openModal","closeModal","Button","size","startIcon","disabled","Disconnect","dividers","Box","my","DialogContentText","display","readOnly","ref","text","autoFocus","fontWeight","NetworkAlert","subTitle","px","py","p","pb","NetworkDisconnect","hasLocalChanges","handleOpen","handleClose","NetworkConnect","NetworkButton","flexGrow","appBar","grow","primary","marginRight","items","MenuAppBar","AppBar","Toolbar","memo","minWidth","header","borderBottom","list","lineHeight","item","justifyContent","marginTop","itemTitle","whiteSpace","alignItems","itemInfo","paddingLeft","textAlign","Settings","dispatch","useDispatch","settingState","handleChange","handleThemeChanged","checked","FormControl","Switch","onChange","Select","displayEmpty","MenuItem","formControl","border","selectEmpty","rightButtonControl","float","rightButton","codeMode","unsubscribe","subscribe","type","getRoot","handleCodeModeChange","handleSettingsClick","handleSettingsClose","disableUnderline","CursorStatus","Color","ToolType","Cursor","height","marker","lineMarker","nameRemoveTimeMap","nameAnimationDelay","nameAnimationDuration","nameRemoveTime","Deactivated","Map","cm","cursorPos","removeCursor","Activated","cursorCoords","cursorHolder","document","createElement","bottom","classList","add","borderLeftColor","setBookmark","widget","insertLeft","showCursorNameReserve","fromPos","toPos","removeLine","getDoc","markText","css","nameHolder","addEventListener","has","get","textContent","invert","remove","appendChild","animationDuration","animationDelay","removeNameReserve","parentNode","removeChild","delete","set","clear","CodeEditor","forwardedRef","cursorMapRef","connectCursor","disconnectCursor","options","keyMap","Number","lineNumbers","lineWrapping","autoCloseTags","autoCloseBrackets","editorDidMount","editor","focus","updateCursor","pos","actor","change","getID","getActorID","isActive","posFromIndex","onChanges","changes","forEach","from","to","replaceRange","updateLine","onSelection","data","origin","indexFromPos","ranges","anchor","head","onBeforeChange","join","edit","initialBoardState","Red","tool","None","boardSlice","toggleBoard","setTool","setColor","Event","callbacks","cb","push","idx","findIndex","callback","splice","EventDispatcher","events","args","on","off","CanvasWrapper","canvas","context","getContext","lineWidth","lineCap","setWidth","setHeight","devicePixelRatio","clearRect","getWidth","getHeight","setSize","scale","drawLine","line","save","beginPath","strokeStyle","isMoved","points","moveTo","x","y","lineTo","stroke","closePath","restore","fixEraserPoint","point","getSqDist","p1","p2","dx","dy","getSqSegDist","t","douglasPeuckerStep","first","last","tolerance","simplified","maxDist","index","i","dist","douglasPeucker","simplifyRadialDist","prevPoint","len","compressPoints","checkLineIntersection","point1Start","point1End","point2Start","point2End","b","result","onLine1","onLine2","denominator","numerator1","numerator2","cloneBox","box","isInnerBox","offsetY","offsetX","isSelectable","shape","drawRect","rect","strokeRect","work","tasks","doWork","requestTask","isDone","reserveTask","task","_work","flushTask","DragStatus","LineWorker","emit","Line","createID","timeTicket","createLine","lastShape","getLast","scheduler","getElementByID","deleteByID","RectWorker","Rect","createRect","rectPoint","aWidth","Math","abs","aHeight","adjustRectBox","EraserWorker","Eraser","createEraserLine","pointStart","pointEnd","findAndRemoveShape","point1","point2","SelectorWorker","Selector","selectedShape","findTarget","isEmptySelectedShape","Container","el","Black","dragStatus","Stop","lowerWrapper","upperWrapper","worker","createUpperWrapper","initialize","initializeSize","initializeOffset","bind","drawAll","onMouseUp","onMouseDown","onMouseMove","touchy","getCanvas","addEvent","removeEvent","destroyUpperCanvas","removeEventListener","getBoundingClientRect","resize","wrapper","upperCanvas","setMouseClass","Error","evt","originY","originX","TouchEvent","touches","clientY","clientX","scrollY","scrollX","Drag","getPointFromTouchyEvent","mousedown","isOutside","mousemove","mouseup","DrawingBoard","canvasRef","containerRef","boardState","container","handleMouseup","destroy","SvgIcon","version","viewBox","d","Mouse","xmlns","enableBackground","button","marginLeft","flexWrap","colorIcon","badge","LineButton","handleSelectTool","Badge","nextColor","_color","selected","flexDirection","divider","marginBottom","Sidebar","nextTool","Divider","NAVBAR_HEIGHT","codeEditor","zIndex","Editor","divRef","codeEditorRef","onClickEditor","onResize","aria-hidden","docKey","documentKey","getKey","attachDocAsync","Snackbar","Alert","severity","CircularProgress","DocPage","useLocation","match","params","ReactGA","page","pathname","pageview","NavBar","App","createMuiTheme","handleRender","random","toString","substring","ThemeProvider","CssBaseline","path","exact","render","component","rootReducer","combineReducers","docReducer","peerReducer","settingReducer","boardReducer","store","configureStore","reducer","middleware","getDefaultMiddleware","serializableCheck","ignoredActions","ignoredPaths","immutableCheck","hostname","Sentry","dsn","release","integrations","Integrations","BrowserTracing","tracesSampleRate","ReactDOM","querySelector","navigator","serviceWorker","ready","then","registration","unregister","catch","error","console","fn","capturing","touch","mouseout","pointers","microsoft","global","pointerEnabled","msPointerEnabled"],"mappings":"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","file":"static/js/main.fd42d510.chunk.js","sourcesContent":["import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport BrowserStorage from 'utils/storage';\n\nexport enum Theme {\n  Dark = 'dark',\n  Light = 'light',\n}\n\nexport enum CodeKeyMap {\n  Sublime = 'sublime',\n  Vim = 'vim',\n  Emacs = 'emacs',\n}\n\nexport enum TabSize {\n  Two = '2',\n  Four = '4',\n  Eight = '8',\n}\n\nexport type MenuKey = 'theme' | 'codeKeyMap' | 'tabSize';\n\nexport type Menu = {\n  [key in MenuKey]: string;\n};\n\nexport interface SettingState {\n  menu: Menu;\n}\n\nconst SettingModel = new BrowserStorage<SettingState>('$$codepair$$setting');\n\nconst initialState: SettingState = SettingModel.getValue({\n  menu: {\n    theme: Theme.Dark,\n    codeKeyMap: CodeKeyMap.Sublime,\n    tabSize: TabSize.Two,\n  },\n});\n\nconst settingSlice = createSlice({\n  name: 'setting',\n  initialState,\n  reducers: {\n    setDarkMode(state, action: PayloadAction<boolean>) {\n      state.menu.theme = action.payload ? Theme.Dark : Theme.Light;\n      SettingModel.setValue(state);\n    },\n\n    setCodeKeyMap(state, action: PayloadAction<CodeKeyMap>) {\n      state.menu.codeKeyMap = action.payload;\n      SettingModel.setValue(state);\n    },\n\n    setTabSize(state, action: PayloadAction<TabSize>) {\n      state.menu.tabSize = action.payload;\n      SettingModel.setValue(state);\n    },\n  },\n});\n\nexport const { setDarkMode, setCodeKeyMap, setTabSize } = settingSlice.actions;\nexport default settingSlice.reducer;\n","export default class BrowserStorage<T> {\n  key: string;\n\n  storage: Storage;\n\n  constructor(key: string) {\n    this.key = key;\n    this.storage = window.localStorage;\n  }\n\n  getValue(initial: T): T {\n    try {\n      return JSON.parse(this.storage[this.key]) as T;\n    } catch {\n      return initial;\n    }\n  }\n\n  setValue(value: T) {\n    this.storage[this.key] = JSON.stringify(value);\n  }\n}\n","import React, { ReactNode } from 'react';\nimport { Popover as MaterialPopover, PopoverOrigin } from '@material-ui/core';\n\ninterface PopoverProps {\n  anchorEl: Element | undefined;\n  onClose: (event: {}, reason: 'backdropClick' | 'escapeKeyDown') => void;\n  children: ReactNode;\n  anchorOrigin?: PopoverOrigin;\n  transformOrigin?: PopoverOrigin;\n}\n\n/**\n * @see https://material-ui.com/components/popover/#popover\n */\nexport default function Popover({ anchorEl, onClose, children, anchorOrigin, transformOrigin }: PopoverProps) {\n  const isOpen = Boolean(anchorEl);\n\n  return (\n    <MaterialPopover\n      id={isOpen ? 'simple-popover' : undefined}\n      open={isOpen}\n      anchorEl={anchorEl}\n      onClose={onClose}\n      anchorOrigin={anchorOrigin}\n      transformOrigin={transformOrigin}\n    >\n      {children}\n    </MaterialPopover>\n  );\n}\n\nPopover.defaultProps = {\n  anchorOrigin: {\n    vertical: 'bottom',\n    horizontal: 'center',\n  },\n  transformOrigin: {\n    vertical: 'top',\n    horizontal: 'center',\n  },\n};\n","import { ActorID } from 'yorkie-js-sdk';\nimport { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\nexport interface Metadata {\n  username: string;\n  color: string;\n  image: string; // Currently all anonymous images\n}\n\nexport enum ConnectionStatus {\n  Connected = 'connected',\n  Disconnected = 'disconnected',\n}\n\nexport interface Peer {\n  id: ActorID;\n  status: ConnectionStatus;\n  metadata: Metadata;\n  isMine: boolean;\n}\n\nexport interface PeerState {\n  peers: {\n    /** @type {Object.<ActorID, Peer>} */\n    [id: string]: Peer;\n  };\n}\n\nconst initialPeerState: PeerState = {\n  peers: {},\n};\n\nconst peerSlice = createSlice({\n  name: 'peer',\n  initialState: initialPeerState,\n  reducers: {\n    syncPeer(state, action: PayloadAction<any>) {\n      const { myClientID, changedPeers } = action.payload;\n      const { peers } = state;\n\n      for (const clientID of Object.keys(peers)) {\n        if (!changedPeers[clientID]) {\n          peers[clientID].status = ConnectionStatus.Disconnected;\n        }\n      }\n\n      for (const [clientID, metadata] of Object.entries(changedPeers)) {\n        if (!peers[clientID] || peers[clientID].status === ConnectionStatus.Disconnected) {\n          const peer = {\n            id: clientID,\n            status: ConnectionStatus.Connected,\n            metadata: metadata as Metadata,\n            isMine: myClientID === clientID,\n          };\n          state.peers[clientID] = peer;\n        }\n      }\n    },\n  },\n});\n\nexport const { syncPeer } = peerSlice.actions;\nexport default peerSlice.reducer;\n","import React from 'react';\nimport ListItem from '@material-ui/core/ListItem';\nimport { makeStyles } from '@material-ui/core/styles';\n\nimport { Peer } from 'features/peerSlices';\n\ninterface PeerListItemProps {\n  peer: Peer;\n}\n\nconst useStyles = makeStyles(() => ({\n  root: (props: PeerListItemProps) => ({\n    color: props.peer.metadata.color,\n  }),\n}));\n\nexport default function PeerListItem(props: PeerListItemProps) {\n  const classes = useStyles(props);\n  const { peer } = props;\n\n  return <ListItem className={classes.root}>{peer.metadata.username}</ListItem>;\n}\n","/* eslint-disable @typescript-eslint/indent */\n/* eslint-disable @typescript-eslint/no-unused-vars */\nimport { useMemo } from 'react';\nimport { useSelector } from 'react-redux';\n\nimport { AppState } from 'app/rootReducer';\nimport { ConnectionStatus } from 'features/peerSlices';\n\nexport default function usePeer() {\n  const client = useSelector((state: AppState) => state.docState.client);\n  const peers = useSelector((state: AppState) => state.peerState.peers);\n\n  const activePeers = useMemo(() => {\n    if (!client) {\n      return [];\n    }\n    return Object\n      .values(peers)\n      .filter((peer) => peer.status === ConnectionStatus.Connected);\n  }, [client, peers]);\n\n  return { activePeers };\n}\n","import React from 'react';\nimport Typography from '@material-ui/core/Typography';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\n\nimport PeerListItem from 'components/NavBar/PeerListItem';\nimport usePeer from 'hooks/usePeer';\n\nexport default function PeerList() {\n  const { activePeers } = usePeer();\n\n  return (\n    <List>\n      <ListItem>\n        <Typography>Total {activePeers.length}</Typography>\n      </ListItem>\n      {activePeers.map((peer) => {\n        return <PeerListItem key={peer.id} peer={peer} />;\n      })}\n    </List>\n  );\n}\n","import React, { useState, useCallback, MouseEvent } from 'react';\nimport { useSelector } from 'react-redux';\nimport Avatar from '@material-ui/core/Avatar';\nimport AvatarGroup from '@material-ui/lab/AvatarGroup';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport { makeStyles } from '@material-ui/core/styles';\nimport anonymous from 'anonymous-animals-gen';\n\nimport Popover from 'components/commons/Popover';\nimport PeerList from 'components/NavBar/PeerList';\nimport { AppState } from 'app/rootReducer';\nimport usePeer from 'hooks/usePeer';\n\nconst useStyles = makeStyles((theme) => ({\n  group: {\n    '& > *': {\n      cursor: 'pointer',\n    },\n  },\n  myAvatar: {\n    borderColor: theme.palette.secondary.main,\n  },\n}));\n\nconst MAX_PEER_VIEW = 4;\n\nexport default function PeerGroup() {\n  const classes = useStyles();\n  const client = useSelector((state: AppState) => state.docState.client);\n  const { activePeers } = usePeer();\n  const [anchorEl, setAnchorEl] = useState<Element | undefined>();\n\n  const handleViewList = useCallback(\n    (event: MouseEvent<Element>) => {\n      const target = event.target as HTMLTextAreaElement;\n      if (!target.getAttribute('data-id')) {\n        setAnchorEl(event.currentTarget);\n      }\n    },\n    [setAnchorEl],\n  );\n\n  const handleViewListClose = useCallback(() => {\n    setAnchorEl(undefined);\n  }, [setAnchorEl]);\n\n  if (!client) {\n    // NOTE: We use null as an exception to prevent component from rendering.\n    return null;\n  }\n\n  return (\n    <>\n      <AvatarGroup className={classes.group} max={MAX_PEER_VIEW} onClick={handleViewList}>\n        {activePeers.map((peer) => {\n          const { username, color, image } = peer.metadata;\n          return (\n            <Tooltip key={peer.id} title={peer.isMine ? `[ME] ${username}` : username} data-id={peer.id} arrow>\n              <Avatar\n                alt=\"Peer Image\"\n                className={peer.isMine ? classes.myAvatar : ''}\n                style={{ backgroundColor: color }}\n                src={anonymous.getImage(image)}\n              />\n            </Tooltip>\n          );\n        })}\n      </AvatarGroup>\n      <Popover anchorEl={anchorEl} onClose={handleViewListClose}>\n        <PeerList />\n      </Popover>\n    </>\n  );\n}\n","import React from 'react';\nimport { createStyles, Theme, withStyles, WithStyles } from '@material-ui/core/styles';\nimport MaterialDialog, { DialogProps as MaterialDialogProps } from '@material-ui/core/Dialog';\nimport MuiDialogTitle from '@material-ui/core/DialogTitle';\nimport MuiDialogContent from '@material-ui/core/DialogContent';\nimport MuiDialogActions from '@material-ui/core/DialogActions';\nimport IconButton from '@material-ui/core/IconButton';\nimport CloseIcon from '@material-ui/icons/Close';\nimport Typography from '@material-ui/core/Typography';\n\nexport { DialogContentText } from '@material-ui/core';\n\nconst styles = (theme: Theme) =>\n  createStyles({\n    root: {\n      margin: 0,\n      padding: theme.spacing(2),\n    },\n    closeButton: {\n      position: 'absolute',\n      right: theme.spacing(1),\n      top: theme.spacing(1),\n      color: theme.palette.grey[500],\n    },\n  });\n\ninterface DialogTitleProps extends WithStyles<typeof styles> {\n  children: React.ReactNode;\n  onClose?: () => void;\n}\n\nexport const DialogTitle = withStyles(styles)((props: DialogTitleProps) => {\n  const { children, classes, onClose, ...other } = props;\n  return (\n    <MuiDialogTitle disableTypography className={classes.root} {...other}>\n      <Typography variant=\"h6\">{children}</Typography>\n      {onClose ? (\n        <IconButton aria-label=\"close\" className={classes.closeButton} onClick={onClose}>\n          <CloseIcon />\n        </IconButton>\n      ) : null}\n    </MuiDialogTitle>\n  );\n});\n\nexport const DialogContent = withStyles((theme: Theme) => ({\n  root: {\n    padding: theme.spacing(2),\n  },\n}))(MuiDialogContent);\n\nexport const DialogActions = withStyles((theme: Theme) => ({\n  root: {\n    margin: 0,\n    padding: theme.spacing(1),\n  },\n}))(MuiDialogActions);\n\ninterface DialogProps extends MaterialDialogProps {\n  open: boolean;\n  onClose: () => void;\n  className?: string;\n  children: React.ReactNode;\n}\n\n/**\n * {@see https://material-ui.com/components/dialogs/#customized-dialogs}\n */\nfunction Dialog({ open, onClose, className, children }: DialogProps) {\n  if (!open) {\n    return null;\n  }\n\n  return (\n    <MaterialDialog onClose={onClose} open={open} maxWidth=\"md\">\n      <div className={className}>{children}</div>\n    </MaterialDialog>\n  );\n}\n\nDialog.defaultProps = {\n  className: '',\n};\n\nexport default Dialog;\n","import React, { useEffect, useRef, ReactNode } from 'react';\nimport MaterialFade from '@material-ui/core/Fade';\n\ninterface FadeProps {\n  timeout?: number;\n  show: boolean;\n  onFadeout: Function;\n  children: ReactNode;\n}\n\nfunction Fade({ timeout, show, onFadeout, children }: FadeProps) {\n  const timeoutId = useRef<number | null>(null);\n\n  useEffect(() => {\n    if (show) {\n      timeoutId.current = window.setTimeout(() => {\n        onFadeout();\n        timeoutId.current = null;\n      }, timeout);\n    }\n\n    return () => {\n      if (timeoutId.current) {\n        clearTimeout(timeoutId.current);\n      }\n    };\n  }, [show]);\n\n  return (\n    <MaterialFade in={show}>\n      <div>{show ? children : null}</div>\n    </MaterialFade>\n  );\n}\n\nFade.defaultProps = {\n  timeout: 1000,\n};\n\nexport default Fade;\n","import { createSlice, PayloadAction, createAsyncThunk } from '@reduxjs/toolkit';\nimport yorkie, { Client, DocumentReplica, PlainText, TimeTicket } from 'yorkie-js-sdk';\nimport anonymous from 'anonymous-animals-gen';\nimport randomColor from 'randomcolor';\n\nexport enum CodeMode {\n  Markdown = 'gfm',\n  Go = 'go',\n  JavaScript = 'javascript',\n  Clojure = 'clojure',\n  Dart = 'dart',\n  Python = 'python',\n  Ruby = 'ruby',\n  Rust = 'rust',\n}\n\nexport type Point = {\n  y: number;\n  x: number;\n};\n\nexport interface Box {\n  y: number;\n  x: number;\n  width: number;\n  height: number;\n}\n\n// TODO(ppeeou): refer to yorkie-sdk-js ArrayProxy\nexport interface BaseShape {\n  type: string;\n  getID(): TimeTicket;\n}\n\nexport interface Line extends BaseShape {\n  type: 'line';\n  color: string;\n  points: Array<Point>;\n}\n\nexport interface EraserLine extends BaseShape {\n  type: 'eraser';\n  points: Array<Point>;\n}\n\nexport interface Rect extends BaseShape {\n  type: 'rect';\n  points: Array<Point>;\n  box: Box;\n}\n\nexport type Shape = Line | EraserLine | Rect;\n\nexport type CodePairDoc = {\n  mode: CodeMode;\n  content: PlainText;\n  shapes: Array<Shape>;\n};\n\n// TODO(ppeeou): refer to yorkie-sdk-js ArrayProxy\nexport interface Shapes {\n  push(shape: Shape): number;\n\n  getLast(): Shape;\n  getElementByID(createdAt: TimeTicket): Shape;\n  deleteByID(createdAt: TimeTicket): Shape;\n  length: number;\n  [index: number]: Shape;\n  [Symbol.iterator](): IterableIterator<Shape>;\n}\n\n//  TODO(ppeeou) refer to yorkie-sdk-js JSONObject\nexport interface Root {\n  shapes: Shapes;\n}\n\nexport enum DocStatus {\n  Disconnect = 'disconnect',\n  Connect = 'connect',\n}\n\nexport interface DocState {\n  client?: Client;\n  doc?: DocumentReplica<CodePairDoc>;\n  mode: CodeMode;\n  loading: boolean;\n  errorMessage: string;\n  status: DocStatus;\n}\n\nconst initialState: DocState = {\n  mode: CodeMode.Markdown,\n  loading: true,\n  errorMessage: '',\n  status: DocStatus.Connect,\n};\n\nexport const activateClient = createAsyncThunk<ActivateClientResult, undefined, { rejectValue: string }>(\n  'doc/activate',\n  async (_: undefined, thunkApi) => {\n    try {\n      const { name, animal } = anonymous.generate();\n      const client = yorkie.createClient(`${process.env.REACT_APP_YORKIE_RPC_ADDR}`, {\n        metadata: {\n          username: name,\n          image: animal,\n          color: randomColor(),\n        },\n      });\n\n      await client.activate();\n      return { client };\n    } catch (err) {\n      return thunkApi.rejectWithValue(err.message);\n    }\n  },\n);\n\nexport const attachDoc = createAsyncThunk<AttachDocResult, AttachDocArgs, { rejectValue: string }>(\n  'doc/attach',\n  async ({ client, doc }, thunkApi) => {\n    try {\n      await client.attach(doc);\n\n      doc.update((root) => {\n        // codeEditor\n        if (!root.content) {\n          root.createText('content');\n        }\n        // board\n        if (!root.shapes) {\n          root.shapes = [];\n        }\n      });\n      await client.sync();\n      return { doc, client };\n    } catch (err) {\n      return thunkApi.rejectWithValue(err.message);\n    }\n  },\n);\n\nconst docSlice = createSlice({\n  name: 'doc',\n  initialState,\n  reducers: {\n    deactivateClient(state) {\n      const { client } = state;\n      state.client = undefined;\n      client?.deactivate();\n    },\n    createDocument(state, action: PayloadAction<string>) {\n      state.doc = yorkie.createDocument<CodePairDoc>('codepairs', action.payload);\n    },\n    detachDocument(state) {\n      const { doc, client } = state;\n      state.doc = undefined;\n      client?.detach(doc as DocumentReplica<CodePairDoc>);\n    },\n    attachDocLoading(state, action: PayloadAction<boolean>) {\n      state.loading = action.payload;\n    },\n    setCodeMode(state, action: PayloadAction<CodeMode>) {\n      state.mode = action.payload;\n    },\n    setStatus(state, action: PayloadAction<DocStatus>) {\n      state.status = action.payload;\n    },\n  },\n  extraReducers: (builder) => {\n    builder.addCase(activateClient.fulfilled, (state, { payload }) => {\n      state.client = payload.client;\n    });\n    builder.addCase(activateClient.rejected, (state, { payload }) => {\n      state.errorMessage = payload!;\n    });\n    builder.addCase(attachDoc.fulfilled, (state, { payload }) => {\n      state.doc = payload.doc;\n      state.client = payload.client;\n    });\n    builder.addCase(attachDoc.rejected, (state, { payload }) => {\n      state.errorMessage = payload!;\n    });\n  },\n});\n\nexport const {\n  deactivateClient,\n  createDocument,\n  detachDocument,\n  attachDocLoading,\n  setCodeMode,\n  setStatus,\n} = docSlice.actions;\nexport default docSlice.reducer;\n\ntype ActivateClientResult = { client: Client };\ntype AttachDocArgs = { doc: DocumentReplica<CodePairDoc>; client: Client };\ntype AttachDocResult = { doc: DocumentReplica<CodePairDoc>; client: Client };\n","import React, { useState, useCallback, useRef } from 'react';\nimport { useSelector } from 'react-redux';\nimport { CopyToClipboard } from 'react-copy-to-clipboard';\n\nimport Typography from '@material-ui/core/Typography';\nimport Box from '@material-ui/core/Box';\nimport Button from '@material-ui/core/Button';\nimport IconButton from '@material-ui/core/IconButton';\nimport GroupIcon from '@material-ui/icons/Group';\nimport FileCopyIcon from '@material-ui/icons/FileCopy';\nimport { makeStyles } from '@material-ui/core/styles';\n\nimport Dialog, { DialogTitle, DialogContent, DialogActions, DialogContentText } from 'components/commons/Dialog';\nimport Fade from 'components/commons/Fade';\nimport { AppState } from 'app/rootReducer';\nimport { DocStatus } from 'features/docSlices';\n\nconst useStyles = makeStyles(() => ({\n  dialog: {\n    borderRadius: '4px',\n  },\n  input: {\n    width: '300px',\n    padding: '12px 8px',\n    fontSize: '18px',\n    borderRadius: '5px',\n    outline: 'none',\n    backgroundColor: 'hsla(0,0%,100%,0.9)',\n  },\n}));\n\nexport default function ShareButton() {\n  const classes = useStyles();\n  const status = useSelector((state: AppState) => state.docState.status);\n  const [open, setOpen] = useState(false);\n  const [showCopyText, setShowCopyText] = useState(false);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const copyUrl = window.location.href.split('?')[0];\n\n  const onFocus = useCallback(() => {\n    inputRef.current?.select();\n  }, []);\n\n  const onCopy = useCallback(() => {\n    setShowCopyText(true);\n  }, []);\n\n  const openModal = useCallback(() => {\n    setOpen(true);\n  }, []);\n\n  const closeModal = useCallback(() => {\n    setOpen(false);\n  }, []);\n\n  return (\n    <>\n      <Button\n        size=\"small\"\n        color=\"primary\"\n        variant=\"contained\"\n        startIcon={<GroupIcon />}\n        onClick={openModal}\n        disabled={status === DocStatus.Disconnect}\n      >\n        Share\n      </Button>\n      <Dialog open={open} onClose={closeModal} className={classes.dialog}>\n        <DialogTitle onClose={closeModal}>Share Code</DialogTitle>\n        <DialogContent dividers>\n          <Box my={3}>\n            <Typography>Anyone can access the code in real time through this URL.</Typography>\n          </Box>\n          <Box my={1}>\n            <DialogContentText>Share this URL</DialogContentText>\n          </Box>\n          <Box display=\"flex\">\n            <input readOnly ref={inputRef} className={classes.input} value={copyUrl} onFocus={onFocus} />\n            <CopyToClipboard text={copyUrl} onCopy={onCopy}>\n              <IconButton color=\"primary\">\n                <FileCopyIcon />\n              </IconButton>\n            </CopyToClipboard>\n            <Fade show={showCopyText} onFadeout={() => setShowCopyText(false)}>\n              <p>Copy!</p>\n            </Fade>\n          </Box>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={closeModal} color=\"primary\" variant=\"contained\" autoFocus>\n            Close\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n}\n","import React, { useState, useCallback, MouseEvent } from 'react';\nimport { useSelector } from 'react-redux';\nimport Box from '@material-ui/core/Box';\nimport Button from '@material-ui/core/Button';\nimport Typography from '@material-ui/core/Typography';\nimport CloudDoneIcon from '@material-ui/icons/CloudDone';\nimport CloudOffIcon from '@material-ui/icons/CloudOff';\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\n\nimport Popover from 'components/commons/Popover';\nimport { AppState } from 'app/rootReducer';\nimport { DocStatus } from 'features/docSlices';\n\ninterface NetworkAlertProps {\n  title: string;\n  subTitle: string;\n  content: string;\n}\n\nconst useStyles = makeStyles(() =>\n  createStyles({\n    root: {\n      width: '380px',\n    },\n    title: {\n      backgroundColor: 'hsla(0,0%,100%,0.1)',\n      '& > *': {\n        fontWeight: 'bold',\n      },\n    },\n  }),\n);\n\nfunction NetworkAlert({ title, subTitle, content }: NetworkAlertProps) {\n  const classes = useStyles();\n\n  return (\n    <div className={classes.root}>\n      <Box px={2} py={1.5} className={classes.title}>\n        <Typography variant=\"subtitle1\">{title}</Typography>\n      </Box>\n      <Box px={2} p={1}>\n        <Box py={1}>\n          <Typography variant=\"body1\">{subTitle}</Typography>\n        </Box>\n\n        <Box pb={2.5}>\n          <Typography variant=\"body2\">{content}</Typography>\n        </Box>\n      </Box>\n    </div>\n  );\n}\n\nfunction NetworkDisconnect(props: { hasLocalChanges: boolean }) {\n  const [anchorEl, setAnchorEl] = useState<HTMLButtonElement | undefined>();\n  const { hasLocalChanges } = props;\n  const handleOpen = useCallback((event: MouseEvent<HTMLButtonElement>) => {\n    setAnchorEl(event.currentTarget);\n  }, []);\n\n  const handleClose = useCallback(() => {\n    setAnchorEl(undefined);\n  }, []);\n\n  return (\n    <>\n      <Button aria-label=\"doc-status\" color=\"secondary\" startIcon={<CloudOffIcon />} onClick={handleOpen}>\n        Working offline\n      </Button>\n\n      <Popover\n        anchorEl={anchorEl}\n        onClose={handleClose}\n        anchorOrigin={{\n          vertical: 'bottom',\n          horizontal: 'left',\n        }}\n        transformOrigin={{\n          vertical: 'top',\n          horizontal: 'left',\n        }}\n      >\n        <NetworkAlert\n          title={hasLocalChanges ? \"There are changes that couldn't be sent to Server\" : 'All Changes saved to Server'}\n          subTitle=\"This document is ready for offline use\"\n          content=\"Looks like you're offline. Changes will save to this memory now, and save to Server once reconnected.\"\n        />\n      </Popover>\n    </>\n  );\n}\n\nfunction NetworkConnect() {\n  const [anchorEl, setAnchorEl] = useState<HTMLButtonElement | undefined>();\n  const handleOpen = useCallback((event: MouseEvent<HTMLButtonElement>) => {\n    setAnchorEl(event.currentTarget);\n  }, []);\n\n  const handleClose = useCallback(() => {\n    setAnchorEl(undefined);\n  }, []);\n\n  return (\n    <>\n      <Button aria-label=\"doc-status\" color=\"secondary\" onClick={handleOpen}>\n        <CloudDoneIcon />\n      </Button>\n\n      <Popover\n        anchorEl={anchorEl}\n        onClose={handleClose}\n        anchorOrigin={{\n          vertical: 'bottom',\n          horizontal: 'left',\n        }}\n        transformOrigin={{\n          vertical: 'top',\n          horizontal: 'left',\n        }}\n      >\n        <NetworkAlert\n          title=\"All Changes saved to Server\"\n          subTitle=\"This document is ready for offline use\"\n          content=\"You can edit this document without an internet connection. Changes will save to Server once reconnected.\"\n        />\n      </Popover>\n    </>\n  );\n}\n\nexport default function NetworkButton() {\n  const status = useSelector((state: AppState) => state.docState.status);\n  const hasLocalChanges = useSelector((state: AppState) => {\n    return state.docState.doc ? state.docState.doc.hasLocalChanges() : false;\n  });\n\n  if (status === DocStatus.Connect) {\n    return <NetworkConnect />;\n  }\n  return <NetworkDisconnect hasLocalChanges={hasLocalChanges} />;\n}\n","import React, { memo } from 'react';\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\nimport AppBar from '@material-ui/core/AppBar';\nimport Toolbar from '@material-ui/core/Toolbar';\nimport Typography from '@material-ui/core/Typography';\nimport PeerGroup from 'components/NavBar/PeerGroup';\nimport ShareButton from 'components/NavBar/ShareButton';\nimport NetworkButton from 'components/NavBar/NetworkButton';\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      flexGrow: 1,\n    },\n    appBar: {\n      backgroundColor: 'black',\n    },\n    grow: {\n      flexGrow: 1,\n    },\n    title: {\n      fontWeight: 'bold',\n      color: theme.palette.primary.main,\n      marginRight: theme.spacing(1),\n    },\n    items: {\n      display: 'flex',\n      '& > *': {\n        margin: theme.spacing(1),\n      },\n    },\n  }),\n);\n\nfunction MenuAppBar() {\n  const classes = useStyles();\n\n  return (\n    <div className={classes.root}>\n      <AppBar position=\"static\" className={classes.appBar}>\n        <Toolbar>\n          <Typography variant=\"h6\" className={classes.title}>\n            CodePair\n          </Typography>\n          <NetworkButton />\n          <div className={classes.grow} />\n          <div className={classes.items}>\n            <ShareButton />\n            <PeerGroup />\n          </div>\n        </Toolbar>\n      </AppBar>\n    </div>\n  );\n}\n\nexport default memo(MenuAppBar);\n","import React, { useCallback } from 'react';\nimport { ActionCreatorWithPayload } from '@reduxjs/toolkit';\nimport { useSelector, useDispatch } from 'react-redux';\nimport Box from '@material-ui/core/Box';\nimport Switch from '@material-ui/core/Switch';\nimport Select from '@material-ui/core/Select';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport Typography from '@material-ui/core/Typography';\nimport FormControl from '@material-ui/core/FormControl';\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\n\nimport { Theme, CodeKeyMap, TabSize, setDarkMode, setCodeKeyMap, setTabSize } from 'features/settingSlices';\nimport { AppState } from 'app/rootReducer';\n\nconst useStyles = makeStyles((theme) =>\n  createStyles({\n    root: {\n      minWidth: '320px',\n      borderRadius: '4px',\n    },\n    header: {\n      borderBottom: `1px solid ${theme.palette.text.disabled}`,\n    },\n    title: {\n      padding: '12px 16px',\n    },\n    list: {\n      padding: '8px 18px 18px 18px',\n      lineHeight: '19px',\n    },\n    item: {\n      display: 'flex',\n      justifyContent: 'space-between',\n      fontSize: '15px',\n      marginTop: '12px',\n    },\n    itemTitle: {\n      whiteSpace: 'nowrap',\n      display: 'flex',\n      alignItems: 'center',\n    },\n    itemInfo: {\n      minWidth: 140,\n      paddingLeft: '12px',\n      borderRadius: '4px',\n      textAlign: 'left',\n    },\n  }),\n);\n\nconst Settings = () => {\n  const dispatch = useDispatch();\n  const classes = useStyles();\n  const menu = useSelector((state: AppState) => state.settingState.menu);\n\n  function handleChange<T>(action: ActionCreatorWithPayload<T>) {\n    return (event: React.ChangeEvent<{ name?: string; value: unknown }>) => {\n      dispatch(action(event.target.value as T));\n    };\n  }\n\n  const handleThemeChanged = useCallback((input, checked) => {\n    dispatch(setDarkMode(checked));\n  }, [dispatch, setDarkMode]);\n\n  return (\n    <div className={classes.root}>\n      <Box>\n        <header className={classes.header}>\n          <Typography className={classes.title} variant=\"h6\">\n            Settings\n          </Typography>\n        </header>\n      </Box>\n      <div className={classes.list}>\n        <div className={classes.item}>\n          <div className={classes.itemTitle}>Dark Mode</div>\n          <FormControl className={classes.itemInfo}>\n            <Switch checked={menu.theme === Theme.Dark} onChange={handleThemeChanged} />\n          </FormControl>\n        </div>\n        <div className={classes.item}>\n          <div className={classes.itemTitle}>Key Binding</div>\n          <FormControl className={classes.itemInfo}>\n            <Select value={menu.codeKeyMap} onChange={handleChange(setCodeKeyMap)} displayEmpty>\n              {Object.entries(CodeKeyMap).map(([display, codeKeyMap]: [string, string]) => {\n                return (\n                  <MenuItem value={codeKeyMap} key={codeKeyMap}>\n                    {display}\n                  </MenuItem>\n                );\n              })}\n            </Select>\n          </FormControl>\n        </div>\n        <div className={classes.item}>\n          <div className={classes.itemTitle}>Tab Size</div>\n          <FormControl className={classes.itemInfo}>\n            <Select value={menu.tabSize} onChange={handleChange(setTabSize)} displayEmpty>\n              {Object.entries(TabSize).map(([key, tabSize]: [string, string]) => {\n                return (\n                  <MenuItem value={tabSize} key={key}>\n                    {`${tabSize} spaces`}\n                  </MenuItem>\n                );\n              })}\n            </Select>\n          </FormControl>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Settings;\n","import React, { useState, useEffect, useCallback, MouseEvent, ChangeEvent } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { DocEvent } from 'yorkie-js-sdk';\n\nimport Select from '@material-ui/core/Select';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport FormControl from '@material-ui/core/FormControl';\nimport IconButton from '@material-ui/core/IconButton';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport SettingsIcon from '@material-ui/icons/Settings';\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\n\nimport Popover from 'components/commons/Popover';\nimport Settings from 'components/Toolbar/Settings';\n\nimport { AppState } from 'app/rootReducer';\nimport { CodeMode, setCodeMode } from 'features/docSlices';\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      padding: '6px',\n      position: 'relative',\n    },\n    formControl: {\n      minWidth: 140,\n      border: `1px solid ${theme.palette.grey['800']}`,\n      borderRadius: '4px',\n    },\n    selectEmpty: {\n      paddingLeft: '12px',\n    },\n    rightButtonControl: {\n      float: 'right',\n    },\n    rightButton: {\n      padding: '7px',\n    },\n  }),\n);\n\nexport default function Toolbar() {\n  const classes = useStyles();\n  const dispatch = useDispatch();\n\n  const doc = useSelector((state: AppState) => state.docState.doc);\n  const codeMode = useSelector((state: AppState) => state.docState.mode);\n  const [anchorEl, setAnchorEl] = useState<HTMLButtonElement | undefined>();\n\n  useEffect(() => {\n    if (!doc) {\n      return () => {};\n    }\n\n    const unsubscribe = doc.subscribe((event: DocEvent) => {\n      if (event.type === 'remote-change') {\n        dispatch(setCodeMode(doc.getRoot().mode || CodeMode.Markdown));\n      }\n    });\n\n    return () => {\n      unsubscribe();\n    };\n  }, [doc]);\n\n  const handleCodeModeChange = useCallback(\n    (event: ChangeEvent<{ name?: string; value: unknown }>) => {\n      if (!doc) {\n        return;\n      }\n      const mode = event.target.value as CodeMode;\n      doc.update((root) => {\n        // eslint-disable-next-line no-param-reassign\n        root.mode = mode;\n      });\n\n      dispatch(setCodeMode(mode));\n    },\n    [doc, dispatch],\n  );\n\n  const handleSettingsClick = useCallback((event: MouseEvent<HTMLButtonElement>) => {\n    setAnchorEl(event.currentTarget);\n  }, []);\n\n  const handleSettingsClose = useCallback(() => {\n    setAnchorEl(undefined);\n  }, []);\n\n  return (\n    <div className={classes.root}>\n      <FormControl className={classes.formControl}>\n        <Tooltip title=\"Syntax\" arrow>\n          <Select\n            name=\"codeMode\"\n            value={codeMode}\n            onChange={handleCodeModeChange}\n            className={classes.selectEmpty}\n            disableUnderline\n            displayEmpty\n          >\n            {Object.entries(CodeMode).map(([display, mode]: [string, string]) => {\n              return (\n                <MenuItem value={mode} key={mode}>\n                  {display}\n                </MenuItem>\n              );\n            })}\n          </Select>\n        </Tooltip>\n      </FormControl>\n\n      <div className={classes.rightButtonControl}>\n        <Tooltip className={classes.rightButton} title=\"Settings\" arrow>\n          <IconButton aria-label=\"settings\" onClick={handleSettingsClick}>\n            <SettingsIcon fontSize=\"small\" />\n          </IconButton>\n        </Tooltip>\n      </div>\n\n      <Popover anchorEl={anchorEl} onClose={handleSettingsClose}>\n        <Settings />\n      </Popover>\n    </div>\n  );\n}\n","import { ActorID } from 'yorkie-js-sdk';\nimport invert from 'invert-color';\nimport { Metadata } from 'features/peerSlices';\n\nenum CursorStatus {\n  Deactivated = 'deactivated',\n  Activated = 'activated',\n}\n\n// REF https://github.com/FujitsuLaboratories/cattaz/blob/master/src/AppEnabledWikiEditorCodeMirror.jsx#L24\nexport default class Cursor {\n  private id: ActorID;\n\n  private username: string;\n\n  private color: string;\n\n  private height: number;\n\n  private marker?: CodeMirror.TextMarker;\n\n  private lineMarker?: CodeMirror.TextMarker;\n\n  private status: CursorStatus;\n\n  private nameRemoveTimeMap: Map<ActorID, ReturnType<typeof setTimeout>>;\n\n  private nameAnimationDelay: number;\n\n  private nameAnimationDuration: number;\n\n  private nameRemoveTime: number;\n\n  constructor(id: ActorID, metadata: Metadata) {\n    this.id = id;\n    this.username = metadata.username;\n    this.color = metadata.color;\n    this.height = 0;\n    this.status = CursorStatus.Deactivated;\n\n    this.nameRemoveTimeMap = new Map();\n    this.nameAnimationDelay = 1;\n    this.nameAnimationDuration = 0.2;\n    this.nameRemoveTime = (this.nameAnimationDuration + this.nameAnimationDelay) * 1000;\n  }\n\n  updateCursor(cm: CodeMirror.Editor, cursorPos: CodeMirror.Position) {\n    this.removeCursor();\n    this.status = CursorStatus.Activated;\n    const cursorCoords = cm.cursorCoords(cursorPos);\n    const cursorHolder = document.createElement('span');\n    this.height = cursorCoords.bottom - cursorCoords.top;\n\n    cursorHolder.classList.add('codePair-cursor');\n    cursorHolder.style.borderLeftColor = this.color;\n    cursorHolder.style.height = `${this.height}px`;\n\n    this.marker = cm.setBookmark(cursorPos, {\n      widget: cursorHolder,\n      insertLeft: true,\n    });\n\n    this.showCursorNameReserve(cursorHolder);\n  }\n\n  updateLine(cm: CodeMirror.Editor, fromPos: CodeMirror.Position, toPos: CodeMirror.Position) {\n    this.removeLine();\n    this.status = CursorStatus.Activated;\n\n    this.lineMarker = cm.getDoc().markText(fromPos, toPos, {\n      css: `background-color : ${this.color}; opacity:0.7`,\n    });\n  }\n\n  // when user's cursor hover, show name\n  private showCursorNameReserve(cursorHolder: Element) {\n    const nameHolder = document.createElement('span');\n    nameHolder.classList.add('codePair-name');\n\n    cursorHolder.addEventListener('mouseenter', () => {\n      if (this.nameRemoveTimeMap.has(this.id)) {\n        clearTimeout(this.nameRemoveTimeMap.get(this.id)!);\n      }\n\n      nameHolder.textContent = this.username;\n      nameHolder.style.top = `-${this.height}px`;\n      nameHolder.style.backgroundColor = this.color;\n      nameHolder.style.color = invert(this.color, true);\n\n      /**\n       * nameEl is being reused.\n       * In order to keep the name visible while the mouse is hovering,\n       * It need to delete the css class containing animation when it is mouseenter and add it when it is mouseleave.\n       */\n      nameHolder.classList.remove('text-remove');\n      cursorHolder.appendChild(nameHolder);\n    });\n\n    cursorHolder.addEventListener('mouseleave', () => {\n      nameHolder.classList.add('text-remove');\n      nameHolder.style.animationDuration = `${this.nameAnimationDuration}s`;\n      nameHolder.style.animationDelay = `${this.nameAnimationDelay}s`;\n\n      this.removeNameReserve(nameHolder);\n    });\n  }\n\n  // After animate, It should actually be deleted it.\n  private removeNameReserve(nameHolder: HTMLSpanElement) {\n    const timeoutId = setTimeout(() => {\n      nameHolder.parentNode!.removeChild(nameHolder);\n      this.nameRemoveTimeMap.delete(this.id);\n    }, this.nameRemoveTime);\n\n    this.nameRemoveTimeMap.set(this.id, timeoutId);\n  }\n\n  removeCursor() {\n    if (this.marker) {\n      this.marker.clear();\n      this.marker = undefined;\n    }\n  }\n\n  removeLine() {\n    if (this.lineMarker) {\n      this.lineMarker.clear();\n      this.lineMarker = undefined;\n    }\n  }\n\n  clear() {\n    this.removeCursor();\n    this.removeLine();\n  }\n\n  isActive() {\n    return this.status === CursorStatus.Activated;\n  }\n}\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\nexport enum Color {\n  Red = '#d8453c',\n  Blue = '#19abbf',\n  Green = '#699e3d',\n  White = '#cccccc',\n  Yellow = '#f3b328',\n  Black = '#444',\n}\n\nexport enum ToolType {\n  None,\n  Line,\n  Eraser,\n  Rect,\n  Selector,\n}\n\nexport interface BoardState {\n  isOpen: boolean;\n\n  color: Color;\n  tool: ToolType;\n}\n\nconst initialBoardState: BoardState = {\n  isOpen: false,\n\n  color: Color.Red,\n  tool: ToolType.None,\n};\n\nconst boardSlice = createSlice({\n  name: 'board',\n  initialState: initialBoardState,\n\n  reducers: {\n    toggleBoard(state) {\n      state.isOpen = !state.isOpen;\n    },\n\n    setTool(state, action: PayloadAction<ToolType>) {\n      state.tool = action.payload;\n    },\n\n    setColor(state, action: PayloadAction<Color>) {\n      state.color = action.payload;\n    },\n  },\n});\n\nexport const { toggleBoard, setTool, setColor } = boardSlice.actions;\nexport default boardSlice.reducer;\n","import React, { useEffect, useRef, useCallback } from 'react';\nimport { useSelector } from 'react-redux';\nimport { ActorID, DocEvent } from 'yorkie-js-sdk';\nimport { UnControlled as CodeMirror } from 'react-codemirror2';\n\nimport { AppState } from 'app/rootReducer';\nimport { ConnectionStatus, Metadata } from 'features/peerSlices';\nimport { Theme } from 'features/settingSlices';\n\nimport Cursor from './Cursor';\n\nimport 'codemirror/addon/edit/closebrackets';\nimport 'codemirror/addon/edit/closetag';\nimport 'codemirror/addon/comment/comment';\n\nimport 'codemirror/mode/gfm/gfm';\nimport 'codemirror/mode/go/go';\nimport 'codemirror/mode/dart/dart';\nimport 'codemirror/mode/ruby/ruby';\nimport 'codemirror/mode/rust/rust';\nimport 'codemirror/mode/python/python';\nimport 'codemirror/mode/clojure/clojure';\nimport 'codemirror/mode/javascript/javascript';\n\nimport 'codemirror/keymap/sublime';\nimport 'codemirror/keymap/emacs';\nimport 'codemirror/keymap/vim';\n\nimport 'codemirror/lib/codemirror.css';\nimport 'codemirror/theme/monokai.css';\nimport 'codemirror/theme/xq-light.css';\nimport './index.css';\n\ninterface CodeEditorProps {\n  forwardedRef: React.MutableRefObject<CodeMirror.Editor | null>;\n}\n\nexport default function CodeEditor({ forwardedRef }: CodeEditorProps) {\n  const doc = useSelector((state: AppState) => state.docState.doc);\n  const codeMode = useSelector((state: AppState) => state.docState.mode);\n  const client = useSelector((state: AppState) => state.docState.client);\n  const peers = useSelector((state: AppState) => state.peerState.peers);\n  const menu = useSelector((state: AppState) => state.settingState.menu);\n  const cursorMapRef = useRef<Map<ActorID, Cursor>>(new Map());\n\n  const connectCursor = useCallback((clientID: ActorID, metadata: Metadata) => {\n    cursorMapRef.current.set(clientID, new Cursor(clientID, metadata));\n  }, []);\n\n  const disconnectCursor = useCallback((clientID: ActorID) => {\n    if (cursorMapRef.current.has(clientID)) {\n      cursorMapRef.current.get(clientID)!.clear();\n      cursorMapRef.current.delete(clientID);\n    }\n  }, []);\n\n  useEffect(() => {\n    for (const [id, peer] of Object.entries(peers)) {\n      if (cursorMapRef.current.has(id) && peer.status === ConnectionStatus.Disconnected) {\n        disconnectCursor(id);\n      } else if (!cursorMapRef.current.has(id) && peer.status === ConnectionStatus.Connected) {\n        connectCursor(id, peer.metadata);\n      }\n    }\n  }, [peers]);\n\n  if (!client || !doc) {\n    return null;\n  }\n\n  return (\n    <CodeMirror\n      className=\"CodeMirror\"\n      options={{\n        mode: codeMode,\n        theme: menu.theme === Theme.Dark ? 'monokai' : 'xq-light',\n        keyMap: menu.codeKeyMap,\n        tabSize: Number(menu.tabSize),\n        lineNumbers: true,\n        lineWrapping: true,\n        autoCloseTags: true,\n        autoCloseBrackets: true,\n      }}\n      editorDidMount={(editor: CodeMirror.Editor) => {\n        // eslint-disable-next-line no-param-reassign\n        forwardedRef.current = editor;\n\n        editor.focus();\n        const updateCursor = (clientID: ActorID, pos: CodeMirror.Position) => {\n          const cursor = cursorMapRef.current.get(clientID);\n          cursor?.updateCursor(editor, pos);\n        };\n\n        const updateLine = (clientID: ActorID, fromPos: CodeMirror.Position, toPos: CodeMirror.Position) => {\n          const cursor = cursorMapRef.current.get(clientID);\n          cursor?.updateLine(editor, fromPos, toPos);\n        };\n\n        // TODO(ppeeou) Load user's cursor position\n        doc.subscribe((event: DocEvent) => {\n          if (event.type === 'remote-change') {\n            for (const { change } of event.value) {\n              const actor = change.getID().getActorID()!;\n              if (actor !== client.getID()) {\n                if (!cursorMapRef.current.has(actor)) {\n                  return;\n                }\n\n                const cursor = cursorMapRef.current.get(actor);\n                if (cursor!.isActive()) {\n                  return;\n                }\n\n                updateCursor(actor, editor.posFromIndex(0));\n              }\n            }\n          }\n        });\n\n        // When there is a document modification connected to the yorkie\n        const root = doc.getRoot();\n        root.content.onChanges((changes) => {\n          changes.forEach((change) => {\n            const { actor, from, to } = change;\n            if (change.type === 'content') {\n              const content = change.content || '';\n\n              if (actor !== client.getID()) {\n                const fromPos = editor.posFromIndex(from);\n                const toPos = editor.posFromIndex(to);\n                editor.replaceRange(content, fromPos, toPos, 'yorkie');\n              }\n            } else if (change.type === 'selection') {\n              if (actor !== client.getID()) {\n                let fromPos = editor.posFromIndex(from);\n                let toPos = editor.posFromIndex(to);\n                updateCursor(actor, toPos);\n\n                if (from > to) {\n                  [toPos, fromPos] = [fromPos, toPos];\n                }\n                updateLine(actor, fromPos, toPos);\n              }\n            }\n          });\n        });\n\n        editor.setValue(root.content.getValue());\n      }}\n      // Notifying other clients to move the cursor\n      onSelection={(editor: CodeMirror.Editor, data: CodeMirror.EditorSelectionChange) => {\n        if (!data.origin) {\n          return;\n        }\n\n        const from = editor.indexFromPos(data.ranges[0].anchor);\n        const to = editor.indexFromPos(data.ranges[0].head);\n\n        doc.update((root) => {\n          root.content.select(from, to);\n        });\n      }}\n      // Edit the yorkie document\n      onBeforeChange={(editor: CodeMirror.Editor, change: CodeMirror.EditorChange) => {\n        if (change.origin === 'yorkie' || change.origin === 'setValue') {\n          return;\n        }\n\n        const from = editor.indexFromPos(change.from);\n        const to = editor.indexFromPos(change.to);\n        const content = change.text.join('\\n');\n\n        doc.update((root) => {\n          root.content.edit(from, to, content);\n        });\n      }}\n    />\n  );\n}\n","/* eslint-disable max-classes-per-file */\nclass Event {\n  private name: string;\n\n  callbacks: Array<Function>;\n\n  constructor(name: string) {\n    this.name = name;\n    this.callbacks = [];\n  }\n\n  on(cb: Function) {\n    this.callbacks.push(cb);\n  }\n\n  off(cb: Function) {\n    const idx = this.callbacks.findIndex((callback) => callback === cb);\n    this.callbacks.splice(idx, 1);\n  }\n\n  toString() {\n    return this.name;\n  }\n}\n\nexport default class EventDispatcher {\n  events: { [name: string]: Event };\n\n  constructor() {\n    this.events = {};\n  }\n\n  emit(name: string, ...args: Array<unknown>) {\n    if (!this.events[name]) {\n      return;\n    }\n\n    this.events[name].callbacks.forEach((cb) => {\n      cb(...args);\n    });\n  }\n\n  addEventListener(name: string, cb: Function): void {\n    if (!this.events[name]) {\n      this.events[name] = new Event(name);\n    }\n\n    this.events[name].on(cb);\n  }\n\n  removeEventListener(name: string, cb?: Function) {\n    if (!cb) {\n      delete this.events[name];\n      return;\n    }\n\n    this.events[name].off(cb);\n  }\n}\n","export default class CanvasWrapper {\n  private canvas: HTMLCanvasElement;\n\n  // eslint-disable-next-line react/static-property-placement\n  private context: CanvasRenderingContext2D;\n\n  private width = 0;\n\n  private height = 0;\n\n  constructor(canvas: HTMLCanvasElement) {\n    this.canvas = canvas;\n    this.context = canvas.getContext('2d')!;\n\n    this.context.lineWidth = 3;\n    this.context.lineCap = 'round';\n    this.canvas.className = 'canvas';\n\n    this.setWidth(canvas.width);\n    this.setHeight(canvas.height);\n  }\n\n  getCanvas() {\n    return this.canvas;\n  }\n\n  getContext() {\n    return this.context;\n  }\n\n  getWidth() {\n    return this.width;\n  }\n\n  getHeight() {\n    return this.height;\n  }\n\n  setWidth(width: number, devicePixelRatio?: number) {\n    this.width = width;\n    this.canvas.width = devicePixelRatio ? width * devicePixelRatio : width;\n    this.canvas.style.width = `${width}px`;\n  }\n\n  setHeight(height: number, devicePixelRatio?: number) {\n    this.height = height;\n    this.canvas.height = devicePixelRatio ? height * devicePixelRatio : height;\n    this.canvas.style.height = `${height}px`;\n  }\n\n  setSize(width: number, height: number, devicePixelRatio?: number) {\n    this.setWidth(width, devicePixelRatio);\n    this.setHeight(height, devicePixelRatio);\n  }\n\n  clear() {\n    this.getContext().clearRect(0, 0, this.getWidth(), this.getHeight());\n  }\n\n  resize() {\n    const { devicePixelRatio } = window;\n    if (devicePixelRatio) {\n      this.setSize(this.canvas.width, this.canvas.height, devicePixelRatio);\n      this.context.scale(devicePixelRatio, devicePixelRatio);\n    } else {\n      this.setSize(this.canvas.width, this.canvas.height);\n    }\n  }\n}\n","import { Color } from 'features/boardSlices';\nimport { Line, Point, EraserLine } from 'features/docSlices';\n\nexport interface LineOption {\n  color: Color;\n}\n\n/**\n * Create the basic object of the line with point.\n */\nexport function createLine(point: Point, options: LineOption): Line {\n  return {\n    type: 'line',\n    color: options.color,\n    points: [point],\n  } as Line;\n}\n\n/**\n * Create the basic object of the line with point.\n */\nexport function createEraserLine(point: Point): EraserLine {\n  return {\n    type: 'eraser',\n    points: [point],\n  } as EraserLine;\n}\n\n/**\n * Draw a line on the canvas.\n */\nexport function drawLine(context: CanvasRenderingContext2D, line: Line | EraserLine) {\n  context.save();\n  context.beginPath();\n\n  context.strokeStyle =\n    line.type === 'eraser'\n      ? '#ff7043' // eraser color\n      : line.color;\n\n  let isMoved = false;\n  for (const p of line.points) {\n    if (isMoved === false) {\n      isMoved = true;\n      context.moveTo(p.x, p.y);\n    } else {\n      context.lineTo(p.x, p.y);\n    }\n  }\n  context.stroke();\n  context.closePath();\n  context.restore();\n}\n\n/**\n * Match the mouse point position for eraser\n */\nexport function fixEraserPoint(point: Point) {\n  const eraserOffsetXSize = 8;\n  const eraserOffsetYSize = 6;\n  return {\n    y: point.y + eraserOffsetXSize,\n    x: point.x + eraserOffsetYSize,\n  };\n}\n","import { Point, Box, Shape, Rect } from 'features/docSlices';\n\n/**\n * square distance between 2 points\n */\nfunction getSqDist(p1: Point, p2: Point) {\n  const dx = p1.x - p2.x;\n  const dy = p1.y - p2.y;\n\n  return dx * dx + dy * dy;\n}\n\n/**\n * square distance from a point to a segment\n */\nfunction getSqSegDist(p: Point, p1: Point, p2: Point) {\n  let { x, y } = p1;\n  let dx = p2.x - x;\n  let dy = p2.y - y;\n\n  if (dx !== 0 || dy !== 0) {\n    const t = ((p.x - x) * dx + (p.y - y) * dy) / (dx * dx + dy * dy);\n    if (t > 1) {\n      x = p2.x;\n      y = p2.y;\n    } else if (t > 0) {\n      x += dx * t;\n      y += dy * t;\n    }\n  }\n\n  dx = p.x - x;\n  dy = p.y - y;\n  return dx * dx + dy * dy;\n}\n\nfunction douglasPeuckerStep(\n  points: Array<Point>,\n  first: number,\n  last: number,\n  tolerance: number,\n  simplified: Array<Point>,\n) {\n  let maxDist = tolerance;\n  let index = 0;\n\n  for (let i = first + 1; i < last; i += 1) {\n    const dist = getSqSegDist(points[i], points[first], points[last]);\n\n    if (dist > maxDist) {\n      index = i;\n      maxDist = dist;\n    }\n  }\n\n  if (maxDist > tolerance) {\n    if (first + 1 < index) {\n      douglasPeuckerStep(points, first, index, tolerance, simplified);\n    }\n    simplified.push(points[index]);\n    if (index + 1 < last) {\n      douglasPeuckerStep(points, index, last, tolerance, simplified);\n    }\n  }\n}\n\nfunction douglasPeucker(points: Array<Point>, tolerance: number): Array<Point> {\n  const first = 0;\n  const last = points.length - 1;\n  const simplified = [];\n\n  simplified.push(points[first]);\n  douglasPeuckerStep(points, first, last, tolerance, simplified);\n  simplified.push(points[last]);\n\n  return simplified;\n}\n\nfunction simplifyRadialDist(points: Array<Point>, tolerance: number) {\n  let point = points[0];\n  let prevPoint = point;\n  const simplified = [prevPoint];\n\n  for (let i = 1, len = points.length; i < len; i += 1) {\n    point = points[i];\n\n    if (getSqDist(point, prevPoint) > tolerance) {\n      simplified.push(point);\n      prevPoint = point;\n    }\n  }\n\n  if (prevPoint !== point) {\n    simplified.push(point);\n  }\n  return simplified;\n}\n\n/**\n * @see {@link https://cartography-playground.gitlab.io/playgrounds/douglas-peucker-algorithm/}\n * @see {@link https://github.com/mourner/simplify-js}\n */\nexport function compressPoints(points: Array<Point>, tolerance: number = 10): Array<Point> {\n  return douglasPeucker(simplifyRadialDist(points, tolerance), tolerance);\n}\n\n/**\n * Check if the two lines overlap\n * @see {@link http://jsfiddle.net/justin_c_rounds/Gd2S2/}\n * @see {@link https://en.wikipedia.org/wiki/Line%E2%80%93line_intersection}\n */\nexport function checkLineIntersection(point1Start: Point, point1End: Point, point2Start: Point, point2End: Point) {\n  // if the lines intersect, the result contains the x and y of the intersection (treating the lines as infinite) and booleans for whether line segment 1 or line segment 2 contain the point\n  let a;\n  let b;\n  const result = {\n    x: 0,\n    y: 0,\n    onLine1: false,\n    onLine2: false,\n  };\n\n  const denominator =\n    (point2End.y - point2Start.y) * (point1End.x - point1Start.x) -\n    (point2End.x - point2Start.x) * (point1End.y - point1Start.y);\n  if (denominator === 0) {\n    return result;\n  }\n  a = point1Start.y - point2Start.y;\n  b = point1Start.x - point2Start.x;\n  const numerator1 = (point2End.x - point2Start.x) * a - (point2End.y - point2Start.y) * b;\n  const numerator2 = (point1End.x - point1Start.x) * a - (point1End.y - point1Start.y) * b;\n  a = numerator1 / denominator;\n  b = numerator2 / denominator;\n\n  // if we cast these lines infinitely in both directions, they intersect here:\n  result.x = point1Start.x + a * (point1End.x - point1Start.x);\n  result.y = point1Start.y + a * (point1End.y - point1Start.y);\n  /*\n  // it is worth noting that this should be the same as:\n  x = point2Start.x + (b * (point2End.x - point2Start.x));\n  y = point2Start.x + (b * (point2End.y - point2Start.y));\n  */\n  // if line1 is a segment and line2 is infinite, they intersect if:\n  if (a > 0 && a < 1) {\n    result.onLine1 = true;\n  }\n  // if line2 is a segment and line1 is infinite, they intersect if:\n  if (b > 0 && b < 1) {\n    result.onLine2 = true;\n  }\n  // if line1 and line2 are segments, they intersect if both of the above are true\n  return result;\n}\n\nexport function cloneBox(box: Box): Box {\n  return {\n    y: box.y,\n    x: box.x,\n    width: box.width,\n    height: box.height,\n  };\n}\n\n/**\n * Check if the point is contained inside the box.\n */\nexport function isInnerBox(box: Box, point: Point): boolean {\n  const offsetY = box.y + box.height;\n  const offsetX = box.x + box.width;\n\n  if (box.height > 0 ? offsetY < point.y : offsetY > point.y) {\n    return false;\n  }\n  if (box.y > point.y) {\n    return false;\n  }\n\n  if (box.height > 0 ? offsetX < point.x : offsetX > point.x) {\n    return false;\n  }\n  if (box.x > point.x) {\n    return false;\n  }\n  return true;\n}\n\n/**\n * Check if it is a shape that can be selected.\n */\nexport function isSelectable(shape: Shape): shape is Rect {\n  return shape.type === 'rect';\n}\n","import { Rect, Point, Box } from 'features/docSlices';\n\nimport { cloneBox } from './utils';\n\n/**\n * Create the basic object of the rect with point.\n */\nexport function createRect(point: Point): Rect {\n  return {\n    type: 'rect',\n    box: {\n      x: point.x,\n      y: point.y,\n      width: 0,\n      height: 0,\n    },\n    points: [{ x: point.x, y: point.y }],\n  } as Rect;\n}\n\n/**\n * Draw a rect on the canvas.\n */\nexport function drawRect(context: CanvasRenderingContext2D, rect: Rect) {\n  context.strokeRect(rect.box.x, rect.box.y, rect.box.width, rect.box.height);\n}\n\n/**\n * Adjust the box according to the incoming point.\n */\nexport function adjustRectBox(shape: Rect, point: Point): Box {\n  const box = cloneBox(shape.box);\n  const rectPoint = shape.points[0];\n\n  const width = point.x - rectPoint.x;\n  const height = point.y - rectPoint.y;\n  const aWidth = Math.abs(width);\n  const aHeight = Math.abs(height);\n\n  box.x = rectPoint.x - (width > 0 ? 0 : -width);\n  box.y = rectPoint.y - (height > 0 ? 0 : -height);\n  box.width = aWidth;\n  box.height = aHeight;\n\n  return box;\n}\n","import { Point } from 'features/docSlices';\n\nexport type Task = Point;\n\nconst INTERVAL_TIME = 50;\nlet tasks: Array<Task> = [];\nlet timeout: ReturnType<typeof setTimeout>;\nlet work: Function | undefined;\n\nconst doWork = () => {\n  if (typeof work === 'function') {\n    work(tasks);\n    tasks = [];\n  }\n};\n\nfunction requestTask(isDone: Boolean) {\n  if (isDone) {\n    doWork();\n    return;\n  }\n\n  timeout = setTimeout(() => {\n    doWork();\n    requestTask(false);\n  }, INTERVAL_TIME);\n}\n\nexport function reserveTask(task: Task, _work: Function) {\n  tasks.push(task);\n\n  if (work === undefined) {\n    work = _work;\n    requestTask(false);\n  }\n}\n\nexport function flushTask() {\n  clearTimeout(timeout);\n\n  if (typeof work === 'function') {\n    requestTask(true);\n  }\n  work = undefined;\n}\n","import { ToolType, Color } from 'features/boardSlices';\nimport { Point, Shape } from 'features/docSlices';\nimport EventDispatcher from 'utils/eventDispatcher';\n\nimport CanvasWrapper from './CanvasWrapper';\nimport { drawLine } from './line';\nimport { drawRect } from './rect';\nimport { addEvent, removeEvent, touchy, TouchyEvent } from './dom';\nimport { Worker, LineWorker, EraserWorker, RectWorker, SelectorWorker } from './Worker';\n\nenum DragStatus {\n  Drag,\n  Stop,\n}\n\nexport default class Container extends EventDispatcher {\n  private offsetY: number = 0;\n\n  private offsetX: number = 0;\n\n  private color: Color = Color.Black;\n\n  private dragStatus: DragStatus = DragStatus.Stop;\n\n  private lowerWrapper: CanvasWrapper;\n\n  private upperWrapper: CanvasWrapper;\n\n  update: Function;\n\n  worker!: Worker;\n\n  constructor(el: HTMLCanvasElement, update: Function) {\n    super();\n    this.lowerWrapper = new CanvasWrapper(el);\n    this.upperWrapper = this.createUpperWrapper();\n\n    this.update = update;\n\n    this.initialize();\n  }\n\n  initialize() {\n    this.initializeSize();\n    this.initializeOffset();\n    this.emit = this.emit.bind(this);\n    this.drawAll = this.drawAll.bind(this);\n    this.onMouseUp = this.onMouseUp.bind(this);\n    this.onMouseDown = this.onMouseDown.bind(this);\n    this.onMouseMove = this.onMouseMove.bind(this);\n\n    this.worker = new LineWorker(this.update, this.emit);\n\n    touchy(this.upperWrapper.getCanvas(), addEvent, 'mouseup', this.onMouseUp);\n    touchy(this.upperWrapper.getCanvas(), addEvent, 'mouseout', this.onMouseUp);\n    touchy(this.upperWrapper.getCanvas(), addEvent, 'mousedown', this.onMouseDown);\n\n    this.addEventListener('renderAll', this.drawAll);\n  }\n\n  destroy() {\n    touchy(this.upperWrapper.getCanvas(), removeEvent, 'mouseup', this.onMouseUp);\n    touchy(this.upperWrapper.getCanvas(), removeEvent, 'mouseout', this.onMouseUp);\n    touchy(this.upperWrapper.getCanvas(), removeEvent, 'mousedown', this.onMouseDown);\n\n    this.destroyUpperCanvas();\n    this.removeEventListener('renderAll');\n  }\n\n  initializeOffset() {\n    const { y, x } = this.lowerWrapper.getCanvas().getBoundingClientRect();\n    this.offsetY = y;\n    this.offsetX = x;\n  }\n\n  initializeSize() {\n    this.lowerWrapper.resize();\n    this.upperWrapper.resize();\n  }\n\n  createUpperWrapper(): CanvasWrapper {\n    const canvas = document.createElement('canvas');\n    const wrapper = new CanvasWrapper(canvas);\n\n    wrapper.setWidth(this.lowerWrapper.getWidth());\n    wrapper.setHeight(this.lowerWrapper.getHeight());\n\n    this.lowerWrapper.getCanvas().parentNode?.appendChild(canvas);\n\n    return wrapper;\n  }\n\n  destroyUpperCanvas() {\n    const upperCanvas = this.upperWrapper?.getCanvas();\n\n    if (upperCanvas) {\n      upperCanvas.parentNode?.removeChild(upperCanvas);\n    }\n  }\n\n  setColor(color: Color) {\n    this.color = color;\n  }\n\n  setTool(tool: ToolType) {\n    this.setMouseClass(tool);\n\n    if (this.worker.type === tool || tool === ToolType.None) {\n      return;\n    }\n\n    this.worker.flushTask();\n\n    if (tool === ToolType.Line) {\n      this.worker = new LineWorker(this.update, this.emit);\n    } else if (tool === ToolType.Eraser) {\n      this.worker = new EraserWorker(this.update, this.emit);\n    } else if (tool === ToolType.Rect) {\n      this.worker = new RectWorker(this.update, this.emit);\n    } else if (tool === ToolType.Selector) {\n      this.worker = new SelectorWorker(this.update, this.emit);\n    } else {\n      throw new Error(`Undefined tool: ${tool}`);\n    }\n  }\n\n  setMouseClass(tool: ToolType) {\n    this.upperWrapper.getCanvas().className = 'canvas canvas-upper';\n\n    if (tool === ToolType.Line || tool === ToolType.Rect) {\n      this.upperWrapper.getCanvas().classList.add('crosshair', 'canvas-touch-none');\n    } else if (tool === ToolType.Eraser) {\n      this.upperWrapper.getCanvas().classList.add('eraser', 'canvas-touch-none');\n    } else if (tool === ToolType.Selector) {\n      this.upperWrapper.getCanvas().classList.add('canvas-touch-none');\n    }\n  }\n\n  getPointFromTouchyEvent(evt: TouchyEvent): Point {\n    let originY;\n    let originX;\n    if (window.TouchEvent && evt instanceof TouchEvent) {\n      originY = evt.touches[0].clientY;\n      originX = evt.touches[0].clientX;\n    } else {\n      originY = evt.clientY;\n      originX = evt.clientX;\n    }\n    originY += window.scrollY;\n    originX += window.scrollX;\n    return {\n      y: originY - this.offsetY,\n      x: originX - this.offsetX,\n    };\n  }\n\n  onMouseDown(evt: TouchyEvent) {\n    touchy(this.upperWrapper.getCanvas(), addEvent, 'mousemove', this.onMouseMove);\n    this.dragStatus = DragStatus.Drag;\n\n    const point = this.getPointFromTouchyEvent(evt);\n\n    this.worker.mousedown(point, { color: this.color });\n  }\n\n  onMouseMove(evt: TouchyEvent) {\n    const point = this.getPointFromTouchyEvent(evt);\n    if (this.isOutside(point)) {\n      this.onMouseUp();\n      return;\n    }\n\n    if (this.dragStatus === DragStatus.Stop) {\n      return;\n    }\n\n    this.worker.mousemove(point);\n  }\n\n  onMouseUp() {\n    touchy(this.upperWrapper.getCanvas(), removeEvent, 'mousemove', this.onMouseMove);\n    this.dragStatus = DragStatus.Stop;\n\n    this.worker.mouseup();\n    this.emit('mouseup');\n  }\n\n  isOutside(point: Point): boolean {\n    if (\n      point.y < 0 ||\n      point.x < 0 ||\n      point.y > this.lowerWrapper.getHeight() ||\n      point.x > this.lowerWrapper.getWidth()\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  drawAll(shapes: Array<Shape>, wrapper: CanvasWrapper = this.lowerWrapper) {\n    this.clear(wrapper);\n    for (const shape of shapes) {\n      if (shape.type === 'line') {\n        drawLine(wrapper.getContext(), shape);\n      } else if (shape.type === 'eraser') {\n        drawLine(wrapper.getContext(), shape);\n      } else if (shape.type === 'rect') {\n        drawRect(wrapper.getContext(), shape);\n      }\n    }\n  }\n\n  clear(wrapper: CanvasWrapper = this.lowerWrapper) {\n    wrapper.clear();\n  }\n}\n","import { TimeTicket } from 'yorkie-js-sdk';\nimport { Root, Point, Line } from 'features/docSlices';\nimport { ToolType } from 'features/boardSlices';\nimport { LineOption, createLine } from '../line';\nimport Worker from './Worker';\nimport { compressPoints } from '../utils';\nimport * as scheduler from '../scheduler';\n\nclass LineWorker implements Worker {\n  type = ToolType.Line;\n\n  private update: Function;\n\n  private emit: Function;\n\n  private createID?: TimeTicket;\n\n  constructor(update: Function, emit: Function) {\n    this.update = update;\n    this.emit = emit;\n  }\n\n  mousedown(point: Point, options: LineOption): void {\n    let timeTicket: TimeTicket;\n\n    this.update((root: Root) => {\n      const shape = createLine(point, options);\n      root.shapes.push(shape);\n\n      const lastShape = root.shapes.getLast();\n      timeTicket = lastShape.getID();\n    });\n\n    this.createID = timeTicket!;\n  }\n\n  mousemove(p: Point) {\n    scheduler.reserveTask(p, (tasks: Array<scheduler.Task>) => {\n      const points = compressPoints(tasks);\n\n      if (tasks.length < 2) {\n        return;\n      }\n\n      this.update((root: Root) => {\n        const lastShape = root.shapes.getElementByID(this.createID!) as Line;\n        lastShape.points.push(...points);\n        this.emit('renderAll', root.shapes);\n      });\n    });\n  }\n\n  mouseup() {\n    this.flushTask();\n  }\n\n  flushTask() {\n    scheduler.flushTask();\n\n    this.update((root: Root) => {\n      if (!this.createID) {\n        return;\n      }\n\n      const shape = root.shapes.getElementByID(this.createID);\n      // When erasing a line, it checks that the lines overlap, so do not save if there are two points below\n      if (shape.points.length < 2) {\n        root.shapes.deleteByID(this.createID!);\n      }\n\n      this.emit('renderAll', root.shapes);\n    });\n  }\n}\n\nexport default LineWorker;\n","import { TimeTicket } from 'yorkie-js-sdk';\nimport { Root, Point, Rect } from 'features/docSlices';\nimport { ToolType } from 'features/boardSlices';\nimport { createRect, adjustRectBox } from '../rect';\nimport Worker from './Worker';\nimport * as scheduler from '../scheduler';\n\nclass RectWorker implements Worker {\n  type = ToolType.Rect;\n\n  private update: Function;\n\n  private emit: Function;\n\n  private createID?: TimeTicket;\n\n  constructor(update: Function, emit: Function) {\n    this.update = update;\n    this.emit = emit;\n  }\n\n  mousedown(point: Point): void {\n    let timeTicket: TimeTicket;\n\n    this.update((root: Root) => {\n      const shape = createRect(point);\n      root.shapes.push(shape);\n\n      const lastShape = root.shapes.getLast();\n      timeTicket = lastShape.getID();\n    });\n\n    this.createID = timeTicket!;\n  }\n\n  mousemove(p: Point) {\n    scheduler.reserveTask(p, (tasks: Array<scheduler.Task>) => {\n      if (tasks.length < 2) {\n        return;\n      }\n\n      this.update((root: Root) => {\n        const point = tasks[tasks.length - 1];\n        const lastShape = root.shapes.getElementByID(this.createID!) as Rect;\n        const box = adjustRectBox(lastShape, point);\n        lastShape.box = box;\n\n        this.emit('renderAll', root.shapes);\n      });\n    });\n  }\n\n  mouseup() {\n    this.flushTask();\n  }\n\n  flushTask() {\n    scheduler.flushTask();\n  }\n}\n\nexport default RectWorker;\n","import { TimeTicket } from 'yorkie-js-sdk';\nimport { Root, Point } from 'features/docSlices';\nimport { ToolType } from 'features/boardSlices';\nimport { createEraserLine, fixEraserPoint } from '../line';\nimport Worker from './Worker';\nimport { compressPoints, checkLineIntersection, isInnerBox, isSelectable } from '../utils';\nimport * as scheduler from '../scheduler';\n\nclass EraserWorker implements Worker {\n  type = ToolType.Eraser;\n\n  private update: Function;\n\n  private emit: Function;\n\n  private createID?: TimeTicket;\n\n  constructor(update: Function, emit: Function) {\n    this.update = update;\n    this.emit = emit;\n  }\n\n  mousedown(point: Point): void {\n    let timeTicket: TimeTicket;\n\n    this.update((root: Root) => {\n      const shape = createEraserLine(point);\n      root.shapes.push(shape);\n\n      const lastShape = root.shapes.getLast();\n      timeTicket = lastShape.getID();\n    });\n\n    this.createID = timeTicket!;\n  }\n\n  mousemove(p: Point) {\n    scheduler.reserveTask(p, (tasks: Array<scheduler.Task>) => {\n      const points = compressPoints(tasks);\n\n      if (tasks.length < 2) {\n        return;\n      }\n\n      this.update((root: Root) => {\n        const pointStart = fixEraserPoint(points[0]);\n        const pointEnd = fixEraserPoint(points[points.length - 1]);\n        const lastShape = root.shapes.getElementByID(this.createID!);\n\n        const findAndRemoveShape = (point1: Point, point2: Point) => {\n          for (const shape of root.shapes) {\n            if (isSelectable(shape)) {\n              if (isInnerBox(shape.box, point2)) {\n                root.shapes.deleteByID(shape.getID());\n              }\n            } else {\n              for (let i = 1; i < shape.points.length; i += 1) {\n                const result = checkLineIntersection(point1, point2, shape.points[i - 1], shape.points[i]);\n                if (result.onLine1 && result.onLine2) {\n                  root.shapes.deleteByID(shape.getID());\n                  break;\n                }\n              }\n            }\n          }\n        };\n\n        if (lastShape.points.length > 0) {\n          const lastPoint = lastShape.points[lastShape.points.length - 1];\n          findAndRemoveShape(lastPoint, pointStart);\n        }\n\n        findAndRemoveShape(pointStart, pointEnd);\n        lastShape.points = [pointStart, pointEnd];\n\n        this.emit('renderAll', root.shapes);\n      });\n    });\n  }\n\n  mouseup() {\n    this.flushTask();\n  }\n\n  flushTask() {\n    scheduler.flushTask();\n\n    this.update((root: Root) => {\n      if (!this.createID) {\n        return;\n      }\n\n      root.shapes.deleteByID(this.createID);\n      this.emit('renderAll', root.shapes);\n    });\n  }\n}\n\nexport default EraserWorker;\n","import { Root, Point, Shape } from 'features/docSlices';\nimport { ToolType } from 'features/boardSlices';\nimport { isInnerBox, cloneBox, isSelectable } from '../utils';\nimport Worker from './Worker';\nimport * as scheduler from '../scheduler';\n\nclass SelectorWorker implements Worker {\n  type = ToolType.Selector;\n\n  private update: Function;\n\n  private emit: Function;\n\n  private selectedShape?: { shape: Shape; point: Point };\n\n  constructor(update: Function, emit: Function) {\n    this.update = update;\n    this.emit = emit;\n  }\n\n  mousedown(point: Point): void {\n    const target = this.findTarget(point);\n    if (target) {\n      this.selectedShape = {\n        shape: target,\n        point,\n      };\n      return;\n    }\n\n    this.selectedShape = undefined;\n  }\n\n  mousemove(p: Point) {\n    scheduler.reserveTask(p, (tasks: Array<scheduler.Task>) => {\n      if (tasks.length < 2) {\n        return;\n      }\n\n      this.update((root: Root) => {\n        if (this.isEmptySelectedShape()) {\n          return;\n        }\n\n        const lastShape = root.shapes.getElementByID(this.selectedShape!.shape.getID());\n        if (!lastShape || lastShape.type !== 'rect') {\n          return;\n        }\n\n        if (isSelectable(lastShape)) {\n          const pointEnd = tasks[tasks.length - 1];\n          const offsetY = pointEnd.y - this.selectedShape!.point.y;\n          const offsetX = pointEnd.x - this.selectedShape!.point.x;\n          this.selectedShape!.point = pointEnd;\n\n          lastShape.box = {\n            ...cloneBox(lastShape.box),\n            y: lastShape.box.y + offsetY,\n            x: lastShape.box.x + offsetX,\n          };\n\n          lastShape.points[0] = {\n            y: lastShape.points[0].y + offsetY,\n            x: lastShape.points[0].x + offsetX,\n          };\n        }\n        this.emit('renderAll', root.shapes);\n      });\n    });\n  }\n\n  mouseup() {\n    this.flushTask();\n  }\n\n  flushTask() {\n    scheduler.flushTask();\n  }\n\n  /**\n   * Check if there is a selected shape.\n   */\n  isEmptySelectedShape() {\n    return !this.selectedShape;\n  }\n\n  /**\n   * Find the shape in the document.\n   */\n  findTarget(point: Point): Shape | undefined {\n    let target;\n    this.update((root: Root) => {\n      for (const shape of root.shapes) {\n        if (shape.type === 'rect' && isInnerBox(shape.box, point)) {\n          target = shape;\n          return;\n        }\n      }\n    });\n    return target;\n  }\n}\n\nexport default SelectorWorker;\n","import React, { useEffect, useRef } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport { AppState } from 'app/rootReducer';\nimport { ToolType, setTool } from 'features/boardSlices';\n\nimport Container from './Canvas/Container';\nimport './index.css';\n\nexport default function DrawingBoard({ width, height }: { width: number; height: number }) {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const containerRef = useRef<Container | null>(null);\n  const dispatch = useDispatch();\n  const doc = useSelector((state: AppState) => state.docState.doc);\n  const tool = useSelector((state: AppState) => state.boardState.tool);\n  const color = useSelector((state: AppState) => state.boardState.color);\n\n  useEffect(() => {\n    if (!canvasRef.current || !doc) {\n      return () => {};\n    }\n\n    canvasRef.current.width = width;\n    canvasRef.current.height = height;\n\n    const container = new Container(canvasRef.current, doc.update.bind(doc));\n    containerRef.current = container;\n    containerRef.current.setTool(tool);\n    containerRef.current.setColor(color);\n    containerRef.current.drawAll(doc.getRoot().shapes);\n\n    const handleMouseup = () => {\n      if (tool === ToolType.Rect) {\n        dispatch(setTool(ToolType.Selector));\n      }\n    };\n\n    containerRef.current.addEventListener('mouseup', handleMouseup);\n\n    return () => {\n      containerRef.current?.removeEventListener('mouseup', handleMouseup);\n      container.destroy();\n    };\n  }, [width, height, doc, tool, color]);\n\n  useEffect(() => {\n    if (!doc) {\n      return () => {};\n    }\n\n    const unsubscribe = doc.subscribe((event) => {\n      if (event.type === 'remote-change') {\n        containerRef.current?.drawAll(doc.getRoot().shapes);\n      }\n    });\n\n    return () => {\n      unsubscribe();\n    };\n  }, [doc]);\n\n  useEffect(() => {\n    containerRef.current?.setTool(tool);\n  }, [doc, tool]);\n\n  return <canvas ref={canvasRef} />;\n}\n","import React from 'react';\nimport SvgIcon, { SvgIconProps } from '@material-ui/core/SvgIcon';\n\nexport default function Eraser({ fontSize }: SvgIconProps) {\n  return (\n    <SvgIcon fontSize={fontSize}>\n      <svg version=\"1.1\" id=\"Layer_1\" x=\"0px\" y=\"0px\" viewBox=\"0 0 480.001 480.001\">\n        <g>\n          <g>\n            <path\n              d=\"M333.142,350.846c0.115-0.115,0.215-0.239,0.323-0.357l129.681-129.706c10.878-10.878,16.864-25.368,16.855-40.8\n          c-0.01-15.409-5.999-29.865-16.854-40.694l-97.844-97.874c-10.853-10.845-25.326-16.817-40.75-16.817\n          c-15.426,0-29.895,5.974-40.741,16.82L16.855,308.329C5.974,319.21-0.012,333.713,0,349.168\n          c0.013,15.425,6.002,29.884,16.854,40.7l62.592,62.606c0.061,0.061,0.127,0.112,0.188,0.171c0.174,0.165,0.349,0.331,0.534,0.483\n          c0.082,0.067,0.171,0.126,0.255,0.19c0.175,0.135,0.349,0.271,0.532,0.395c0.07,0.047,0.145,0.085,0.215,0.13\n          c0.205,0.131,0.412,0.26,0.627,0.376c0.051,0.026,0.103,0.048,0.154,0.074c0.239,0.123,0.482,0.241,0.732,0.346\n          c0.033,0.014,0.067,0.024,0.101,0.037c0.269,0.108,0.54,0.208,0.819,0.293c0.034,0.011,0.07,0.017,0.104,0.027\n          c0.276,0.081,0.556,0.154,0.841,0.211c0.082,0.017,0.165,0.023,0.247,0.038c0.239,0.041,0.479,0.084,0.724,0.107\n          c0.33,0.033,0.663,0.051,0.998,0.051h137.91h159.308c5.522,0,10-4.478,10-10c0-5.522-4.478-10-10-10H248.566l84.22-84.236\n          C332.904,351.06,333.027,350.96,333.142,350.846z M220.285,435.404H90.66l-59.675-59.689\n          c-7.076-7.054-10.977-16.487-10.985-26.563c-0.008-10.106,3.897-19.582,10.996-26.681l129.825-129.803l151.091,151.091\n          L220.285,435.404z M174.965,178.527L297.953,55.56c7.069-7.069,16.516-10.963,26.6-10.963c10.085,0,19.536,3.895,26.609,10.962\n          l97.85,97.88c7.08,7.063,10.982,16.493,10.989,26.557c0.006,10.085-3.899,19.547-10.998,26.645l-122.95,122.974L174.965,178.527z\"\n            />\n          </g>\n        </g>\n      </svg>\n    </SvgIcon>\n  );\n}\n","import React from 'react';\nimport SvgIcon, { SvgIconProps } from '@material-ui/core/SvgIcon';\n\nexport default function Mouse({ fontSize }: SvgIconProps) {\n  return (\n    <SvgIcon fontSize={fontSize}>\n      <svg viewBox=\"-36 0 392 392.40392\" xmlns=\"http://www.w3.org/2000/svg\">\n        <path d=\"m43 355.03125c.492188 3.949219 3.273438 7.230469 7.085938 8.355469 3.816406 1.128906 7.933593-.109375 10.492187-3.152344l68.5-81.507813 72.972656 109.230469c3.058594 4.585938 9.25 5.828125 13.84375 2.777344l65.226563-43.285156c4.589844-3.046875 5.851562-9.234375 2.820312-13.835938l-72.304687-109.675781 101.714843-31.453125c3.800782-1.175781 6.542969-4.488281 6.984376-8.441406.441406-3.953125-1.5-7.792969-4.945313-9.777344l-300.195313-172.929687c-3.289062-1.894532-7.363281-1.765626-10.523437.332031-3.160156 2.097656-4.863281 5.804687-4.394531 9.566406zm242.539062-174.878906-92.539062 28.617187c-3.003906.929688-5.398438 3.21875-6.460938 6.179688-1.058593 2.960937-.664062 6.25 1.066407 8.875l74.152343 112.476562-48.613281 32.261719-74.832031-112.023438c-1.746094-2.617187-4.625-4.257812-7.765625-4.429687-.183594-.011719-.367187-.015625-.550781-.015625-2.953125 0-5.753906 1.308594-7.652344 3.566406l-62.320312 74.152344-37.421876-301.128906zm0 0\" />\n      </svg>\n    </SvgIcon>\n  );\n}\n","import React from 'react';\nimport SvgIcon, { SvgIconProps } from '@material-ui/core/SvgIcon';\n\nexport default function Mouse({ fontSize }: SvgIconProps) {\n  return (\n    <SvgIcon fontSize={fontSize}>\n      <svg enableBackground=\"new 0 0 506.1 506.1\" viewBox=\"0 0 506.1 506.1\" xmlns=\"http://www.w3.org/2000/svg\">\n        <path d=\"m489.609 506.1h-473.118c-9.108 0-16.491-7.384-16.491-16.491v-473.118c0-9.108 7.383-16.491 16.491-16.491h473.119c9.107 0 16.49 7.383 16.49 16.491v473.118c0 9.107-7.383 16.491-16.491 16.491zm-456.628-32.982h440.138v-440.137h-440.138z\" />\n      </svg>\n    </SvgIcon>\n  );\n}\n","import React, { useCallback, useState, MouseEvent } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\n\nimport Badge from '@material-ui/core/Badge';\nimport Avatar from '@material-ui/core/Avatar';\nimport IconButton from '@material-ui/core/IconButton';\nimport BrushIcon from '@material-ui/icons/Brush';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport Box from '@material-ui/core/Box';\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\n\nimport Popover from 'components/commons/Popover';\nimport { AppState } from 'app/rootReducer';\nimport { ToolType, setTool, Color, setColor } from 'features/boardSlices';\n\nconst useStyles = makeStyles((theme) =>\n  createStyles({\n    button: {\n      marginLeft: 3,\n      marginRight: 3,\n      padding: 8,\n    },\n    select: {\n      marginLeft: 3,\n      marginRight: 3,\n      padding: 8,\n      color: theme.palette.primary.main,\n    },\n    box: {\n      width: '184px',\n      display: 'flex',\n      flexWrap: 'wrap',\n      '& > *': {\n        margin: theme.spacing(1),\n      },\n    },\n    colorIcon: {\n      '&:hover': {\n        cursor: 'pointer',\n      },\n      width: theme.spacing(3.1),\n      height: theme.spacing(3.1),\n    },\n    badge: {\n      backgroundColor: ({ color }: { color: Color }) => color,\n    },\n  }),\n);\n\nexport default function LineButton() {\n  const dispatch = useDispatch();\n  const tool = useSelector((state: AppState) => state.boardState.tool);\n  const color = useSelector((state: AppState) => state.boardState.color);\n  const [anchorEl, setAnchorEl] = useState<HTMLButtonElement | undefined>();\n  const classes = useStyles({ color });\n\n  const handleOpen = useCallback(\n    (event: MouseEvent<HTMLButtonElement>) => {\n      setAnchorEl(event.currentTarget);\n    },\n    [tool],\n  );\n\n  const handleClose = useCallback(() => {\n    setAnchorEl(undefined);\n  }, []);\n\n  const handleSelectTool = useCallback(\n    (event: MouseEvent<HTMLButtonElement>) => {\n      if (tool === ToolType.Line) {\n        handleOpen(event);\n        return;\n      }\n\n      dispatch(setTool(ToolType.Line));\n    },\n    [tool, color],\n  );\n\n  const handleSelectColor = (nextColor: Color) => () => {\n    dispatch(setTool(ToolType.Line));\n    dispatch(setColor(nextColor));\n    handleClose();\n  };\n\n  return (\n    <>\n      <Tooltip title=\"Brush\" arrow className={tool === ToolType.Line ? classes.select : classes.button}>\n        <IconButton aria-label=\"Brush\" onClick={handleSelectTool}>\n          {tool === ToolType.Line ? (\n            <Badge\n              variant=\"dot\"\n              classes={{ badge: classes.badge }}\n              anchorOrigin={{\n                vertical: 'bottom',\n                horizontal: 'right',\n              }}\n            >\n              <BrushIcon fontSize=\"small\" />\n            </Badge>\n          ) : (\n            <BrushIcon fontSize=\"small\" />\n          )}\n        </IconButton>\n      </Tooltip>\n\n      <Popover\n        anchorEl={anchorEl}\n        onClose={handleClose}\n        anchorOrigin={{\n          vertical: 'top',\n          horizontal: 'left',\n        }}\n        transformOrigin={{\n          vertical: 'top',\n          horizontal: 'right',\n        }}\n      >\n        <Box p={2} className={classes.box}>\n          {Object.entries(Color).map(([name, _color]: [string, Color]) => {\n            const selected = color === _color && tool === ToolType.Line;\n            return (\n              <Tooltip key={name} title={name} arrow>\n                <Box border={3} borderRadius=\"50%\" borderColor={selected ? 'primary.main' : ''}>\n                  <Avatar\n                    className={classes.colorIcon}\n                    style={{ backgroundColor: _color }}\n                    onClick={handleSelectColor(_color)}\n                  >\n                    {/* If there are no spaces, the default svg is output. */}{' '}\n                  </Avatar>\n                </Box>\n              </Tooltip>\n            );\n          })}\n        </Box>\n      </Popover>\n    </>\n  );\n}\n","import React from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport IconButton from '@material-ui/core/IconButton';\nimport CodeIcon from '@material-ui/icons/Code';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport Divider from '@material-ui/core/Divider';\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\n\nimport EraserIcon from 'assets/icons/Eraser';\nimport MouseIcon from 'assets/icons/Mouse';\nimport RectIcon from 'assets/icons/Rect';\nimport LineButton from 'components/Editor/Sidebar/LineButton';\nimport { AppState } from 'app/rootReducer';\nimport { ToolType, setTool } from 'features/boardSlices';\n\nconst useStyles = makeStyles((theme) =>\n  createStyles({\n    root: {\n      display: 'flex',\n      flexDirection: 'column',\n    },\n    divider: {\n      marginTop: 5,\n      marginBottom: 5,\n    },\n    button: {\n      marginLeft: 3,\n      marginRight: 3,\n      padding: 8,\n    },\n    select: {\n      marginLeft: 3,\n      marginRight: 3,\n      padding: 8,\n      color: theme.palette.primary.main,\n    },\n  }),\n);\n\nexport default function Sidebar() {\n  const classes = useStyles();\n  const dispatch = useDispatch();\n  const tool = useSelector((state: AppState) => state.boardState.tool);\n\n  const handleSelectTool = (nextTool: ToolType) => () => {\n    dispatch(setTool(nextTool));\n  };\n\n  return (\n    <div className={classes.root}>\n      <Tooltip title=\"Code\" arrow className={tool === ToolType.None ? classes.select : classes.button}>\n        <IconButton aria-label=\"Code\" onClick={handleSelectTool(ToolType.None)}>\n          <CodeIcon fontSize=\"small\" />\n        </IconButton>\n      </Tooltip>\n      <Divider className={classes.divider} />\n      <LineButton />\n      <Tooltip title=\"Rect\" arrow className={tool === ToolType.Rect ? classes.select : classes.button}>\n        <IconButton aria-label=\"rect\" onClick={handleSelectTool(ToolType.Rect)}>\n          <RectIcon fontSize=\"small\" />\n        </IconButton>\n      </Tooltip>\n      <Tooltip title=\"Selector\" arrow className={tool === ToolType.Selector ? classes.select : classes.button}>\n        <IconButton aria-label=\"selector\" onClick={handleSelectTool(ToolType.Selector)}>\n          <MouseIcon fontSize=\"small\" />\n        </IconButton>\n      </Tooltip>\n      <Tooltip title=\"Eraser\" arrow className={tool === ToolType.Eraser ? classes.select : classes.button}>\n        <IconButton aria-label=\"eraser\" onClick={handleSelectTool(ToolType.Eraser)}>\n          <EraserIcon fontSize=\"small\" />\n        </IconButton>\n      </Tooltip>\n    </div>\n  );\n}\n","import React, { useEffect, useState, useRef, useCallback } from 'react';\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\n\nimport CodeEditor from 'components/Editor/CodeEditor';\nimport DrawingBoard from 'components/Editor/DrawingBoard';\nimport Sidebar from 'components/Editor/Sidebar';\nimport { ToolType } from 'features/boardSlices';\n\nexport const NAVBAR_HEIGHT = 110;\nconst SIDEBAR_WIDTH = 42;\n\ninterface EditorProps {\n  tool: ToolType;\n}\n\nconst useStyles = makeStyles(() =>\n  createStyles({\n    root: {\n      flexGrow: 1,\n      display: 'flex',\n    },\n    editor: {\n      width: `calc(100% - ${SIDEBAR_WIDTH}px)`,\n    },\n    codeEditor: {\n      width: '100%',\n      height: `calc(100vh - ${NAVBAR_HEIGHT}px)`,\n    },\n    canvas: {\n      top: NAVBAR_HEIGHT,\n      height: `calc(100vh - ${NAVBAR_HEIGHT}px)`,\n      width: `calc(100% - ${SIDEBAR_WIDTH}px)`,\n      position: 'fixed',\n      /**\n       * z-index\n       * 1:  Show code mirror first\n       * 10: Show canvas first\n       */\n      zIndex: (tool: ToolType) => (tool === ToolType.None ? 1 : 10),\n    },\n  }),\n);\n\nexport default function Editor({ tool }: EditorProps) {\n  const classes = useStyles(tool);\n\n  const [width, setWidth] = useState(0);\n  const [height, setHeight] = useState(0);\n\n  const divRef = useRef<HTMLDivElement>(null);\n  const codeEditorRef = useRef<CodeMirror.Editor>(null);\n\n  const onClickEditor = useCallback(() => {\n    if (tool === ToolType.None) {\n      codeEditorRef.current?.focus();\n    }\n  }, [tool]);\n\n  useEffect(() => {\n    const onResize = () => {\n      if (!divRef.current) {\n        return;\n      }\n\n      const rect = divRef.current?.getBoundingClientRect();\n      setWidth(rect.width);\n      setHeight(rect.height);\n    };\n\n    onResize();\n    window.addEventListener('resize', onResize);\n    return () => {\n      window.removeEventListener('resize', onResize);\n    };\n  }, []);\n\n  return (\n    <div className={classes.root} onClick={onClickEditor} aria-hidden=\"true\">\n      <div className={classes.editor} ref={divRef}>\n        <div className={classes.codeEditor}>\n          <CodeEditor forwardedRef={codeEditorRef} />\n        </div>\n        <div className={classes.canvas}>\n          <DrawingBoard width={width} height={height} />\n        </div>\n      </div>\n      <Sidebar />\n    </div>\n  );\n}\n","import React, { useEffect } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\n\nimport { Box } from '@material-ui/core';\nimport Snackbar from '@material-ui/core/Snackbar';\nimport Alert from '@material-ui/lab/Alert';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\nimport { AppState } from 'app/rootReducer';\nimport {\n  activateClient,\n  deactivateClient,\n  createDocument,\n  detachDocument,\n  attachDoc,\n  attachDocLoading,\n  CodeMode,\n  setCodeMode,\n  DocStatus,\n  setStatus,\n} from 'features/docSlices';\nimport { syncPeer } from 'features/peerSlices';\nimport Editor, { NAVBAR_HEIGHT } from './Editor';\n\nconst useStyles = makeStyles(() =>\n  createStyles({\n    loading: {\n      display: 'flex',\n      height: `calc(100vh - ${NAVBAR_HEIGHT}px)`,\n      alignItems: 'center',\n      justifyContent: 'center',\n    },\n  }),\n);\n\n// eslint-disable-next-line func-names\nexport default function (props: { docKey: string }) {\n  const { docKey } = props;\n  const classes = useStyles();\n  const dispatch = useDispatch();\n  const client = useSelector((state: AppState) => state.docState.client);\n  const doc = useSelector((state: AppState) => state.docState.doc);\n  const status = useSelector((state: AppState) => state.docState.status);\n  const tool = useSelector((state: AppState) => state.boardState.tool);\n  const loading = useSelector((state: AppState) => state.docState.loading);\n  const errorMessage = useSelector((state: AppState) => state.docState.errorMessage);\n\n  useEffect(() => {\n    dispatch(activateClient());\n    return () => {\n      dispatch(deactivateClient());\n    };\n  }, []);\n\n  useEffect(() => {\n    if (!client || !doc) {\n      return () => {};\n    }\n\n    const unsubscribe = client.subscribe((event) => {\n      if (event.type === 'peers-changed') {\n        const documentKey = doc.getKey();\n        const changedPeers = event.value[documentKey];\n        dispatch(\n          syncPeer({\n            myClientID: client.getID(),\n            changedPeers,\n          }),\n        );\n      }\n\n      if (\n        status === DocStatus.Connect &&\n        ((event.type === 'status-changed' && event.value === 'deactivated') ||\n          (event.type === 'stream-connection-status-changed' && event.value === 'disconnected') ||\n          (event.type === 'document-synced' && event.value === 'sync-failed'))\n      ) {\n        dispatch(setStatus(DocStatus.Disconnect));\n      } else if (\n        status === DocStatus.Disconnect &&\n        (event.type === 'peers-changed' ||\n          event.type === 'documents-changed' ||\n          (event.type === 'status-changed' && event.value === 'activated') ||\n          (event.type === 'stream-connection-status-changed' && event.value === 'connected') ||\n          (event.type === 'document-synced' && event.value === 'synced'))\n      ) {\n        dispatch(setStatus(DocStatus.Connect));\n      }\n    });\n\n    return () => {\n      unsubscribe();\n    };\n  }, [client, doc, status]);\n\n  useEffect(() => {\n    dispatch(createDocument(docKey));\n    return () => {\n      dispatch(detachDocument());\n    };\n  }, [docKey]);\n\n  useEffect(() => {\n    async function attachDocAsync() {\n      if (!client || !doc) {\n        return;\n      }\n\n      dispatch(attachDocLoading(true));\n      await dispatch(attachDoc({ client, doc }));\n      dispatch(setCodeMode(doc.getRoot().mode || CodeMode.Markdown));\n      dispatch(attachDocLoading(false));\n    }\n\n    attachDocAsync();\n    return () => {\n      dispatch(attachDocLoading(true));\n    };\n  }, [docKey, client, doc]);\n\n  if (errorMessage) {\n    return (\n      <div>\n        <Snackbar open anchorOrigin={{ vertical: 'top', horizontal: 'center' }}>\n          <Alert severity=\"warning\">{errorMessage || 'fail to attach document'}</Alert>\n        </Snackbar>\n      </div>\n    );\n  }\n\n  if (loading) {\n    return (\n      <Box className={classes.loading}>\n        <CircularProgress color=\"inherit\" />\n      </Box>\n    );\n  }\n\n  return <Editor tool={tool} />;\n}\n","import React, { useEffect } from 'react';\nimport { RouteComponentProps } from 'react-router';\nimport { useLocation } from 'react-router-dom';\nimport ReactGA from 'react-ga';\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\n\nimport NavBar from 'components/NavBar';\nimport Toolbar from 'components/Toolbar';\nimport Editor from 'components/Editor';\n\ntype DocPageProps = {\n  docKey: string;\n};\n\nconst useStyles = makeStyles(() =>\n  createStyles({\n    root: {\n      flexGrow: 1,\n    },\n  }),\n);\n\nexport default function DocPage(props: RouteComponentProps<DocPageProps>) {\n  const classes = useStyles();\n  const location = useLocation();\n  const {\n    match: { params },\n  } = props;\n  const { docKey } = params;\n\n  useEffect(() => {\n    ReactGA.set({ page: location.pathname });\n    ReactGA.pageview(location.pathname);\n  }, [location]);\n\n  return (\n    <div className={classes.root}>\n      <NavBar />\n      <Toolbar />\n      <Editor docKey={docKey} />\n    </div>\n  );\n}\n","import React, { useMemo, useCallback } from 'react';\nimport { useSelector } from 'react-redux';\nimport { BrowserRouter as Router, Route, Redirect } from 'react-router-dom';\nimport CssBaseline from '@material-ui/core/CssBaseline';\nimport { createMuiTheme, ThemeProvider } from '@material-ui/core/styles';\nimport { AppState } from 'app/rootReducer';\nimport { Theme } from 'features/settingSlices';\n\nimport DocPage from 'pages/DocPage';\nimport './App.css';\n\nfunction App() {\n  const menu = useSelector((state: AppState) => state.settingState.menu);\n  const theme = useMemo(\n    () =>\n      createMuiTheme({\n        palette: {\n          type: menu.theme === Theme.Dark ? 'dark' : 'light',\n          primary: {\n            main: '#d8b01a',\n          },\n          secondary: {\n            main: '#e6b602',\n          },\n        },\n      }),\n    [menu],\n  );\n\n  const handleRender = useCallback(() => {\n    return <Redirect to={`/${Math.random().toString(36).substring(7)}`} />;\n  }, []);\n\n  return (\n    <ThemeProvider theme={theme}>\n      {/* CssBaseline kickstart an elegant, consistent, and simple baseline to build upon. */}\n      <CssBaseline />\n      <Router>\n        <Route path=\"/\" exact render={handleRender} />\n        <Route path=\"/:docKey\" exact component={DocPage} />\n      </Router>\n    </ThemeProvider>\n  );\n}\n\nexport default App;\n","import { combineReducers } from 'redux';\n\nimport docReducer from 'features/docSlices';\nimport peerReducer from 'features/peerSlices';\nimport settingReducer from 'features/settingSlices';\nimport boardReducer from 'features/boardSlices';\n\nconst rootReducer = combineReducers({\n  docState: docReducer,\n  peerState: peerReducer,\n  settingState: settingReducer,\n  boardState: boardReducer,\n});\n\nexport type AppState = ReturnType<typeof rootReducer>;\n\nexport default rootReducer;\n","import { configureStore, Action, getDefaultMiddleware } from '@reduxjs/toolkit';\nimport { ThunkAction } from 'redux-thunk';\n\nimport rootReducer, { AppState } from './rootReducer';\n\nconst store = configureStore({\n  reducer: rootReducer,\n  middleware: getDefaultMiddleware({\n    serializableCheck: {\n      ignoredActions: ['doc/attach/fulfilled', 'doc/activate/fulfilled'],\n      ignoredPaths: ['docState.client', 'docState.doc'],\n    },\n    immutableCheck: {\n      ignoredPaths: ['docState.client', 'docState.doc'],\n    },\n  }),\n});\n\nexport type AppDispatch = typeof store.dispatch;\n\nexport type AppThunk = ThunkAction<void, AppState, unknown, Action<string>>;\n\nexport default store;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,\n    ),\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA',\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.',\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.',\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then((registration) => {\n        registration.unregister();\n      })\n      .catch((error) => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Provider } from 'react-redux';\nimport ReactGA from 'react-ga';\nimport * as Sentry from '@sentry/react';\nimport { Integrations } from '@sentry/tracing';\nimport App from 'app/App';\nimport store from 'app/store';\n\nimport * as serviceWorker from 'serviceWorker';\n\nReactGA.initialize('UA-42438082-5');\n\nSentry.init({\n  dsn: 'https://d287d6df8c6f423189266360055e6ca7@o553194.ingest.sentry.io/5680102',\n  release: `yorkie-codepair@${process.env.REACT_APP_GIT_HASH}`,\n  integrations: [new Integrations.BrowserTracing()],\n\n  // Set tracesSampleRate to 1.0 to capture 100%\n  // of transactions for performance monitoring.\n  // We recommend adjusting this value in production\n  tracesSampleRate: 1.0,\n});\n\nReactDOM.render(\n  <Provider store={store}>\n    <App />\n  </Provider>,\n  document.querySelector('#root'),\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","export function addEvent(el: EventTarget, type: string, fn: EventListener, capturing?: boolean) {\n  return el.addEventListener(type, fn, capturing);\n}\n\nexport function removeEvent(el: EventTarget, type: string, fn: EventListener, capturing?: boolean) {\n  return el.removeEventListener(type, fn, capturing);\n}\n\nconst touch = {\n  mouseup: 'touchend',\n  mouseout: 'touchend',\n  mousedown: 'touchstart',\n  mousemove: 'touchmove',\n};\n\nconst pointers = {\n  mouseup: 'pointerup',\n  mouseout: 'pointerup',\n  mousedown: 'pointerdown',\n  mousemove: 'pointermove',\n};\n\nconst microsoft = {\n  mouseup: 'MSPointerUp',\n  mouseout: 'MSPointerUp',\n  mousedown: 'MSPointerDown',\n  mousemove: 'MSPointerMove',\n};\n\ntype MouseType = 'mouseup' | 'mouseout' | 'mousedown' | 'mousemove';\n\nexport type TouchyEvent = MouseEvent & TouchEvent;\n\n/**\n * {@linkcode https://github.com/bevacqua/dragula/blob/e0bcdc72ae8e0b85e17f154957bdd0cc2e2e35db/dragula.js#L498}\n */\nexport function touchy(el: EventTarget, event: Function, type: MouseType, fn: (evt: TouchyEvent) => void) {\n  if (global.navigator.pointerEnabled) {\n    event(el, pointers[type], fn);\n  } else if (global.navigator.msPointerEnabled) {\n    event(el, microsoft[type], fn);\n  } else {\n    event(el, touch[type], fn);\n    event(el, type, fn);\n  }\n}\n"],"sourceRoot":""}